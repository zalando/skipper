
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://opensource.zalando.com/skipper/reference/development/">
      
      
        <link rel="prev" href="../routing/">
      
      
        <link rel="next" href="../../data-clients/eskip-file/">
      
      
        
      
      
      <link rel="icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>Development - Skipper</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-develop-a-filter" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Skipper" class="md-header__button md-logo" aria-label="Skipper" data-md-component="logo">
      
  <img src="../../skipper-h180.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Skipper
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Development
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/zalando/skipper/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Skipper" class="md-nav__button md-logo" aria-label="Skipper" data-md-component="logo">
      
  <img src="../../skipper-h180.png" alt="logo">

    </a>
    Skipper
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zalando/skipper/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../filters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Filters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../predicates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Predicates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backends
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../egress/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Egress
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scripts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plugins
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../routing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Routing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-develop-a-filter" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to develop a Filter
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How to develop a Filter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-pass-options-to-your-filter" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to pass options to your filter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        User documentation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-godoc" class="md-nav__link">
    <span class="md-ellipsis">
      
        Add godoc
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Filter implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writing-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Writing tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-a-debugger" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using a debugger
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10" >
        
          
          <label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Data Clients
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Data Clients
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-clients/eskip-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Eskip File
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-clients/eskip-remote/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Remote Eskip
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-clients/route-string/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Route String
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-clients/kubernetes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-clients/etcd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Etcd
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11" >
        
          
          <label class="md-nav__link" for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Operation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Operation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/operation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Operation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Kubernetes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/ingress-controller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ingress Controller Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/ingress-usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ingress Usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/ingress-backends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ingress Backends
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/routegroups/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RouteGroups
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/routegroup-crd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RouteGroup CRD Semantics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/routegroup-validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RouteGroup Validation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/east-west-usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    East-West aka svc-to-svc
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/external-addresses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    External Addresses aka External Name
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/migrate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Migration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/common-use-cases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Common Use Cases
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/auth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication and Authorization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/ratelimit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ratelimits
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/shadow-traffic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Shadow Traffic
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/built-your-own/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Built Your Own Proxy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-develop-a-filter" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to develop a Filter
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How to develop a Filter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-pass-options-to-your-filter" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to pass options to your filter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        User documentation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-godoc" class="md-nav__link">
    <span class="md-ellipsis">
      
        Add godoc
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Filter implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writing-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Writing tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-a-debugger" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using a debugger
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Development</h1>

<h2 id="how-to-develop-a-filter">How to develop a Filter<a class="headerlink" href="#how-to-develop-a-filter" title="Permanent link">&para;</a></h2>
<p>A filter is part of a route and can change arbitrary http data in the
<code>http.Request</code> and <code>http.Response</code> path of a proxy.</p>
<p>The filter example shows a non trivial diff of a filter
implementation, that implements an authnz webhook. It shows global
settings passed via flags, user documentation, developer documentation
for library users, the filter implementation and some test
cases. Tests should test the actual filter implementation in a proxy
setup.</p>
<h3 id="how-to-pass-options-to-your-filter">How to pass options to your filter<a class="headerlink" href="#how-to-pass-options-to-your-filter" title="Permanent link">&para;</a></h3>
<p>Set a <code>default</code> and a <code>Usage</code> string as const.  Add a var to hold the
value and put the flag to the category, that makes the most sense.</p>
<p>If a filter, predicate or dataclient need <code>Options</code> passed from flags,
then you should register the filter in <code>skipper.go</code>, the main library
entrypoint. In case you do not need options from flags, use
<code>MakeRegistry()</code> in <code>./filters/builtin/builtin.go</code> to register your
filter.</p>
<div class="highlight"><pre><span></span><code><span class="gh">diff --git a/cmd/skipper/main.go b/cmd/skipper/main.go</span>
<span class="gh">index 28f18f9..4530b85 100644</span>
<span class="gd">--- a/cmd/skipper/main.go</span>
<span class="gi">+++ b/cmd/skipper/main.go</span>
<span class="gu">@@ -59,9 +59,10 @@ const (</span>
<span class="w"> </span>   defaultOAuthTokeninfoTimeout          = 2 * time.Second
<span class="w"> </span>   defaultOAuthTokenintrospectionTimeout = 2 * time.Second
<span class="gi">+   defaultWebhookTimeout                 = 2 * time.Second</span>

<span class="w"> </span>   // generic:
<span class="w"> </span>   addressUsage                         = &quot;network address that skipper should listen on&quot;
<span class="gu">@@ -141,6 +142,8 @@ const (</span>
<span class="w"> </span>   oauth2TokeninfoURLUsage              = &quot;sets the default tokeninfo URL to query information about an incoming OAuth2 token in oauth2Tokeninfo filters&quot;
<span class="w"> </span>   oauth2TokeninfoTimeoutUsage          = &quot;sets the default tokeninfo request timeout duration to 2000ms&quot;
<span class="w"> </span>   oauth2TokenintrospectionTimeoutUsage = &quot;sets the default tokenintrospection request timeout duration to 2000ms&quot;
<span class="gi">+   webhookTimeoutUsage                  = &quot;sets the webhook request timeout duration, defaults to 2s&quot;</span>
<span class="gi">+</span>
<span class="w"> </span>   // connections, timeouts:
<span class="w"> </span>   idleConnsPerHostUsage           = &quot;maximum idle connections per backend host&quot;
<span class="w"> </span>   closeIdleConnsPeriodUsage       = &quot;period of closing all idle connections in seconds or as a duration string. Not closing when less than 0&quot;
<span class="gu">@@ -243,13 +246,14 @@ var (</span>
<span class="w"> </span>   oauth2TokeninfoURL              string
<span class="w"> </span>   oauth2TokeninfoTimeout          time.Duration
<span class="w"> </span>   oauth2TokenintrospectionTimeout time.Duration
<span class="gi">+   webhookTimeout                  time.Duration</span>

<span class="w"> </span>   // connections, timeouts:
<span class="w"> </span>   idleConnsPerHost           int
<span class="gu">@@ -351,13 +355,14 @@ func init() {</span>
<span class="w"> </span>   flag.DurationVar(&amp;oauth2TokeninfoTimeout, &quot;oauth2-tokeninfo-timeout&quot;, defaultOAuthTokeninfoTimeout, oauth2TokeninfoTimeoutUsage)
<span class="w"> </span>   flag.DurationVar(&amp;oauth2TokenintrospectionTimeout, &quot;oauth2-tokenintrospect-timeout&quot;, defaultOAuthTokenintrospectionTimeout, oauth2TokenintrospectionTimeoutUsage)
<span class="gi">+   flag.DurationVar(&amp;webhookTimeout, &quot;webhook-timeout&quot;, defaultWebhookTimeout, webhookTimeoutUsage)</span>

<span class="w"> </span>   // connections, timeouts:
<span class="w"> </span>   flag.IntVar(&amp;idleConnsPerHost, &quot;idle-conns-num&quot;, proxy.DefaultIdleConnsPerHost, idleConnsPerHostUsage)
<span class="gu">@@ -536,13 +541,14 @@ func main() {</span>
<span class="w"> </span>       OAuthTokeninfoURL:              oauth2TokeninfoURL,
<span class="w"> </span>       OAuthTokeninfoTimeout:          oauth2TokeninfoTimeout,
<span class="w"> </span>       OAuthTokenintrospectionTimeout: oauth2TokenintrospectionTimeout,
<span class="gi">+       WebhookTimeout:                 webhookTimeout,</span>

<span class="w"> </span>       // connections, timeouts:
<span class="w"> </span>       IdleConnectionsPerHost:     idleConnsPerHost,

<span class="gh">diff --git a/skipper.go b/skipper.go</span>
<span class="gh">index 10d5769..da46fe0 100644</span>
<span class="gd">--- a/skipper.go</span>
<span class="gi">+++ b/skipper.go</span>
<span class="gu">@@ -443,6 +443,9 @@ type Options struct {</span>
<span class="w"> </span>   // OAuthTokenintrospectionTimeout sets timeout duration while calling oauth tokenintrospection service
<span class="w"> </span>   OAuthTokenintrospectionTimeout time.Duration

<span class="gi">+   // WebhookTimeout sets timeout duration while calling a custom webhook auth service</span>
<span class="gi">+   WebhookTimeout time.Duration</span>
<span class="gi">+</span>
<span class="w"> </span>   // MaxAuditBody sets the maximum read size of the body read by the audit log filter
<span class="w"> </span>   MaxAuditBody int
<span class="w"> </span>}
<span class="gu">@@ -677,7 +680,8 @@ func Run(o Options) error {</span>
<span class="w"> </span>       auth.NewOAuthTokenintrospectionAnyClaims(o.OAuthTokenintrospectionTimeout),
<span class="w"> </span>       auth.NewOAuthTokenintrospectionAllClaims(o.OAuthTokenintrospectionTimeout),
<span class="w"> </span>       auth.NewOAuthTokenintrospectionAnyKV(o.OAuthTokenintrospectionTimeout),
<span class="gd">-       auth.NewOAuthTokenintrospectionAllKV(o.OAuthTokenintrospectionTimeout))</span>
<span class="gi">+       auth.NewOAuthTokenintrospectionAllKV(o.OAuthTokenintrospectionTimeout),</span>
<span class="gi">+       auth.NewWebhook(o.WebhookTimeout))</span>

<span class="w"> </span>   // create a filter registry with the available filter specs registered,
<span class="w"> </span>   // and register the custom filters
</code></pre></div>
<h3 id="user-documentation">User documentation<a class="headerlink" href="#user-documentation" title="Permanent link">&para;</a></h3>
<p>Documentation for users should be done in <code>docs/</code>.</p>
<div class="highlight"><pre><span></span><code><span class="gh">diff --git a/docs/filters.md b/docs/filters.md</span>
<span class="gh">index d3bb872..a877062 100644</span>
<span class="gd">--- a/docs/filters.md</span>
<span class="gi">+++ b/docs/filters.md</span>
<span class="gu">@@ -382,6 +382,24 @@ basicAuth(&quot;/path/to/htpasswd&quot;)</span>
<span class="w"> </span>basicAuth(&quot;/path/to/htpasswd&quot;, &quot;My Website&quot;)
<span class="w"> </span>```

<span class="gi">+## webhook</span>
<span class="gi">+</span>
<span class="gi">+The `webhook` filter makes it possible to have your own authentication and</span>
<span class="gi">+authorization endpoint as a filter.</span>
<span class="gi">+</span>
<span class="gi">+Headers from the incoming request will be copied into the request that</span>
<span class="gi">+is being done to the webhook endpoint. Responses from the webhook with</span>
<span class="gi">+status code less than 300 will be authorized, rest unauthorized.</span>
<span class="gi">+</span>
<span class="gi">+Examples:</span>
<span class="gi">+</span>
<span class="gi">+```</span>
<span class="gi">+webhook(&quot;https://custom-webhook.example.org/auth&quot;)</span>
<span class="gi">+```</span>
<span class="gi">+</span>
<span class="gi">+The webhook timeout has a default of 2 seconds and can be globally</span>
<span class="gi">+changed, if skipper is started with `-webhook-timeout=2s` flag.</span>
<span class="gi">+</span>
<span class="w"> </span>## oauthTokeninfoAnyScope

<span class="w"> </span>If skipper is started with `-oauth2-tokeninfo-url` flag, you can use
</code></pre></div>
<h3 id="add-godoc">Add godoc<a class="headerlink" href="#add-godoc" title="Permanent link">&para;</a></h3>
<p>Godoc is meant for developers using skipper as library, use <code>doc.go</code>
of the package to document generic functionality, usage and library
usage.</p>
<div class="highlight"><pre><span></span><code><span class="gh">diff --git a/filters/auth/doc.go b/filters/auth/doc.go</span>
<span class="gh">index 696d3fd..1d6e3a8 100644</span>
<span class="gd">--- a/filters/auth/doc.go</span>
<span class="gi">+++ b/filters/auth/doc.go</span>
<span class="gu">@@ -318,5 +318,12 @@ filter after the auth filter.</span>
<span class="w"> </span>    a: Path(&quot;/only-allowed-audit-log&quot;) -&gt; oauthTokeninfoAnyScope(&quot;bar-w&quot;) -&gt; auditLog() -&gt; &quot;https://internal.example.org/&quot;;
<span class="w"> </span>    b: Path(&quot;/all-access-requests-audit-log&quot;) -&gt; auditLog() -&gt; oauthTokeninfoAnyScope(&quot;foo-r&quot;) -&gt; &quot;https://internal.example.org/&quot;;

<span class="gi">+Webhook - webhook() filter</span>
<span class="gi">+</span>
<span class="gi">+The filter webhook allows you to have a custom authentication and</span>
<span class="gi">+authorization endpoint for a route.</span>
<span class="gi">+</span>
<span class="gi">+    a: Path(&quot;/only-allowed-by-webhook&quot;) -&gt; webhook(&quot;https://custom-webhook.example.org/auth&quot;) -&gt; &quot;https://protected-backend.example.org/&quot;;</span>
<span class="gi">+</span>
<span class="w"> </span>*/
<span class="w"> </span>package auth
</code></pre></div>
<h3 id="filter-implementation">Filter implementation<a class="headerlink" href="#filter-implementation" title="Permanent link">&para;</a></h3>
<p>A filter can modify the incoming <code>http.Request</code> before calling the
backend and the outgoing <code>http.Response</code> from the backend to the client.</p>
<p>A filter consists of at least two types a <code>spec</code> and a <code>filter</code>.
Spec consists of everything that is needed and known before a user
will instantiate a filter.</p>
<p>A spec will be created in the bootstrap procedure of a skipper
process. A spec has to satisfy the <code>Spec</code> interface <code>Name() string</code> and
<code>CreateFilter([]interface{}) (filters.Filter, error)</code>.</p>
<p>The actual filter implementation has to satisfy the <code>Filter</code>
interface <code>Request(filters.FilterContext)</code> and <code>Response(filters.FilterContext)</code>.</p>
<div class="highlight"><pre><span></span><code><span class="gh">diff --git a/filters/auth/webhook.go b/filters/auth/webhook.go</span>
new file mode 100644
<span class="gh">index 0000000..f0632a6</span>
<span class="gd">--- /dev/null</span>
<span class="gi">+++ b/filters/auth/webhook.go</span>
<span class="gu">@@ -0,0 +1,84 @@</span>
<span class="gi">+package auth</span>
<span class="gi">+</span>
<span class="gi">+import (</span>
<span class="gi">+   &quot;net/http&quot;</span>
<span class="gi">+   &quot;time&quot;</span>
<span class="gi">+</span>
<span class="gi">+   &quot;github.com/zalando/skipper/filters&quot;</span>
<span class="gi">+)</span>
<span class="gi">+</span>
<span class="gi">+const (</span>
<span class="gi">+   WebhookName = &quot;webhook&quot;</span>
<span class="gi">+)</span>
<span class="gi">+</span>
<span class="gi">+type (</span>
<span class="gi">+   webhookSpec struct {</span>
<span class="gi">+       Timeout time.Duration</span>
<span class="gi">+   }</span>
<span class="gi">+   webhookFilter struct {</span>
<span class="gi">+       authClient *authClient</span>
<span class="gi">+   }</span>
<span class="gi">+)</span>
<span class="gi">+</span>
<span class="gi">+// NewWebhook creates a new auth filter specification</span>
<span class="gi">+// to validate authorization for requests.</span>
<span class="gi">+func NewWebhook(d time.Duration) filters.Spec {</span>
<span class="gi">+   return &amp;webhookSpec{Timeout: d}</span>
<span class="gi">+}</span>
<span class="gi">+</span>
<span class="gi">+func (*webhookSpec) Name() string {</span>
<span class="gi">+   return WebhookName</span>
<span class="gi">+}</span>
<span class="gi">+</span>
<span class="gi">+// CreateFilter creates an auth filter. The first argument is an URL</span>
<span class="gi">+// string.</span>
<span class="gi">+//</span>
<span class="gi">+//     s.CreateFilter(&quot;https://my-auth-service.example.org/auth&quot;)</span>
<span class="gi">+//</span>
<span class="gi">+func (ws *webhookSpec) CreateFilter(args []interface{}) (filters.Filter, error) {</span>
<span class="gi">+   if l := len(args); l == 0 || l &gt; 2 {</span>
<span class="gi">+       return nil, filters.ErrInvalidFilterParameters</span>
<span class="gi">+   }</span>
<span class="gi">+</span>
<span class="gi">+   s, ok := args[0].(string)</span>
<span class="gi">+   if !ok {</span>
<span class="gi">+       return nil, filters.ErrInvalidFilterParameters</span>
<span class="gi">+   }</span>
<span class="gi">+</span>
<span class="gi">+   ac, err := newAuthClient(s, ws.Timeout)</span>
<span class="gi">+   if err != nil {</span>
<span class="gi">+       return nil, filters.ErrInvalidFilterParameters</span>
<span class="gi">+   }</span>
<span class="gi">+</span>
<span class="gi">+   return &amp;webhookFilter{authClient: ac}, nil</span>
<span class="gi">+}</span>
<span class="gi">+</span>
<span class="gi">+func copyHeader(to, from http.Header) {</span>
<span class="gi">+   for k, v := range from {</span>
<span class="gi">+       to[http.CanonicalHeaderKey(k)] = v</span>
<span class="gi">+   }</span>
<span class="gi">+}</span>
<span class="gi">+</span>
<span class="gi">+func (f *webhookFilter) Request(ctx filters.FilterContext) {</span>
<span class="gi">+   statusCode, err := f.authClient.getWebhook(ctx.Request())</span>
<span class="gi">+   if err != nil {</span>
<span class="gi">+       unauthorized(ctx, WebhookName, authServiceAccess, f.authClient.url.Hostname())</span>
<span class="gi">+   }</span>
<span class="gi">+   // redirects, auth errors, webhook errors</span>
<span class="gi">+   if statusCode &gt;= 300 {</span>
<span class="gi">+       unauthorized(ctx, WebhookName, invalidAccess, f.authClient.url.Hostname())</span>
<span class="gi">+   }</span>
<span class="gi">+   authorized(ctx, WebhookName)</span>
<span class="gi">+}</span>
<span class="gi">+</span>
<span class="gi">+func (*webhookFilter) Response(filters.FilterContext) {}</span>
</code></pre></div>
<h3 id="writing-tests">Writing tests<a class="headerlink" href="#writing-tests" title="Permanent link">&para;</a></h3>
<p>Skipper uses normal table driven Go tests without frameworks.</p>
<p>This example filter test creates a backend, an auth service to be
called by our filter, and a filter configured by our table driven test.</p>
<p>In general we use real backends with dynamic port allocations. We call
these and inspect the <code>http.Response</code> to check, if we get expected
results for invalid and valid data.</p>
<p>Skipper has some helpers to create the test proxy in the <code>proxytest</code>
package. Backends can be created with <code>httptest.NewServer</code> as in the
example below.</p>
<div class="highlight"><pre><span></span><code><span class="gh">diff --git a/filters/auth/webhook_test.go b/filters/auth/webhook_test.go</span>
new file mode 100644
<span class="gh">index 0000000..d43c4ea</span>
<span class="gd">--- /dev/null</span>
<span class="gi">+++ b/filters/auth/webhook_test.go</span>
<span class="gu">@@ -0,0 +1,128 @@</span>
<span class="gi">+package auth</span>
<span class="gi">+</span>
<span class="gi">+import (</span>
<span class="gi">+   &quot;fmt&quot;</span>
<span class="gi">+   &quot;io&quot;</span>
<span class="gi">+   &quot;net/http&quot;</span>
<span class="gi">+   &quot;net/http/httptest&quot;</span>
<span class="gi">+   &quot;net/url&quot;</span>
<span class="gi">+   &quot;testing&quot;</span>
<span class="gi">+   &quot;time&quot;</span>
<span class="gi">+</span>
<span class="gi">+   &quot;github.com/zalando/skipper/eskip&quot;</span>
<span class="gi">+   &quot;github.com/zalando/skipper/filters&quot;</span>
<span class="gi">+   &quot;github.com/zalando/skipper/proxy/proxytest&quot;</span>
<span class="gi">+)</span>
<span class="gi">+</span>
<span class="gi">+func TestWebhook(t *testing.T) {</span>
<span class="gi">+   for _, ti := range []struct {</span>
<span class="gi">+       msg        string</span>
<span class="gi">+       token      string</span>
<span class="gi">+       expected   int</span>
<span class="gi">+       authorized bool</span>
<span class="gi">+       timeout    bool</span>
<span class="gi">+   }{{</span>
<span class="gi">+       msg:        &quot;invalid-token-should-be-unauthorized&quot;,</span>
<span class="gi">+       token:      &quot;invalid-token&quot;,</span>
<span class="gi">+       expected:   http.StatusUnauthorized,</span>
<span class="gi">+       authorized: false,</span>
<span class="gi">+   }, {</span>
<span class="gi">+       msg:        &quot;valid-token-should-be-authorized&quot;,</span>
<span class="gi">+       token:      testToken,</span>
<span class="gi">+       expected:   http.StatusOK,</span>
<span class="gi">+       authorized: true,</span>
<span class="gi">+   }, {</span>
<span class="gi">+       msg:        &quot;webhook-timeout-should-be-unauthorized&quot;,</span>
<span class="gi">+       token:      testToken,</span>
<span class="gi">+       expected:   http.StatusUnauthorized,</span>
<span class="gi">+       authorized: false,</span>
<span class="gi">+       timeout:    true,</span>
<span class="gi">+   }} {</span>
<span class="gi">+       t.Run(ti.msg, func(t *testing.T) {</span>
<span class="gi">+           backend := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, _ *http.Request) {</span>
<span class="gi">+               w.WriteHeader(http.StatusOK)</span>
<span class="gi">+               io.WriteString(w, &quot;Hello from backend&quot;)</span>
<span class="gi">+               return</span>
<span class="gi">+           }))</span>
<span class="gi">+           defer backend.Close()</span>
<span class="gi">+</span>
<span class="gi">+           authServer := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {</span>
<span class="gi">+               if ti.timeout {</span>
<span class="gi">+                   time.Sleep(time.Second + time.Millisecond)</span>
<span class="gi">+               }</span>
<span class="gi">+</span>
<span class="gi">+               if r.Method != &quot;GET&quot; {</span>
<span class="gi">+                   w.WriteHeader(489)</span>
<span class="gi">+                   io.WriteString(w, &quot;FAIL - not a GET request&quot;)</span>
<span class="gi">+                   return</span>
<span class="gi">+               }</span>
<span class="gi">+</span>
<span class="gi">+               tok := r.Header.Get(authHeaderName)</span>
<span class="gi">+               tok = tok[len(authHeaderPrefix):len(tok)]</span>
<span class="gi">+               switch tok {</span>
<span class="gi">+               case testToken:</span>
<span class="gi">+                   w.WriteHeader(200)</span>
<span class="gi">+                   fmt.Fprintln(w, &quot;OK - Got token: &quot;+tok)</span>
<span class="gi">+                   return</span>
<span class="gi">+               }</span>
<span class="gi">+               w.WriteHeader(402)                            //http.StatusUnauthorized)</span>
<span class="gi">+               fmt.Fprintln(w, &quot;Unauthorized - Got token: &quot;) //+tok)</span>
<span class="gi">+           }))</span>
<span class="gi">+           defer authServer.Close()</span>
<span class="gi">+</span>
<span class="gi">+           spec := NewWebhook(time.Second)</span>
<span class="gi">+</span>
<span class="gi">+           args := []interface{}{</span>
<span class="gi">+               &quot;http://&quot; + authServer.Listener.Addr().String(),</span>
<span class="gi">+           }</span>
<span class="gi">+           f, err := spec.CreateFilter(args)</span>
<span class="gi">+           if err != nil {</span>
<span class="gi">+               t.Errorf(&quot;error in creating filter for %s: %v&quot;, ti.msg, err)</span>
<span class="gi">+               return</span>
<span class="gi">+           }</span>
<span class="gi">+</span>
<span class="gi">+           f2 := f.(*webhookFilter)</span>
<span class="gi">+           defer f2.Close()</span>
<span class="gi">+</span>
<span class="gi">+           fr := make(filters.Registry)</span>
<span class="gi">+           fr.Register(spec)</span>
<span class="gi">+           r := &amp;eskip.Route{Filters: []*eskip.Filter{{Name: spec.Name(), Args: args}}, Backend: backend.URL}</span>
<span class="gi">+</span>
<span class="gi">+           proxy := proxytest.New(fr, r)</span>
<span class="gi">+           defer proxy.Close()</span>
<span class="gi">+</span>
<span class="gi">+           reqURL, err := url.Parse(proxy.URL)</span>
<span class="gi">+           if err != nil {</span>
<span class="gi">+               t.Errorf(&quot;Failed to parse url %s: %v&quot;, proxy.URL, err)</span>
<span class="gi">+               return</span>
<span class="gi">+           }</span>
<span class="gi">+</span>
<span class="gi">+           req, err := http.NewRequest(&quot;GET&quot;, reqURL.String(), nil)</span>
<span class="gi">+           if err != nil {</span>
<span class="gi">+               t.Errorf(&quot;failed to create request %v&quot;, err)</span>
<span class="gi">+               return</span>
<span class="gi">+           }</span>
<span class="gi">+           req.Header.Set(authHeaderName, authHeaderPrefix+ti.token)</span>
<span class="gi">+</span>
<span class="gi">+           rsp, err := http.DefaultClient.Do(req)</span>
<span class="gi">+           if err != nil {</span>
<span class="gi">+               t.Errorf(&quot;failed to get response: %v&quot;, err)</span>
<span class="gi">+               return</span>
<span class="gi">+           }</span>
<span class="gi">+           defer rsp.Body.Close()</span>
<span class="gi">+</span>
<span class="gi">+           buf := make([]byte, 128)</span>
<span class="gi">+           var n int</span>
<span class="gi">+           if n, err = rsp.Body.Read(buf); err != nil &amp;&amp; err != io.EOF {</span>
<span class="gi">+               t.Errorf(&quot;Could not read response body: %v&quot;, err)</span>
<span class="gi">+               return</span>
<span class="gi">+           }</span>
<span class="gi">+</span>
<span class="gi">+           t.Logf(&quot;%d %d&quot;, rsp.StatusCode, ti.expected)</span>
<span class="gi">+           if rsp.StatusCode != ti.expected {</span>
<span class="gi">+               t.Errorf(&quot;unexpected status code: %v != %v %d %s&quot;, rsp.StatusCode, ti.expected, n, buf)</span>
<span class="gi">+               return</span>
<span class="gi">+           }</span>
<span class="gi">+       })</span>
<span class="gi">+   }</span>
<span class="gi">+}</span>
</code></pre></div>
<h3 id="using-a-debugger">Using a debugger<a class="headerlink" href="#using-a-debugger" title="Permanent link">&para;</a></h3>
<p>Skipper supports plugins and to offer this support it uses the <a href="https://golang.org/pkg/plugin/"><code>plugin</code></a>
library. Due to <a href="https://github.com/golang/go/issues/23733">Go compiler issue #23733</a>, a
debugger cannot be used. This issue will be fixed in Go 1.12 but until then the only workaround is to remove
references to the <code>plugin</code> library. The following patch can be used for debugging.</p>
<div class="highlight"><pre><span></span><code><span class="gh">diff --git a/plugins.go b/plugins.go</span>
<span class="gh">index 837b6cf..aa69f09 100644</span>
<span class="gd">--- a/plugins.go</span>
<span class="gi">+++ b/plugins.go</span>
<span class="gu">@@ -1,5 +1,6 @@</span>
<span class="w"> </span>package skipper

<span class="gi">+/*</span>
<span class="w"> </span>import (
<span class="w"> </span>   &quot;fmt&quot;
<span class="w"> </span>   &quot;os&quot;
<span class="gu">@@ -13,8 +14,13 @@ import (</span>
<span class="w"> </span>   &quot;github.com/zalando/skipper/filters&quot;
<span class="w"> </span>   &quot;github.com/zalando/skipper/routing&quot;
<span class="w"> </span>)
<span class="gi">+*/</span>

<span class="w"> </span>func (o *Options) findAndLoadPlugins() error {
<span class="gi">+   return nil</span>
<span class="gi">+}</span>
<span class="gi">+</span>
<span class="gi">+/*</span>
<span class="w"> </span>   found := make(map[string]string)
<span class="w"> </span>   done := make(map[string][]string)

<span class="gu">@@ -366,3 +372,4 @@ func readPluginConfig(plugin string) (conf []string, err error) {</span>
<span class="w"> </span>   }
<span class="w"> </span>   return conf, nil
<span class="w"> </span>}
<span class="gi">+*/</span>
</code></pre></div>
<p>The patch can be applied with the <code>git apply $PATCH_FILE</code> command. Please do not commit the
modified <code>plugins.go</code> along with your changes.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>