
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://opensource.zalando.com/skipper/reference/filters/">
      
      
        <link rel="prev" href="../..">
      
      
        <link rel="next" href="../predicates/">
      
      
      <link rel="icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Filters - Skipper</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#skipper-filters" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Skipper" class="md-header__button md-logo" aria-label="Skipper" data-md-component="logo">
      
  <img src="../../skipper-h180.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Skipper
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Filters
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/zalando/skipper/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Skipper" class="md-nav__button md-logo" aria-label="Skipper" data-md-component="logo">
      
  <img src="../../skipper-h180.png" alt="logo">

    </a>
    Skipper
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zalando/skipper/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Filters
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Filters
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#template-placeholders" class="md-nav__link">
    <span class="md-ellipsis">
      Template placeholders
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#status" class="md-nav__link">
    <span class="md-ellipsis">
      status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comment" class="md-nav__link">
    <span class="md-ellipsis">
      comment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#annotate" class="md-nav__link">
    <span class="md-ellipsis">
      annotate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-headers" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Headers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTP Headers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preservehost" class="md-nav__link">
    <span class="md-ellipsis">
      preserveHost
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modrequestheader" class="md-nav__link">
    <span class="md-ellipsis">
      modRequestHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setrequestheader" class="md-nav__link">
    <span class="md-ellipsis">
      setRequestHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appendrequestheader" class="md-nav__link">
    <span class="md-ellipsis">
      appendRequestHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#droprequestheader" class="md-nav__link">
    <span class="md-ellipsis">
      dropRequestHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modresponseheader" class="md-nav__link">
    <span class="md-ellipsis">
      modResponseHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setresponseheader" class="md-nav__link">
    <span class="md-ellipsis">
      setResponseHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appendresponseheader" class="md-nav__link">
    <span class="md-ellipsis">
      appendResponseHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dropresponseheader" class="md-nav__link">
    <span class="md-ellipsis">
      dropResponseHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setcontextrequestheader" class="md-nav__link">
    <span class="md-ellipsis">
      setContextRequestHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appendcontextrequestheader" class="md-nav__link">
    <span class="md-ellipsis">
      appendContextRequestHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setcontextresponseheader" class="md-nav__link">
    <span class="md-ellipsis">
      setContextResponseHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appendcontextresponseheader" class="md-nav__link">
    <span class="md-ellipsis">
      appendContextResponseHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copyrequestheader" class="md-nav__link">
    <span class="md-ellipsis">
      copyRequestHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copyresponseheader" class="md-nav__link">
    <span class="md-ellipsis">
      copyResponseHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corsorigin" class="md-nav__link">
    <span class="md-ellipsis">
      corsOrigin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#headertoquery" class="md-nav__link">
    <span class="md-ellipsis">
      headerToQuery
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flowid" class="md-nav__link">
    <span class="md-ellipsis">
      flowId
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xforward" class="md-nav__link">
    <span class="md-ellipsis">
      xforward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xforwardfirst" class="md-nav__link">
    <span class="md-ellipsis">
      xforwardFirst
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-path" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Path
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTP Path">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modpath" class="md-nav__link">
    <span class="md-ellipsis">
      modPath
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setpath" class="md-nav__link">
    <span class="md-ellipsis">
      setPath
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-redirect" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Redirect
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTP Redirect">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#redirectto" class="md-nav__link">
    <span class="md-ellipsis">
      redirectTo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redirecttolower" class="md-nav__link">
    <span class="md-ellipsis">
      redirectToLower
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-query" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Query
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTP Query">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stripquery" class="md-nav__link">
    <span class="md-ellipsis">
      stripQuery
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setquery" class="md-nav__link">
    <span class="md-ellipsis">
      setQuery
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dropquery" class="md-nav__link">
    <span class="md-ellipsis">
      dropQuery
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#querytoheader" class="md-nav__link">
    <span class="md-ellipsis">
      queryToHeader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls" class="md-nav__link">
    <span class="md-ellipsis">
      TLS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TLS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tlspassclientcertificates" class="md-nav__link">
    <span class="md-ellipsis">
      tlsPassClientCertificates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diagnostics" class="md-nav__link">
    <span class="md-ellipsis">
      Diagnostics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Diagnostics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#randomcontent" class="md-nav__link">
    <span class="md-ellipsis">
      randomContent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repeatcontent" class="md-nav__link">
    <span class="md-ellipsis">
      repeatContent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repeatcontenthex" class="md-nav__link">
    <span class="md-ellipsis">
      repeatContentHex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wrapcontent" class="md-nav__link">
    <span class="md-ellipsis">
      wrapContent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wrapcontenthex" class="md-nav__link">
    <span class="md-ellipsis">
      wrapContentHex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#latency" class="md-nav__link">
    <span class="md-ellipsis">
      latency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bandwidth" class="md-nav__link">
    <span class="md-ellipsis">
      bandwidth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunks" class="md-nav__link">
    <span class="md-ellipsis">
      chunks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backendlatency" class="md-nav__link">
    <span class="md-ellipsis">
      backendLatency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backendbandwidth" class="md-nav__link">
    <span class="md-ellipsis">
      backendBandwidth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backendchunks" class="md-nav__link">
    <span class="md-ellipsis">
      backendChunks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tarpit" class="md-nav__link">
    <span class="md-ellipsis">
      tarpit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#absorb" class="md-nav__link">
    <span class="md-ellipsis">
      absorb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#absorbsilent" class="md-nav__link">
    <span class="md-ellipsis">
      absorbSilent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uniformrequestlatency" class="md-nav__link">
    <span class="md-ellipsis">
      uniformRequestLatency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normalrequestlatency" class="md-nav__link">
    <span class="md-ellipsis">
      normalRequestLatency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#histogramrequestlatency" class="md-nav__link">
    <span class="md-ellipsis">
      histogramRequestLatency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uniformresponselatency" class="md-nav__link">
    <span class="md-ellipsis">
      uniformResponseLatency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normalresponselatency" class="md-nav__link">
    <span class="md-ellipsis">
      normalResponseLatency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#histogramresponselatency" class="md-nav__link">
    <span class="md-ellipsis">
      histogramResponseLatency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logheader" class="md-nav__link">
    <span class="md-ellipsis">
      logHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logbody" class="md-nav__link">
    <span class="md-ellipsis">
      logBody
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timeout" class="md-nav__link">
    <span class="md-ellipsis">
      Timeout
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Timeout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backendtimeout" class="md-nav__link">
    <span class="md-ellipsis">
      backendTimeout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#readtimeout" class="md-nav__link">
    <span class="md-ellipsis">
      readTimeout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writetimeout" class="md-nav__link">
    <span class="md-ellipsis">
      writeTimeout
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shadow-traffic" class="md-nav__link">
    <span class="md-ellipsis">
      Shadow Traffic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shadow Traffic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tee" class="md-nav__link">
    <span class="md-ellipsis">
      tee
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#teenf" class="md-nav__link">
    <span class="md-ellipsis">
      teenf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#teeloopback" class="md-nav__link">
    <span class="md-ellipsis">
      teeLoopback
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-body" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Body
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTP Body">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compress" class="md-nav__link">
    <span class="md-ellipsis">
      compress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decompress" class="md-nav__link">
    <span class="md-ellipsis">
      decompress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static" class="md-nav__link">
    <span class="md-ellipsis">
      static
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inlinecontent" class="md-nav__link">
    <span class="md-ellipsis">
      inlineContent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inlinecontentifstatus" class="md-nav__link">
    <span class="md-ellipsis">
      inlineContentIfStatus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blockcontent" class="md-nav__link">
    <span class="md-ellipsis">
      blockContent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blockcontenthex" class="md-nav__link">
    <span class="md-ellipsis">
      blockContentHex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sed" class="md-nav__link">
    <span class="md-ellipsis">
      sed
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memory-handling-and-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      Memory handling and limitations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seddelim" class="md-nav__link">
    <span class="md-ellipsis">
      sedDelim
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sedrequest" class="md-nav__link">
    <span class="md-ellipsis">
      sedRequest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sedrequestdelim" class="md-nav__link">
    <span class="md-ellipsis">
      sedRequestDelim
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-and-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication and Authorization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication and Authorization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basicauth" class="md-nav__link">
    <span class="md-ellipsis">
      basicAuth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webhook" class="md-nav__link">
    <span class="md-ellipsis">
      webhook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tokeninfo" class="md-nav__link">
    <span class="md-ellipsis">
      Tokeninfo
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tokeninfo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oauthtokeninfoanyscope" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokeninfoAnyScope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthtokeninfoallscope" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokeninfoAllScope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthtokeninfoanykv" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokeninfoAnyKV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthtokeninfoallkv" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokeninfoAllKV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthtokeninfovalidate" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokeninfoValidate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tokenintrospection" class="md-nav__link">
    <span class="md-ellipsis">
      Tokenintrospection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tokenintrospection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oauthtokenintrospectionanyclaims" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokenintrospectionAnyClaims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthtokenintrospectionallclaims" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokenintrospectionAllClaims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthtokenintrospectionanykv" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokenintrospectionAnyKV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthtokenintrospectionallkv" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokenintrospectionAllKV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secureoauthtokenintrospectionanyclaims" class="md-nav__link">
    <span class="md-ellipsis">
      secureOauthTokenintrospectionAnyClaims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secureoauthtokenintrospectionallclaims" class="md-nav__link">
    <span class="md-ellipsis">
      secureOauthTokenintrospectionAllClaims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secureoauthtokenintrospectionanykv" class="md-nav__link">
    <span class="md-ellipsis">
      secureOauthTokenintrospectionAnyKV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secureoauthtokenintrospectionallkv" class="md-nav__link">
    <span class="md-ellipsis">
      secureOauthTokenintrospectionAllKV
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwt" class="md-nav__link">
    <span class="md-ellipsis">
      JWT
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JWT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jwtvalidation" class="md-nav__link">
    <span class="md-ellipsis">
      jwtValidation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwtmetrics" class="md-nav__link">
    <span class="md-ellipsis">
      jwtMetrics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forward-token-data" class="md-nav__link">
    <span class="md-ellipsis">
      Forward Token Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Forward Token Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#forwardtoken" class="md-nav__link">
    <span class="md-ellipsis">
      forwardToken
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forwardtokenfield" class="md-nav__link">
    <span class="md-ellipsis">
      forwardTokenField
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauth2" class="md-nav__link">
    <span class="md-ellipsis">
      OAuth2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OAuth2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oauthgrant" class="md-nav__link">
    <span class="md-ellipsis">
      oauthGrant
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grantcallback" class="md-nav__link">
    <span class="md-ellipsis">
      grantCallback
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grantlogout" class="md-nav__link">
    <span class="md-ellipsis">
      grantLogout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grantclaimsquery" class="md-nav__link">
    <span class="md-ellipsis">
      grantClaimsQuery
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openid-connect" class="md-nav__link">
    <span class="md-ellipsis">
      OpenID Connect
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OpenID Connect">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oauthoidcuserinfo" class="md-nav__link">
    <span class="md-ellipsis">
      oauthOidcUserInfo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthoidcanyclaims" class="md-nav__link">
    <span class="md-ellipsis">
      oauthOidcAnyClaims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthoidcallclaims" class="md-nav__link">
    <span class="md-ellipsis">
      oauthOidcAllClaims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oidcclaimsquery" class="md-nav__link">
    <span class="md-ellipsis">
      oidcClaimsQuery
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open-policy-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Open Policy Agent
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Open Policy Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#opaauthorizerequest" class="md-nav__link">
    <span class="md-ellipsis">
      opaAuthorizeRequest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opaauthorizerequestwithbody" class="md-nav__link">
    <span class="md-ellipsis">
      opaAuthorizeRequestWithBody
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opaserveresponse" class="md-nav__link">
    <span class="md-ellipsis">
      opaServeResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opaserveresponsewithreqbody" class="md-nav__link">
    <span class="md-ellipsis">
      opaServeResponseWithReqBody
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#awssigv4" class="md-nav__link">
    <span class="md-ellipsis">
      awsSigv4
    </span>
  </a>
  
    <nav class="md-nav" aria-label="awsSigv4">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memory-consideration" class="md-nav__link">
    <span class="md-ellipsis">
      Memory consideration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overwriting-ioreadcloser" class="md-nav__link">
    <span class="md-ellipsis">
      Overwriting io.ReadCloser
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cookie-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Cookie Handling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cookie Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#droprequestcookie" class="md-nav__link">
    <span class="md-ellipsis">
      dropRequestCookie
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dropresponsecookie" class="md-nav__link">
    <span class="md-ellipsis">
      dropResponseCookie
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requestcookie" class="md-nav__link">
    <span class="md-ellipsis">
      requestCookie
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#responsecookie" class="md-nav__link">
    <span class="md-ellipsis">
      responseCookie
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jscookie" class="md-nav__link">
    <span class="md-ellipsis">
      jsCookie
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#circuit-breakers" class="md-nav__link">
    <span class="md-ellipsis">
      Circuit Breakers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Circuit Breakers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consecutivebreaker" class="md-nav__link">
    <span class="md-ellipsis">
      consecutiveBreaker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ratebreaker" class="md-nav__link">
    <span class="md-ellipsis">
      rateBreaker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disablebreaker" class="md-nav__link">
    <span class="md-ellipsis">
      disableBreaker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-limit" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rate Limit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#localratelimit" class="md-nav__link">
    <span class="md-ellipsis">
      localRatelimit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clientratelimit" class="md-nav__link">
    <span class="md-ellipsis">
      clientRatelimit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ratelimit" class="md-nav__link">
    <span class="md-ellipsis">
      ratelimit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clusterclientratelimit" class="md-nav__link">
    <span class="md-ellipsis">
      clusterClientRatelimit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clusterratelimit" class="md-nav__link">
    <span class="md-ellipsis">
      clusterRatelimit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backendratelimit" class="md-nav__link">
    <span class="md-ellipsis">
      backendRatelimit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clusterleakybucketratelimit" class="md-nav__link">
    <span class="md-ellipsis">
      clusterLeakyBucketRatelimit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ratelimitfailclosed" class="md-nav__link">
    <span class="md-ellipsis">
      ratelimitFailClosed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-shedding" class="md-nav__link">
    <span class="md-ellipsis">
      Load Shedding
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Load Shedding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#admissioncontrol" class="md-nav__link">
    <span class="md-ellipsis">
      admissionControl
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lua" class="md-nav__link">
    <span class="md-ellipsis">
      lua
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logs" class="md-nav__link">
    <span class="md-ellipsis">
      Logs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Logs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#accesslogdisabled" class="md-nav__link">
    <span class="md-ellipsis">
      accessLogDisabled
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disableaccesslog" class="md-nav__link">
    <span class="md-ellipsis">
      disableAccessLog
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enableaccesslog" class="md-nav__link">
    <span class="md-ellipsis">
      enableAccessLog
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auditlog" class="md-nav__link">
    <span class="md-ellipsis">
      auditLog
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unverifiedauditlog" class="md-nav__link">
    <span class="md-ellipsis">
      unverifiedAuditLog
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend" class="md-nav__link">
    <span class="md-ellipsis">
      Backend
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Backend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backendisproxy" class="md-nav__link">
    <span class="md-ellipsis">
      backendIsProxy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdynamicbackendhostfromheader" class="md-nav__link">
    <span class="md-ellipsis">
      setDynamicBackendHostFromHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdynamicbackendschemefromheader" class="md-nav__link">
    <span class="md-ellipsis">
      setDynamicBackendSchemeFromHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdynamicbackendurlfromheader" class="md-nav__link">
    <span class="md-ellipsis">
      setDynamicBackendUrlFromHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdynamicbackendhost" class="md-nav__link">
    <span class="md-ellipsis">
      setDynamicBackendHost
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdynamicbackendscheme" class="md-nav__link">
    <span class="md-ellipsis">
      setDynamicBackendScheme
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdynamicbackendurl" class="md-nav__link">
    <span class="md-ellipsis">
      setDynamicBackendUrl
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apiusagemonitoring" class="md-nav__link">
    <span class="md-ellipsis">
      apiUsageMonitoring
    </span>
  </a>
  
    <nav class="md-nav" aria-label="apiUsageMonitoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#available-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Available Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Available Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#endpoint-related-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Endpoint Related Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-related-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Client Related Metrics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Filter Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#originmarker" class="md-nav__link">
    <span class="md-ellipsis">
      originMarker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scheduler" class="md-nav__link">
    <span class="md-ellipsis">
      Scheduler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scheduler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fifo" class="md-nav__link">
    <span class="md-ellipsis">
      fifo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fifowithbody" class="md-nav__link">
    <span class="md-ellipsis">
      fifoWithBody
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lifo" class="md-nav__link">
    <span class="md-ellipsis">
      lifo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lifogroup" class="md-nav__link">
    <span class="md-ellipsis">
      lifoGroup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rfc-compliance" class="md-nav__link">
    <span class="md-ellipsis">
      RFC Compliance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RFC Compliance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rfchost" class="md-nav__link">
    <span class="md-ellipsis">
      rfcHost
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rfcpath" class="md-nav__link">
    <span class="md-ellipsis">
      rfcPath
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#egress" class="md-nav__link">
    <span class="md-ellipsis">
      Egress
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Egress">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setrequestheaderfromsecret" class="md-nav__link">
    <span class="md-ellipsis">
      setRequestHeaderFromSecret
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bearerinjector" class="md-nav__link">
    <span class="md-ellipsis">
      bearerinjector
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#open-tracing" class="md-nav__link">
    <span class="md-ellipsis">
      Open Tracing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Open Tracing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tracingbaggagetotag" class="md-nav__link">
    <span class="md-ellipsis">
      tracingBaggageToTag
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#statebagtotag" class="md-nav__link">
    <span class="md-ellipsis">
      stateBagToTag
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracingtag" class="md-nav__link">
    <span class="md-ellipsis">
      tracingTag
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracingtagfromresponse" class="md-nav__link">
    <span class="md-ellipsis">
      tracingTagFromResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracingtagfromresponseifstatus" class="md-nav__link">
    <span class="md-ellipsis">
      tracingTagFromResponseIfStatus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracingspanname" class="md-nav__link">
    <span class="md-ellipsis">
      tracingSpanName
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-balancing" class="md-nav__link">
    <span class="md-ellipsis">
      Load Balancing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Load Balancing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fadein" class="md-nav__link">
    <span class="md-ellipsis">
      fadeIn
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fadeIn">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#warning-on-fadein-and-rolling-restarts" class="md-nav__link">
    <span class="md-ellipsis">
      Warning on fadeIn and Rolling Restarts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#endpointcreated" class="md-nav__link">
    <span class="md-ellipsis">
      endpointCreated
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consistenthashkey" class="md-nav__link">
    <span class="md-ellipsis">
      consistentHashKey
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consistenthashbalancefactor" class="md-nav__link">
    <span class="md-ellipsis">
      consistentHashBalanceFactor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../predicates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Predicates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backends
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../egress/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Egress
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scripts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scripts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plugins
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../routing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Routing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10" >
        
          
          <label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Data Clients
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_10">
            <span class="md-nav__icon md-icon"></span>
            Data Clients
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-clients/eskip-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Eskip File
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-clients/eskip-remote/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Remote Eskip
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-clients/route-string/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Route String
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-clients/kubernetes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-clients/etcd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Etcd
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11" >
        
          
          <label class="md-nav__link" for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Operation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_11">
            <span class="md-nav__icon md-icon"></span>
            Operation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/operation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Operation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/ingress-controller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ingress Controller Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/ingress-usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ingress Usage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/ingress-backends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ingress Backends
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/routegroups/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RouteGroups
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/routegroup-crd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RouteGroup CRD Semantics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/routegroup-validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RouteGroup Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/east-west-usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    East-West aka svc-to-svc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/external-addresses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    External Addresses aka External Name
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/common-use-cases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Common Use Cases
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/auth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authentication and Authorization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/ratelimit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ratelimits
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/shadow-traffic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shadow Traffic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Operations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/built-your-own/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Built Your Own Proxy
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#template-placeholders" class="md-nav__link">
    <span class="md-ellipsis">
      Template placeholders
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#status" class="md-nav__link">
    <span class="md-ellipsis">
      status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comment" class="md-nav__link">
    <span class="md-ellipsis">
      comment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#annotate" class="md-nav__link">
    <span class="md-ellipsis">
      annotate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-headers" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Headers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTP Headers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preservehost" class="md-nav__link">
    <span class="md-ellipsis">
      preserveHost
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modrequestheader" class="md-nav__link">
    <span class="md-ellipsis">
      modRequestHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setrequestheader" class="md-nav__link">
    <span class="md-ellipsis">
      setRequestHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appendrequestheader" class="md-nav__link">
    <span class="md-ellipsis">
      appendRequestHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#droprequestheader" class="md-nav__link">
    <span class="md-ellipsis">
      dropRequestHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modresponseheader" class="md-nav__link">
    <span class="md-ellipsis">
      modResponseHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setresponseheader" class="md-nav__link">
    <span class="md-ellipsis">
      setResponseHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appendresponseheader" class="md-nav__link">
    <span class="md-ellipsis">
      appendResponseHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dropresponseheader" class="md-nav__link">
    <span class="md-ellipsis">
      dropResponseHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setcontextrequestheader" class="md-nav__link">
    <span class="md-ellipsis">
      setContextRequestHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appendcontextrequestheader" class="md-nav__link">
    <span class="md-ellipsis">
      appendContextRequestHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setcontextresponseheader" class="md-nav__link">
    <span class="md-ellipsis">
      setContextResponseHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#appendcontextresponseheader" class="md-nav__link">
    <span class="md-ellipsis">
      appendContextResponseHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copyrequestheader" class="md-nav__link">
    <span class="md-ellipsis">
      copyRequestHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copyresponseheader" class="md-nav__link">
    <span class="md-ellipsis">
      copyResponseHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#corsorigin" class="md-nav__link">
    <span class="md-ellipsis">
      corsOrigin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#headertoquery" class="md-nav__link">
    <span class="md-ellipsis">
      headerToQuery
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flowid" class="md-nav__link">
    <span class="md-ellipsis">
      flowId
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xforward" class="md-nav__link">
    <span class="md-ellipsis">
      xforward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xforwardfirst" class="md-nav__link">
    <span class="md-ellipsis">
      xforwardFirst
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-path" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Path
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTP Path">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modpath" class="md-nav__link">
    <span class="md-ellipsis">
      modPath
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setpath" class="md-nav__link">
    <span class="md-ellipsis">
      setPath
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-redirect" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Redirect
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTP Redirect">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#redirectto" class="md-nav__link">
    <span class="md-ellipsis">
      redirectTo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redirecttolower" class="md-nav__link">
    <span class="md-ellipsis">
      redirectToLower
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-query" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Query
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTP Query">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stripquery" class="md-nav__link">
    <span class="md-ellipsis">
      stripQuery
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setquery" class="md-nav__link">
    <span class="md-ellipsis">
      setQuery
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dropquery" class="md-nav__link">
    <span class="md-ellipsis">
      dropQuery
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#querytoheader" class="md-nav__link">
    <span class="md-ellipsis">
      queryToHeader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls" class="md-nav__link">
    <span class="md-ellipsis">
      TLS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TLS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tlspassclientcertificates" class="md-nav__link">
    <span class="md-ellipsis">
      tlsPassClientCertificates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diagnostics" class="md-nav__link">
    <span class="md-ellipsis">
      Diagnostics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Diagnostics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#randomcontent" class="md-nav__link">
    <span class="md-ellipsis">
      randomContent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repeatcontent" class="md-nav__link">
    <span class="md-ellipsis">
      repeatContent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repeatcontenthex" class="md-nav__link">
    <span class="md-ellipsis">
      repeatContentHex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wrapcontent" class="md-nav__link">
    <span class="md-ellipsis">
      wrapContent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wrapcontenthex" class="md-nav__link">
    <span class="md-ellipsis">
      wrapContentHex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#latency" class="md-nav__link">
    <span class="md-ellipsis">
      latency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bandwidth" class="md-nav__link">
    <span class="md-ellipsis">
      bandwidth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunks" class="md-nav__link">
    <span class="md-ellipsis">
      chunks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backendlatency" class="md-nav__link">
    <span class="md-ellipsis">
      backendLatency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backendbandwidth" class="md-nav__link">
    <span class="md-ellipsis">
      backendBandwidth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backendchunks" class="md-nav__link">
    <span class="md-ellipsis">
      backendChunks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tarpit" class="md-nav__link">
    <span class="md-ellipsis">
      tarpit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#absorb" class="md-nav__link">
    <span class="md-ellipsis">
      absorb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#absorbsilent" class="md-nav__link">
    <span class="md-ellipsis">
      absorbSilent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uniformrequestlatency" class="md-nav__link">
    <span class="md-ellipsis">
      uniformRequestLatency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normalrequestlatency" class="md-nav__link">
    <span class="md-ellipsis">
      normalRequestLatency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#histogramrequestlatency" class="md-nav__link">
    <span class="md-ellipsis">
      histogramRequestLatency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uniformresponselatency" class="md-nav__link">
    <span class="md-ellipsis">
      uniformResponseLatency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normalresponselatency" class="md-nav__link">
    <span class="md-ellipsis">
      normalResponseLatency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#histogramresponselatency" class="md-nav__link">
    <span class="md-ellipsis">
      histogramResponseLatency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logheader" class="md-nav__link">
    <span class="md-ellipsis">
      logHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logbody" class="md-nav__link">
    <span class="md-ellipsis">
      logBody
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timeout" class="md-nav__link">
    <span class="md-ellipsis">
      Timeout
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Timeout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backendtimeout" class="md-nav__link">
    <span class="md-ellipsis">
      backendTimeout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#readtimeout" class="md-nav__link">
    <span class="md-ellipsis">
      readTimeout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writetimeout" class="md-nav__link">
    <span class="md-ellipsis">
      writeTimeout
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shadow-traffic" class="md-nav__link">
    <span class="md-ellipsis">
      Shadow Traffic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shadow Traffic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tee" class="md-nav__link">
    <span class="md-ellipsis">
      tee
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#teenf" class="md-nav__link">
    <span class="md-ellipsis">
      teenf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#teeloopback" class="md-nav__link">
    <span class="md-ellipsis">
      teeLoopback
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-body" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Body
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTP Body">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compress" class="md-nav__link">
    <span class="md-ellipsis">
      compress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decompress" class="md-nav__link">
    <span class="md-ellipsis">
      decompress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static" class="md-nav__link">
    <span class="md-ellipsis">
      static
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inlinecontent" class="md-nav__link">
    <span class="md-ellipsis">
      inlineContent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inlinecontentifstatus" class="md-nav__link">
    <span class="md-ellipsis">
      inlineContentIfStatus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blockcontent" class="md-nav__link">
    <span class="md-ellipsis">
      blockContent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blockcontenthex" class="md-nav__link">
    <span class="md-ellipsis">
      blockContentHex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sed" class="md-nav__link">
    <span class="md-ellipsis">
      sed
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memory-handling-and-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      Memory handling and limitations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seddelim" class="md-nav__link">
    <span class="md-ellipsis">
      sedDelim
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sedrequest" class="md-nav__link">
    <span class="md-ellipsis">
      sedRequest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sedrequestdelim" class="md-nav__link">
    <span class="md-ellipsis">
      sedRequestDelim
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-and-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication and Authorization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication and Authorization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basicauth" class="md-nav__link">
    <span class="md-ellipsis">
      basicAuth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webhook" class="md-nav__link">
    <span class="md-ellipsis">
      webhook
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tokeninfo" class="md-nav__link">
    <span class="md-ellipsis">
      Tokeninfo
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tokeninfo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oauthtokeninfoanyscope" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokeninfoAnyScope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthtokeninfoallscope" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokeninfoAllScope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthtokeninfoanykv" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokeninfoAnyKV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthtokeninfoallkv" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokeninfoAllKV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthtokeninfovalidate" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokeninfoValidate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tokenintrospection" class="md-nav__link">
    <span class="md-ellipsis">
      Tokenintrospection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tokenintrospection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oauthtokenintrospectionanyclaims" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokenintrospectionAnyClaims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthtokenintrospectionallclaims" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokenintrospectionAllClaims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthtokenintrospectionanykv" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokenintrospectionAnyKV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthtokenintrospectionallkv" class="md-nav__link">
    <span class="md-ellipsis">
      oauthTokenintrospectionAllKV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secureoauthtokenintrospectionanyclaims" class="md-nav__link">
    <span class="md-ellipsis">
      secureOauthTokenintrospectionAnyClaims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secureoauthtokenintrospectionallclaims" class="md-nav__link">
    <span class="md-ellipsis">
      secureOauthTokenintrospectionAllClaims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secureoauthtokenintrospectionanykv" class="md-nav__link">
    <span class="md-ellipsis">
      secureOauthTokenintrospectionAnyKV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secureoauthtokenintrospectionallkv" class="md-nav__link">
    <span class="md-ellipsis">
      secureOauthTokenintrospectionAllKV
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwt" class="md-nav__link">
    <span class="md-ellipsis">
      JWT
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JWT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jwtvalidation" class="md-nav__link">
    <span class="md-ellipsis">
      jwtValidation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwtmetrics" class="md-nav__link">
    <span class="md-ellipsis">
      jwtMetrics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forward-token-data" class="md-nav__link">
    <span class="md-ellipsis">
      Forward Token Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Forward Token Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#forwardtoken" class="md-nav__link">
    <span class="md-ellipsis">
      forwardToken
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forwardtokenfield" class="md-nav__link">
    <span class="md-ellipsis">
      forwardTokenField
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauth2" class="md-nav__link">
    <span class="md-ellipsis">
      OAuth2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OAuth2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oauthgrant" class="md-nav__link">
    <span class="md-ellipsis">
      oauthGrant
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grantcallback" class="md-nav__link">
    <span class="md-ellipsis">
      grantCallback
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grantlogout" class="md-nav__link">
    <span class="md-ellipsis">
      grantLogout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grantclaimsquery" class="md-nav__link">
    <span class="md-ellipsis">
      grantClaimsQuery
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openid-connect" class="md-nav__link">
    <span class="md-ellipsis">
      OpenID Connect
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OpenID Connect">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oauthoidcuserinfo" class="md-nav__link">
    <span class="md-ellipsis">
      oauthOidcUserInfo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthoidcanyclaims" class="md-nav__link">
    <span class="md-ellipsis">
      oauthOidcAnyClaims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oauthoidcallclaims" class="md-nav__link">
    <span class="md-ellipsis">
      oauthOidcAllClaims
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oidcclaimsquery" class="md-nav__link">
    <span class="md-ellipsis">
      oidcClaimsQuery
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open-policy-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Open Policy Agent
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Open Policy Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#opaauthorizerequest" class="md-nav__link">
    <span class="md-ellipsis">
      opaAuthorizeRequest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opaauthorizerequestwithbody" class="md-nav__link">
    <span class="md-ellipsis">
      opaAuthorizeRequestWithBody
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opaserveresponse" class="md-nav__link">
    <span class="md-ellipsis">
      opaServeResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opaserveresponsewithreqbody" class="md-nav__link">
    <span class="md-ellipsis">
      opaServeResponseWithReqBody
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#awssigv4" class="md-nav__link">
    <span class="md-ellipsis">
      awsSigv4
    </span>
  </a>
  
    <nav class="md-nav" aria-label="awsSigv4">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memory-consideration" class="md-nav__link">
    <span class="md-ellipsis">
      Memory consideration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overwriting-ioreadcloser" class="md-nav__link">
    <span class="md-ellipsis">
      Overwriting io.ReadCloser
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cookie-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Cookie Handling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cookie Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#droprequestcookie" class="md-nav__link">
    <span class="md-ellipsis">
      dropRequestCookie
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dropresponsecookie" class="md-nav__link">
    <span class="md-ellipsis">
      dropResponseCookie
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requestcookie" class="md-nav__link">
    <span class="md-ellipsis">
      requestCookie
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#responsecookie" class="md-nav__link">
    <span class="md-ellipsis">
      responseCookie
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jscookie" class="md-nav__link">
    <span class="md-ellipsis">
      jsCookie
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#circuit-breakers" class="md-nav__link">
    <span class="md-ellipsis">
      Circuit Breakers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Circuit Breakers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consecutivebreaker" class="md-nav__link">
    <span class="md-ellipsis">
      consecutiveBreaker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ratebreaker" class="md-nav__link">
    <span class="md-ellipsis">
      rateBreaker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disablebreaker" class="md-nav__link">
    <span class="md-ellipsis">
      disableBreaker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-limit" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rate Limit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#localratelimit" class="md-nav__link">
    <span class="md-ellipsis">
      localRatelimit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clientratelimit" class="md-nav__link">
    <span class="md-ellipsis">
      clientRatelimit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ratelimit" class="md-nav__link">
    <span class="md-ellipsis">
      ratelimit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clusterclientratelimit" class="md-nav__link">
    <span class="md-ellipsis">
      clusterClientRatelimit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clusterratelimit" class="md-nav__link">
    <span class="md-ellipsis">
      clusterRatelimit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backendratelimit" class="md-nav__link">
    <span class="md-ellipsis">
      backendRatelimit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clusterleakybucketratelimit" class="md-nav__link">
    <span class="md-ellipsis">
      clusterLeakyBucketRatelimit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ratelimitfailclosed" class="md-nav__link">
    <span class="md-ellipsis">
      ratelimitFailClosed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-shedding" class="md-nav__link">
    <span class="md-ellipsis">
      Load Shedding
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Load Shedding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#admissioncontrol" class="md-nav__link">
    <span class="md-ellipsis">
      admissionControl
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lua" class="md-nav__link">
    <span class="md-ellipsis">
      lua
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logs" class="md-nav__link">
    <span class="md-ellipsis">
      Logs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Logs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#accesslogdisabled" class="md-nav__link">
    <span class="md-ellipsis">
      accessLogDisabled
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disableaccesslog" class="md-nav__link">
    <span class="md-ellipsis">
      disableAccessLog
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enableaccesslog" class="md-nav__link">
    <span class="md-ellipsis">
      enableAccessLog
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auditlog" class="md-nav__link">
    <span class="md-ellipsis">
      auditLog
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unverifiedauditlog" class="md-nav__link">
    <span class="md-ellipsis">
      unverifiedAuditLog
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend" class="md-nav__link">
    <span class="md-ellipsis">
      Backend
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Backend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backendisproxy" class="md-nav__link">
    <span class="md-ellipsis">
      backendIsProxy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdynamicbackendhostfromheader" class="md-nav__link">
    <span class="md-ellipsis">
      setDynamicBackendHostFromHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdynamicbackendschemefromheader" class="md-nav__link">
    <span class="md-ellipsis">
      setDynamicBackendSchemeFromHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdynamicbackendurlfromheader" class="md-nav__link">
    <span class="md-ellipsis">
      setDynamicBackendUrlFromHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdynamicbackendhost" class="md-nav__link">
    <span class="md-ellipsis">
      setDynamicBackendHost
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdynamicbackendscheme" class="md-nav__link">
    <span class="md-ellipsis">
      setDynamicBackendScheme
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdynamicbackendurl" class="md-nav__link">
    <span class="md-ellipsis">
      setDynamicBackendUrl
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apiusagemonitoring" class="md-nav__link">
    <span class="md-ellipsis">
      apiUsageMonitoring
    </span>
  </a>
  
    <nav class="md-nav" aria-label="apiUsageMonitoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#available-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Available Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Available Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#endpoint-related-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Endpoint Related Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#client-related-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Client Related Metrics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Filter Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#originmarker" class="md-nav__link">
    <span class="md-ellipsis">
      originMarker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scheduler" class="md-nav__link">
    <span class="md-ellipsis">
      Scheduler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scheduler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fifo" class="md-nav__link">
    <span class="md-ellipsis">
      fifo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fifowithbody" class="md-nav__link">
    <span class="md-ellipsis">
      fifoWithBody
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lifo" class="md-nav__link">
    <span class="md-ellipsis">
      lifo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lifogroup" class="md-nav__link">
    <span class="md-ellipsis">
      lifoGroup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rfc-compliance" class="md-nav__link">
    <span class="md-ellipsis">
      RFC Compliance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RFC Compliance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rfchost" class="md-nav__link">
    <span class="md-ellipsis">
      rfcHost
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rfcpath" class="md-nav__link">
    <span class="md-ellipsis">
      rfcPath
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#egress" class="md-nav__link">
    <span class="md-ellipsis">
      Egress
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Egress">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setrequestheaderfromsecret" class="md-nav__link">
    <span class="md-ellipsis">
      setRequestHeaderFromSecret
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bearerinjector" class="md-nav__link">
    <span class="md-ellipsis">
      bearerinjector
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#open-tracing" class="md-nav__link">
    <span class="md-ellipsis">
      Open Tracing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Open Tracing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tracingbaggagetotag" class="md-nav__link">
    <span class="md-ellipsis">
      tracingBaggageToTag
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#statebagtotag" class="md-nav__link">
    <span class="md-ellipsis">
      stateBagToTag
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracingtag" class="md-nav__link">
    <span class="md-ellipsis">
      tracingTag
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracingtagfromresponse" class="md-nav__link">
    <span class="md-ellipsis">
      tracingTagFromResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracingtagfromresponseifstatus" class="md-nav__link">
    <span class="md-ellipsis">
      tracingTagFromResponseIfStatus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracingspanname" class="md-nav__link">
    <span class="md-ellipsis">
      tracingSpanName
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-balancing" class="md-nav__link">
    <span class="md-ellipsis">
      Load Balancing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Load Balancing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fadein" class="md-nav__link">
    <span class="md-ellipsis">
      fadeIn
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fadeIn">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#warning-on-fadein-and-rolling-restarts" class="md-nav__link">
    <span class="md-ellipsis">
      Warning on fadeIn and Rolling Restarts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#endpointcreated" class="md-nav__link">
    <span class="md-ellipsis">
      endpointCreated
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consistenthashkey" class="md-nav__link">
    <span class="md-ellipsis">
      consistentHashKey
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consistenthashbalancefactor" class="md-nav__link">
    <span class="md-ellipsis">
      consistentHashBalanceFactor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="skipper-filters">Skipper Filters<a class="headerlink" href="#skipper-filters" title="Permanent link">&para;</a></h1>
<p>The parameters can be strings, regex or float64 / int</p>
<ul>
<li><code>string</code> is a string surrounded by double quotes (<code>"</code>)</li>
<li><code>regex</code> is a regular expression, surrounded by <code>/</code>, e.g. <code>/^www\.example\.org(:\d+)?$/</code></li>
<li><code>int</code> / <code>float64</code> are usual (decimal) numbers like <code>401</code> or <code>1.23456</code></li>
<li><code>time</code> is a string in double quotes, parsable by <a href="https://godoc.org/time#ParseDuration">time.Duration</a>)</li>
</ul>
<p>Filters are a generic tool and can change HTTP header and body in the request and response path.
Filter can be chained using the arrow operator <code>-&gt;</code>.</p>
<p>Example route with a match all, 2 filters and a backend:</p>
<div class="highlight"><pre><span></span><code>all: * -&gt; filter1 -&gt; filter2 -&gt; &quot;http://127.0.0.1:1234/&quot;;
</code></pre></div>
<h2 id="template-placeholders">Template placeholders<a class="headerlink" href="#template-placeholders" title="Permanent link">&para;</a></h2>
<p>Several filters support template placeholders (<code>${var}</code>) in string parameters.</p>
<p>Template placeholder is replaced by the value that is looked up in the following sources:</p>
<ul>
<li>request method (<code>${request.method}</code>)</li>
<li>request host (<code>${request.host}</code>)</li>
<li>request url path (<code>${request.path}</code>)</li>
<li>request url rawquery (<code>${request.rawQuery}</code>, encoded request URL query without <code>?</code>, e.g. <code>q=foo&amp;r=bar</code>)</li>
<li>request url query (if starts with <code>request.query.</code> prefix, e.g <code>${request.query.q}</code> is replaced by <code>q</code> query parameter value)</li>
<li>request headers (if starts with <code>request.header.</code> prefix, e.g <code>${request.header.Content-Type}</code> is replaced by <code>Content-Type</code> request header value)</li>
<li>request cookies (if starts with <code>request.cookie.</code> prefix, e.g <code>${request.cookie.PHPSESSID}</code> is replaced by <code>PHPSESSID</code> request cookie value)</li>
<li>request IP address<ul>
<li><code>${request.source}</code> - first IP address from <code>X-Forwarded-For</code> header or request remote IP address if header is absent, similar to <a href="../predicates/#source">Source</a> predicate</li>
<li><code>${request.sourceFromLast}</code> - last IP address from <code>X-Forwarded-For</code> header or request remote IP address if header is absent, similar to <a href="../predicates/#sourcefromlast">SourceFromLast</a> predicate</li>
<li><code>${request.clientIP}</code> - request remote IP address similar to <a href="../predicates/#clientip">ClientIP</a> predicate</li>
</ul>
</li>
<li>response headers (if starts with <code>response.header.</code> prefix, e.g <code>${response.header.Location}</code> is replaced by <code>Location</code> response header value)</li>
<li>filter context path parameters (e.g. <code>${id}</code> is replaced by <code>id</code> path parameter value)</li>
</ul>
<p>Missing value interpretation depends on the filter.</p>
<p>Example route that rewrites path using template placeholder:</p>
<div class="highlight"><pre><span></span><code>u1: Path(&quot;/user/:id&quot;) -&gt; setPath(&quot;/v2/user/${id}&quot;) -&gt; &lt;loopback&gt;;
</code></pre></div>
<p>Example route that creates header from query parameter:
<div class="highlight"><pre><span></span><code>r: Path(&quot;/redirect&quot;) &amp;&amp; QueryParam(&quot;to&quot;) -&gt; status(303) -&gt; setResponseHeader(&quot;Location&quot;, &quot;${request.query.to}&quot;) -&gt; &lt;shunt&gt;;
</code></pre></div></p>
<h2 id="status">status<a class="headerlink" href="#status" title="Permanent link">&para;</a></h2>
<p>Sets the response status code to the given value, with no regards to the backend response.</p>
<p>Parameters:</p>
<ul>
<li>status code (int)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>route1: Host(/^all401\.example\.org$/) -&gt; status(401) -&gt; &lt;shunt&gt;;
</code></pre></div>
<h2 id="comment">comment<a class="headerlink" href="#comment" title="Permanent link">&para;</a></h2>
<p>No operation, only to comment the route or a group of filters of a route</p>
<p>Parameters:</p>
<ul>
<li>msg (string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>route1: *
    -&gt; comment(&quot;nothing to see&quot;)
    -&gt; &lt;shunt&gt;;
</code></pre></div>
<h2 id="annotate">annotate<a class="headerlink" href="#annotate" title="Permanent link">&para;</a></h2>
<p>Annotate the route, subsequent annotations using the same key will overwrite the value.
Other subsequent filters can use annotations to make decisions and should document the key and value they use.</p>
<p>Parameters:</p>
<ul>
<li>key (string)</li>
<li>value (string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>route1: *
    -&gt; annotate(&quot;never&quot;, &quot;gonna give you up&quot;)
    -&gt; annotate(&quot;never&quot;, &quot;gonna let you down&quot;)
    -&gt; &lt;shunt&gt;;
</code></pre></div>
<h2 id="http-headers">HTTP Headers<a class="headerlink" href="#http-headers" title="Permanent link">&para;</a></h2>
<h3 id="preservehost">preserveHost<a class="headerlink" href="#preservehost" title="Permanent link">&para;</a></h3>
<p>Sets the incoming <code>Host:</code> header on the outgoing backend connection.</p>
<p>It can be used to override the <code>proxyPreserveHost</code> behavior for individual routes.</p>
<p>Parameters: &ldquo;true&rdquo; or &ldquo;false&rdquo;</p>
<ul>
<li>&ldquo;true&rdquo; - use the Host header from the incoming request</li>
<li>&ldquo;false&rdquo; - use the host from the backend address</li>
</ul>
<p>Example:
<div class="highlight"><pre><span></span><code>route1: * -&gt; preserveHost(&quot;true&quot;) -&gt; &quot;http://backend.example.org&quot;;
</code></pre></div></p>
<p>Default <code>proxyPreserveHost</code> behavior can be configured by <code>-proxy-preserve-host</code> flag which is <code>false</code> by default.</p>
<h3 id="modrequestheader">modRequestHeader<a class="headerlink" href="#modrequestheader" title="Permanent link">&para;</a></h3>
<p>Replace all matched regex expressions in the given header.</p>
<p>Parameters:</p>
<ul>
<li>header name (string)</li>
<li>the expression to match (regex)</li>
<li>the replacement (string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>enforce_www: * -&gt; modRequestHeader(&quot;Host&quot;, &quot;^zalando\.(\w+)$&quot;, &quot;www.zalando.$1&quot;) -&gt; redirectTo(301);
</code></pre></div>
<h3 id="setrequestheader">setRequestHeader<a class="headerlink" href="#setrequestheader" title="Permanent link">&para;</a></h3>
<p>Set headers for requests.</p>
<p>Header value may contain <a href="#template-placeholders">template placeholders</a>.
If a template placeholder can&rsquo;t be resolved then filter does not set the header.</p>
<p>Parameters:</p>
<ul>
<li>header name (string)</li>
<li>header value (string)</li>
</ul>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>foo: * -&gt; setRequestHeader(&quot;X-Passed-Skipper&quot;, &quot;true&quot;) -&gt; &quot;https://backend.example.org&quot;;
</code></pre></div>
<div class="highlight"><pre><span></span><code>// Ratelimit per resource
Path(&quot;/resource/:id&quot;) -&gt; setRequestHeader(&quot;X-Resource-Id&quot;, &quot;${id}&quot;) -&gt; clusterClientRatelimit(&quot;resource&quot;, 10, &quot;1m&quot;, &quot;X-Resource-Id&quot;) -&gt; &quot;https://backend.example.org&quot;;
</code></pre></div>
<h3 id="appendrequestheader">appendRequestHeader<a class="headerlink" href="#appendrequestheader" title="Permanent link">&para;</a></h3>
<p>Same as <a href="#setrequestheader">setRequestHeader</a>,
but appends the provided value to the already existing ones.</p>
<h3 id="droprequestheader">dropRequestHeader<a class="headerlink" href="#droprequestheader" title="Permanent link">&para;</a></h3>
<p>Removes a header from the request</p>
<p>Parameters:</p>
<ul>
<li>header name (string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>foo: * -&gt; dropRequestHeader(&quot;User-Agent&quot;) -&gt; &quot;https://backend.example.org&quot;;
</code></pre></div>
<h3 id="modresponseheader">modResponseHeader<a class="headerlink" href="#modresponseheader" title="Permanent link">&para;</a></h3>
<p>Same as <a href="#modrequestheader">modRequestHeader</a>, only for responses</p>
<p>Parameters:</p>
<ul>
<li>header name (string)</li>
<li>the expression to match (regex)</li>
<li>the replacement (string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>do_not_avoid_caching: * -&gt; modResponseHeader(&quot;cache-control&quot;, &quot;no-cache&quot;, &quot;cache&quot;) -&gt; &quot;https://zalando.de&quot;;
</code></pre></div>
<h3 id="setresponseheader">setResponseHeader<a class="headerlink" href="#setresponseheader" title="Permanent link">&para;</a></h3>
<p>Same as <a href="#setrequestheader">setRequestHeader</a>, only for responses</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>set_cookie_with_path_param:
  Path(&quot;/path/:id&quot;) &amp;&amp; Method(&quot;GET&quot;)
  -&gt; setResponseHeader(&quot;Set-Cookie&quot;, &quot;cid=${id}; Max-Age=36000; Secure&quot;)
  -&gt; redirectTo(302, &quot;/&quot;)
  -&gt; &lt;shunt&gt;
</code></pre></div>
<h3 id="appendresponseheader">appendResponseHeader<a class="headerlink" href="#appendresponseheader" title="Permanent link">&para;</a></h3>
<p>Same as <a href="#appendrequestheader">appendRequestHeader</a>, only for responses</p>
<h3 id="dropresponseheader">dropResponseHeader<a class="headerlink" href="#dropresponseheader" title="Permanent link">&para;</a></h3>
<p>Same as <a href="#droprequestheader">dropRequestHeader</a> but for responses from the backend</p>
<h3 id="setcontextrequestheader">setContextRequestHeader<a class="headerlink" href="#setcontextrequestheader" title="Permanent link">&para;</a></h3>
<p>Set headers for requests using values from the filter context (state bag). If the
provided key (second parameter) cannot be found in the state bag, then it doesn&rsquo;t
set the header.</p>
<p>Parameters:</p>
<ul>
<li>header name (string)</li>
<li>key in the state bag (string)</li>
</ul>
<p>The route in the following example checks whether the request is authorized with the
oauthTokeninfoAllScope() filter. This filter stores the authenticated user with &ldquo;auth-user&rdquo;
key in the context, and the setContextRequestHeader() filter in the next step stores it in
the header of the outgoing request with the X-Uid name:</p>
<div class="highlight"><pre><span></span><code>foo: * -&gt; oauthTokeninfoAllScope(&quot;address_service.all&quot;) -&gt; setContextRequestHeader(&quot;X-Uid&quot;, &quot;auth-user&quot;) -&gt; &quot;https://backend.example.org&quot;;
</code></pre></div>
<h3 id="appendcontextrequestheader">appendContextRequestHeader<a class="headerlink" href="#appendcontextrequestheader" title="Permanent link">&para;</a></h3>
<p>Same as <a href="#setcontextrequestheader">setContextRequestHeader</a>,
but appends the provided value to the already existing ones.</p>
<h3 id="setcontextresponseheader">setContextResponseHeader<a class="headerlink" href="#setcontextresponseheader" title="Permanent link">&para;</a></h3>
<p>Same as <a href="#setcontextrequestheader">setContextRequestHeader</a>, except for responses.</p>
<h3 id="appendcontextresponseheader">appendContextResponseHeader<a class="headerlink" href="#appendcontextresponseheader" title="Permanent link">&para;</a></h3>
<p>Same as <a href="#appendcontextrequestheader">appendContextRequestHeader</a>, except for responses.</p>
<h3 id="copyrequestheader">copyRequestHeader<a class="headerlink" href="#copyrequestheader" title="Permanent link">&para;</a></h3>
<p>Copies value of a given request header to another header.</p>
<p>Parameters:</p>
<ul>
<li>source header name (string)</li>
<li>target header name (string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>foo: * -&gt; copyRequestHeader(&quot;X-Foo&quot;, &quot;X-Bar&quot;) -&gt; &quot;https://backend.example.org&quot;;
</code></pre></div>
<h3 id="copyresponseheader">copyResponseHeader<a class="headerlink" href="#copyresponseheader" title="Permanent link">&para;</a></h3>
<p>Same as <a href="#copyrequestheader">copyRequestHeader</a>, except for responses.</p>
<h3 id="corsorigin">corsOrigin<a class="headerlink" href="#corsorigin" title="Permanent link">&para;</a></h3>
<p>The filter accepts an optional variadic list of acceptable origin
parameters. If the input argument list is empty, the header will
always be set to <code>*</code> which means any origin is acceptable. Otherwise
the header is only set if the request contains an Origin header and
its value matches one of the elements in the input list. The header is
only set on the response.</p>
<p>Parameters:</p>
<ul>
<li>url (variadic string)</li>
</ul>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>corsOrigin()
corsOrigin(&quot;https://www.example.org&quot;)
corsOrigin(&quot;https://www.example.org&quot;, &quot;http://localhost:9001&quot;)
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To enable CORS functionality, you must create a dedicated route that handles <code>OPTIONS</code> requests.</p>
</div>
<p>Example:
<div class="highlight"><pre><span></span><code>main_route:
PathSubtree(&quot;/&quot;)
 -&gt; corsOrigin()
 -&gt; setResponseHeader(&quot;Access-Control-Allow-Credentials&quot;, &quot;true&quot;)
 -&gt; setResponseHeader(&quot;Access-Control-Allow-Methods&quot;, &quot;GET, HEAD, OPTIONS, POST, PUT, PATCH, DELETE&quot;)
 -&gt; &quot;http://backend.example.org&quot;;

preflight_route:
PathSubtree(&quot;/&quot;) &amp;&amp; Method(&quot;OPTIONS&quot;)
 -&gt; corsOrigin()
 -&gt; setResponseHeader(&quot;Access-Control-Allow-Credentials&quot;, &quot;true&quot;)
 -&gt; setResponseHeader(&quot;Access-Control-Allow-Methods&quot;, &quot;GET, HEAD, OPTIONS, POST, PUT, PATCH, DELETE&quot;)
 -&gt; setResponseHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;authorization, origin, content-type, accept&quot;)
 -&gt; status(200)
 -&gt; &lt;shunt&gt;;
</code></pre></div></p>
<h3 id="headertoquery">headerToQuery<a class="headerlink" href="#headertoquery" title="Permanent link">&para;</a></h3>
<p>Filter which assigns the value of a given header from the incoming Request to a given query param</p>
<p>Parameters:</p>
<ul>
<li>The name of the header to pick from request</li>
<li>The name of the query param key to add to request</li>
</ul>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>headerToQuery(&quot;X-Foo-Header&quot;, &quot;foo-query-param&quot;)
</code></pre></div>
<p>The above filter will set <code>foo-query-param</code> query param respectively to the <code>X-Foo-Header</code> header
and will override the value if the queryparam exists already</p>
<h3 id="flowid">flowId<a class="headerlink" href="#flowid" title="Permanent link">&para;</a></h3>
<p>Sets an X-Flow-Id header, if it&rsquo;s not already in the request.
This allows you to have a trace in your logs, that traces from
the incoming request on the edge to all backend services.</p>
<p>Flow IDs must be in a certain format to be reusable in skipper. Valid formats
depend on the generator used in skipper. Default generator creates IDs of
length 16 matching the following regex: <code>^[0-9a-zA-Z+-]+$</code></p>
<p>Parameters:</p>
<ul>
<li>no parameter: resets always the X-Flow-Id header to a new value</li>
<li><code>"reuse"</code>: only create X-Flow-Id header if not already set or if the value is invalid in the request</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; flowId() -&gt; &quot;https://some-backend.example.org&quot;;
* -&gt; flowId(&quot;reuse&quot;) -&gt; &quot;https://some-backend.example.org&quot;;
</code></pre></div>
<h3 id="xforward">xforward<a class="headerlink" href="#xforward" title="Permanent link">&para;</a></h3>
<p>Standard proxy headers. Appends the client remote IP to the X-Forwarded-For and sets the X-Forwarded-Host
header.</p>
<h3 id="xforwardfirst">xforwardFirst<a class="headerlink" href="#xforwardfirst" title="Permanent link">&para;</a></h3>
<p>Same as <a href="#xforward">xforward</a>, but instead of appending the last remote IP, it prepends it to comply with the
approach of certain LB implementations.</p>
<h2 id="http-path">HTTP Path<a class="headerlink" href="#http-path" title="Permanent link">&para;</a></h2>
<h3 id="modpath">modPath<a class="headerlink" href="#modpath" title="Permanent link">&para;</a></h3>
<p>Replace all matched regex expressions in the path.</p>
<p>Parameters:</p>
<ul>
<li>the expression to match (regex)</li>
<li>the replacement (string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>rm_api: Path(&quot;/api&quot;) -&gt; modPath(&quot;/api&quot;, &quot;/&quot;) -&gt; &quot;https://backend.example.org&quot;;
append_bar: Path(&quot;/foo&quot;) -&gt; modPath(&quot;/foo&quot;, &quot;/foo/bar&quot;) -&gt; &quot;https://backend.example.org&quot;;
new_base: PathSubtree(&quot;/base&quot;) -&gt; modPath(&quot;/base&quot;, &quot;/new/base) -&gt; &quot;https://backend.example.org&quot;;
rm_api_regex: Path(&quot;/api&quot;) -&gt; modPath(&quot;^/api/(.*)/v2$&quot;, &quot;/$1&quot;) -&gt; &quot;https://backend.example.org&quot;;
</code></pre></div>
<h3 id="setpath">setPath<a class="headerlink" href="#setpath" title="Permanent link">&para;</a></h3>
<p>Replace the path of the original request to the replacement.</p>
<p>Parameters:</p>
<ul>
<li>the replacement (string)</li>
</ul>
<p>The replacement may contain <a href="#template-placeholders">template placeholders</a>.
If a template placeholder can&rsquo;t be resolved then empty value is used for it.</p>
<h2 id="http-redirect">HTTP Redirect<a class="headerlink" href="#http-redirect" title="Permanent link">&para;</a></h2>
<h3 id="redirectto">redirectTo<a class="headerlink" href="#redirectto" title="Permanent link">&para;</a></h3>
<p>Creates an HTTP redirect response.</p>
<p>Parameters:</p>
<ul>
<li>redirect status code (int)</li>
<li>location (string) - optional</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>redirect1: PathRegexp(/^\/foo\/bar/) -&gt; redirectTo(302, &quot;/foo/newBar&quot;) -&gt; &lt;shunt&gt;;
redirect2: * -&gt; redirectTo(301) -&gt; &lt;shunt&gt;;
</code></pre></div>
<ul>
<li>Route redirect1 will do a redirect with status code 302 to https
  with new path <code>/foo/newBar</code> for requests, that match the path <code>/foo/bar</code>.</li>
<li>Route redirect2 will do a <code>https</code> redirect with status code 301 for all
  incoming requests that match no other route</li>
</ul>
<p>see also <a href="../../tutorials/common-use-cases/#redirect-handling">redirect-handling</a></p>
<h3 id="redirecttolower">redirectToLower<a class="headerlink" href="#redirecttolower" title="Permanent link">&para;</a></h3>
<p>Same as <a href="#redirectto">redirectTo</a>, but replaces all strings to lower case.</p>
<h2 id="http-query">HTTP Query<a class="headerlink" href="#http-query" title="Permanent link">&para;</a></h2>
<h3 id="stripquery">stripQuery<a class="headerlink" href="#stripquery" title="Permanent link">&para;</a></h3>
<p>Removes the query parameter from the request URL, and if the first filter
parameter is <code>"true"</code>, preserves the query parameter in the form of
<code>x-query-param-&lt;queryParamName&gt;: &lt;queryParamValue&gt;</code> headers, so that <code>?foo=bar</code>
becomes <code>x-query-param-foo: bar</code></p>
<p>Example:
<div class="highlight"><pre><span></span><code>* -&gt; stripQuery() -&gt; &quot;http://backend.example.org&quot;;
* -&gt; stripQuery(&quot;true&quot;) -&gt; &quot;http://backend.example.org&quot;;
</code></pre></div></p>
<h3 id="setquery">setQuery<a class="headerlink" href="#setquery" title="Permanent link">&para;</a></h3>
<p>Set the query string <code>?k=v</code> in the request to the backend to a given value.</p>
<p>Parameters:</p>
<ul>
<li>key (string)</li>
<li>value (string)</li>
</ul>
<p>Key and value may contain <a href="#template-placeholders">template placeholders</a>.
If a template placeholder can&rsquo;t be resolved then empty value is used for it.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>setQuery(&quot;k&quot;, &quot;v&quot;)
</code></pre></div>
<h3 id="dropquery">dropQuery<a class="headerlink" href="#dropquery" title="Permanent link">&para;</a></h3>
<p>Delete the query string <code>?k=v</code> in the request to the backend for a
given key.</p>
<p>Parameters:</p>
<ul>
<li>key (string)</li>
</ul>
<p>Key may contain <a href="#template-placeholders">template placeholders</a>.
If a template placeholder can&rsquo;t be resolved then empty value is used for it.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>dropQuery(&quot;k&quot;)
</code></pre></div>
<h3 id="querytoheader">queryToHeader<a class="headerlink" href="#querytoheader" title="Permanent link">&para;</a></h3>
<p>Filter which assigns the value of a given query param from the
incoming Request to a given Header with optional format string value.</p>
<p>Parameters:</p>
<ul>
<li>The name of the query param key to pick from request</li>
<li>The name of the header to add to request</li>
<li>The format string used to create the header value, which gets the
  value from the query value as before</li>
</ul>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>queryToHeader(&quot;foo-query-param&quot;, &quot;X-Foo-Header&quot;)
queryToHeader(&quot;access_token&quot;, &quot;Authorization&quot;, &quot;Bearer %s&quot;)
</code></pre></div>
<p>The first filter will set <code>X-Foo-Header</code> header respectively to the <code>foo-query-param</code> query param
and will not override the value if the header exists already.</p>
<p>The second filter will set <code>Authorization</code> header to the
<code>access_token</code> query param with a prefix value <code>Bearer</code> and will
not override the value if the header exists already.</p>
<h2 id="tls">TLS<a class="headerlink" href="#tls" title="Permanent link">&para;</a></h2>
<p>Filters that provide access to TLS data of a request.</p>
<h3 id="tlspassclientcertificates">tlsPassClientCertificates<a class="headerlink" href="#tlspassclientcertificates" title="Permanent link">&para;</a></h3>
<p>This filter copies TLS client certificates encoded as pem into the
X-Forwarded-Tls-Client-Cert header. Multiple certificates are
separated by <code>,</code>.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; tlsPassClientCertificates() -&gt; &quot;http://10.2.5.21:8080&quot;;
</code></pre></div>
<h2 id="diagnostics">Diagnostics<a class="headerlink" href="#diagnostics" title="Permanent link">&para;</a></h2>
<p>These filters are meant for diagnostic or load testing purposes.</p>
<h3 id="randomcontent">randomContent<a class="headerlink" href="#randomcontent" title="Permanent link">&para;</a></h3>
<p>Generate response with random text of specified length.</p>
<p>Parameters:</p>
<ul>
<li>length of data (int)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; randomContent(42) -&gt; &lt;shunt&gt;;
</code></pre></div>
<h3 id="repeatcontent">repeatContent<a class="headerlink" href="#repeatcontent" title="Permanent link">&para;</a></h3>
<p>Generate response of specified size from repeated text.</p>
<p>Parameters:</p>
<ul>
<li>text to repeat (string)</li>
<li>size of response in bytes (int)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; repeatContent(&quot;I will not waste chalk. &quot;, 1000) -&gt; &lt;shunt&gt;;
</code></pre></div>
<h3 id="repeatcontenthex">repeatContentHex<a class="headerlink" href="#repeatcontenthex" title="Permanent link">&para;</a></h3>
<p>Generate response of specified size from repeated bytes.</p>
<p>Parameters:</p>
<ul>
<li>bytes to repeat (hexadecimal string)</li>
<li>size of response in bytes (int)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; repeatContentHex(&quot;00&quot;, 100) -&gt; &lt;shunt&gt;
</code></pre></div>
<div class="highlight"><pre><span></span><code>// Create binary response using size equal to the number of bytes to repeat, i.e. repeat once
* -&gt; repeatContentHex(&quot;68657861646563696d616c&quot;, 11) -&gt; &lt;shunt&gt;
</code></pre></div>
<h3 id="wrapcontent">wrapContent<a class="headerlink" href="#wrapcontent" title="Permanent link">&para;</a></h3>
<p>Add prefix and suffix to the response.</p>
<p>Parameters:</p>
<ul>
<li>prefix (string)</li>
<li>suffix (string)</li>
</ul>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>* -&gt; wrapContent(&quot;foo&quot;, &quot;baz&quot;) -&gt; inlineContent(&quot;bar&quot;) -&gt; &lt;shunt&gt;
</code></pre></div>
<div class="highlight"><pre><span></span><code>// JSON array of 100 zeros
* -&gt; wrapContent(&quot;[&quot;, &quot;0]&quot;) -&gt; repeatContent(&quot;0, &quot;, 297) -&gt; &lt;shunt&gt;
</code></pre></div>
<h3 id="wrapcontenthex">wrapContentHex<a class="headerlink" href="#wrapcontenthex" title="Permanent link">&para;</a></h3>
<p>Add prefix and suffix to the response.</p>
<p>Parameters:</p>
<ul>
<li>prefix (hexadecimal string)</li>
<li>suffix (hexadecimal string)</li>
</ul>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>* -&gt; wrapContentHex(&quot;68657861&quot;, &quot;6d616c&quot;) -&gt; inlineContent(&quot;deci&quot;) -&gt; &lt;shunt&gt;
</code></pre></div>
<div class="highlight"><pre><span></span><code>// 1G of gzip-compressed text
*
-&gt; setResponseHeader(&quot;Content-Encoding&quot;, &quot;gzip&quot;)
-&gt; wrapContentHex(
  &quot;1f8b08000000000004ffecd6b10d00200804c05598c5b80a852d0ee422762ce61c2657d212f8bf9915bb6f9f8c51b9c26c1feec13fc80379a80ff4210ff0000ff0000ff0000ff0000ff0000ff0000ff0000ff0000ff0000ff0000ff0000ffce781070000ffffecd6810c000000c0207feb737c8ba2f8cd6f7ef39bdffce637bf&quot;,
  &quot;7dc0077cc0077cc0077cc0077cc0077cc0077cc0077cc0077cc0077cc0077cc0077ce0ff81000000ffffecd6810000000080207feb418ea278ce739ef39ce73ce739cf7de0f581000000ffff010000ffff5216994600ca9a3b&quot;
)
-&gt; repeatContentHex(&quot;7dc0077cc0077cc0077cc0077cc0077cc0077cc0077cc0077cc0077cc0077cc0077ce0ff81000000ffffecd6810c000000c0207feb737c8ba278ce739ef39ce73ce739cf&quot;, 8300624)
-&gt; &lt;shunt&gt;
</code></pre></div>
<p>You may use <a href="https://github.com/AlexanderYastrebov/unrepeat">https://github.com/AlexanderYastrebov/unrepeat</a> to decompose binary file into prefix, repeating content and suffix.</p>
<h3 id="latency">latency<a class="headerlink" href="#latency" title="Permanent link">&para;</a></h3>
<p>Enable adding artificial latency</p>
<p>Parameters:</p>
<ul>
<li>latency in milliseconds (int) or in <code>time</code> as a string in double quotes, parsable by <a href="https://godoc.org/time#ParseDuration">time.Duration</a>)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; latency(120) -&gt; &quot;https://www.example.org&quot;;
* -&gt; latency(&quot;120ms&quot;) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<h3 id="bandwidth">bandwidth<a class="headerlink" href="#bandwidth" title="Permanent link">&para;</a></h3>
<p>Enable bandwidth throttling.</p>
<p>Parameters:</p>
<ul>
<li>bandwidth in kb/s (int)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; bandwidth(30) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<h3 id="chunks">chunks<a class="headerlink" href="#chunks" title="Permanent link">&para;</a></h3>
<p>Enables adding chunking responses with custom chunk size with
artificial delays in between response chunks. To disable delays, set
the second parameter to &ldquo;0&rdquo;.</p>
<p>Parameters:</p>
<ul>
<li>byte length (int)</li>
<li>time duration (time.Duration)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; chunks(1024, &quot;120ms&quot;) -&gt; &quot;https://www.example.org&quot;;
* -&gt; chunks(1024, &quot;0&quot;) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<h3 id="backendlatency">backendLatency<a class="headerlink" href="#backendlatency" title="Permanent link">&para;</a></h3>
<p>Same as <a href="#latency">latency filter</a>, but on the request path and not on
the response path.</p>
<h3 id="backendbandwidth">backendBandwidth<a class="headerlink" href="#backendbandwidth" title="Permanent link">&para;</a></h3>
<p>Same as <a href="#bandwidth">bandwidth filter</a>, but on the request path and not on
the response path.</p>
<h3 id="backendchunks">backendChunks<a class="headerlink" href="#backendchunks" title="Permanent link">&para;</a></h3>
<p>Same as <a href="#chunks">chunks filter</a>, but on the request path and not on
the response path.</p>
<h3 id="tarpit">tarpit<a class="headerlink" href="#tarpit" title="Permanent link">&para;</a></h3>
<p>The tarpit filter discards the request and respond with a never ending
stream of chunked response payloads. The goal is to consume the client
connection without letting the client know what is happening.</p>
<p>Parameters:</p>
<ul>
<li>time duration (time.Duration)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; tarpit(&quot;1s&quot;) -&gt; &lt;shunt&gt;;
</code></pre></div>
<p>The example will send every second a chunk of response payload.</p>
<h3 id="absorb">absorb<a class="headerlink" href="#absorb" title="Permanent link">&para;</a></h3>
<p>The absorb filter reads and discards the payload of the incoming requests.
It logs with INFO level and a unique ID per request:</p>
<ul>
<li>the event of receiving the request</li>
<li>partial and final events for consuming request payload and total consumed byte count</li>
<li>the finishing event of the request</li>
<li>any read errors other than EOF</li>
</ul>
<h3 id="absorbsilent">absorbSilent<a class="headerlink" href="#absorbsilent" title="Permanent link">&para;</a></h3>
<p>The absorbSilent filter reads and discards the payload of the incoming requests. It only
logs read errors other than EOF.</p>
<h3 id="uniformrequestlatency">uniformRequestLatency<a class="headerlink" href="#uniformrequestlatency" title="Permanent link">&para;</a></h3>
<p>The uniformRequestLatency filter introduces uniformly distributed
jitter latency within <code>[mean-delta, mean+delta]</code> interval for
requests. The first parameter is the mean and the second is delta. In
the example we would sleep for <code>100ms+/-10ms</code>.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; uniformRequestLatency(&quot;100ms&quot;, &quot;10ms&quot;) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<h3 id="normalrequestlatency">normalRequestLatency<a class="headerlink" href="#normalrequestlatency" title="Permanent link">&para;</a></h3>
<p>The normalRequestLatency filter introduces normally distributed jitter
latency with configured mean value for requests. The first parameter
is µ (mean) and the second is σ as in
<a href="https://en.wikipedia.org/wiki/Normal_distribution">https://en.wikipedia.org/wiki/Normal_distribution</a>.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; normalRequestLatency(&quot;10ms&quot;, &quot;5ms&quot;) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<h3 id="histogramrequestlatency">histogramRequestLatency<a class="headerlink" href="#histogramrequestlatency" title="Permanent link">&para;</a></h3>
<p>The histogramRequestLatency adds latency to requests according to the histogram distribution.
It expects a list of interleaved duration strings and numbers that defines a histogram.
Duration strings define boundaries of consecutive buckets and numbers define bucket weights.
The filter randomly selects a bucket with probability equal to its weight divided by the sum of all bucket weights
(which must be non-zero) and then sleeps for a random duration in between bucket boundaries.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>r: * -&gt; histogramRequestLatency(&quot;0ms&quot;, 50, &quot;5ms&quot;, 0, &quot;10ms&quot;, 30, &quot;15ms&quot;, 20, &quot;20ms&quot;) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<p>The example above adds a latency
* between 0ms and 5ms to 50% of the requests
* between 5ms and 10ms to 0% of the requests
* between 10ms and 15ms to 30% of the requests
* and between 15ms and 20ms to 20% of the requests.</p>
<h3 id="uniformresponselatency">uniformResponseLatency<a class="headerlink" href="#uniformresponselatency" title="Permanent link">&para;</a></h3>
<p>The uniformResponseLatency filter introduces uniformly distributed
jitter latency within <code>[mean-delta, mean+delta]</code> interval for
responses. The first parameter is the mean and the second is delta. In
the example we would sleep for <code>100ms+/-10ms</code>.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; uniformRequestLatency(&quot;100ms&quot;, &quot;10ms&quot;) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<h3 id="normalresponselatency">normalResponseLatency<a class="headerlink" href="#normalresponselatency" title="Permanent link">&para;</a></h3>
<p>The normalResponseLatency filter introduces normally distributed
jitter latency with configured mean value for responses. The first
parameter is µ (mean) and the second is σ as in
<a href="https://en.wikipedia.org/wiki/Normal_distribution">https://en.wikipedia.org/wiki/Normal_distribution</a>.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; normalRequestLatency(&quot;10ms&quot;, &quot;5ms&quot;) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<h3 id="histogramresponselatency">histogramResponseLatency<a class="headerlink" href="#histogramresponselatency" title="Permanent link">&para;</a></h3>
<p>The histogramResponseLatency adds latency to responses according to the histogram distribution, similar to <a href="#histogramrequestlatency">histogramRequestLatency</a>.</p>
<h3 id="logheader">logHeader<a class="headerlink" href="#logheader" title="Permanent link">&para;</a></h3>
<p>The <code>logHeader</code> filter prints the request line and the header, but not the body, to
stderr. Note that this filter should be used only in diagnostics setup and with care,
since the request headers may contain sensitive data, and they also can explode the
amount of logs. Authorization headers will be truncated in request and
response header logs. You can log request or response headers, which
defaults for backwards compatibility to request headers.</p>
<p>Parameters:</p>
<ul>
<li>no arg, similar to: &ldquo;request&rdquo;</li>
<li>&ldquo;request&rdquo; or &ldquo;response&rdquo; (string varargs)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; logHeader() -&gt; &quot;https://www.example.org&quot;;
* -&gt; logHeader(&quot;request&quot;) -&gt; &quot;https://www.example.org&quot;;
* -&gt; logHeader(&quot;response&quot;) -&gt; &quot;https://www.example.org&quot;;
* -&gt; logHeader(&quot;request&quot;, &quot;response&quot;) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<h3 id="logbody">logBody<a class="headerlink" href="#logbody" title="Permanent link">&para;</a></h3>
<p>The <code>logBody</code> filter logs the request or response body in chunks while
streaming. Chunks start with <code>logBody("request") $flowid:</code> or
<code>logBody("response") $flowid:</code>, such that you can find all chunks
belonging to a given flow. See also <a href="#flowid">flowId()</a> filter.</p>
<p>Note that this filter should be used only in diagnostics setup and
with care, since the request and response body may contain sensitive
data. Logs can also explode in the amount of bytes, so you have to
choose a limit. You can log request or response bodies. This filter
has close to no overhead other than the I/O created by the logger.</p>
<p>Parameters:</p>
<ul>
<li>type: &ldquo;request&rdquo; or &ldquo;response&rdquo; (string)</li>
<li>limit: maximum number of bytes to log (int)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; logBody(&quot;request&quot;, 1024) -&gt; &quot;https://www.example.org&quot;;
* -&gt; logBody(&quot;response&quot;, 1024) -&gt; &quot;https://www.example.org&quot;;
* -&gt; logBody(&quot;request&quot;, 1024) -&gt; logBody(&quot;response&quot;, 1024) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<h2 id="timeout">Timeout<a class="headerlink" href="#timeout" title="Permanent link">&para;</a></h2>
<h3 id="backendtimeout">backendTimeout<a class="headerlink" href="#backendtimeout" title="Permanent link">&para;</a></h3>
<p>Configure backend timeout. Skipper responds with <code>504 Gateway Timeout</code> status if obtaining a connection,
sending the request, and reading the backend response headers and body takes longer than the configured timeout.
However, if response streaming has already started it will be terminated, i.e. client will receive backend response
status and truncated response body.</p>
<p>Parameters:</p>
<ul>
<li>timeout <a href="https://godoc.org/time#ParseDuration">(duration string)</a></li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; backendTimeout(&quot;10ms&quot;) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<h3 id="readtimeout">readTimeout<a class="headerlink" href="#readtimeout" title="Permanent link">&para;</a></h3>
<p>Configure read timeout will set a read deadline on the server socket
connected to the client connecting to the proxy. Skipper will log 499
client timeout with context canceled. We are not able to differentiate
between client hang up and read timeout.</p>
<p>Parameters:</p>
<ul>
<li>timeout <a href="https://godoc.org/time#ParseDuration">(duration string)</a></li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; readTimeout(&quot;10ms&quot;) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<h3 id="writetimeout">writeTimeout<a class="headerlink" href="#writetimeout" title="Permanent link">&para;</a></h3>
<p>Configure write timeout will set a write deadline on the server socket
connected to the client connecting to the proxy. Skipper will show
access logs as if the response was served as expected, but the client can
show an error. You can observe an increase in streaming errors via
metrics or a in opentracing proxy span you can see Tag
<code>streamBody.byte</code> with value <code>streamBody error</code> or in debug logs
something like
<code>error while copying the response stream: write tcp 127.0.0.1:9090-&gt;127.0.0.1:38574: i/o timeout</code>.</p>
<p>Parameters:</p>
<ul>
<li>timeout <a href="https://godoc.org/time#ParseDuration">(duration string)</a></li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; writeTimeout(&quot;10ms&quot;) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<h2 id="shadow-traffic">Shadow Traffic<a class="headerlink" href="#shadow-traffic" title="Permanent link">&para;</a></h2>
<h3 id="tee">tee<a class="headerlink" href="#tee" title="Permanent link">&para;</a></h3>
<p>Provides a unix-like <code>tee</code> feature for routing.</p>
<p>Using this filter, the request will be sent to a &ldquo;shadow&rdquo; backend in addition
to the main backend of the route.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; tee(&quot;https://audit-logging.example.org&quot;) -&gt; &quot;https://foo.example.org&quot;;
</code></pre></div>
<p>This will send an identical request for foo.example.org to
audit-logging.example.org. Another use case could be using it for benchmarking
a new backend with some real traffic. This we call &ldquo;shadow traffic&rdquo;.</p>
<p>The above route will forward the request to <code>https://foo.example.org</code> as it
normally would do, but in addition to that, it will send an identical request to
<code>https://audit-logging.example.org</code>. The request sent to
<code>https://audit-logging.example.org</code> will receive the same method and headers,
and a copy of the body stream. The <code>tee</code> response is ignored for this shadow backend.</p>
<p>It is possible to change the path of the tee request, in a similar way to the
<a href="#modpath">modPath</a> filter:</p>
<div class="highlight"><pre><span></span><code>Path(&quot;/api/v1&quot;) -&gt; tee(&quot;https://api.example.org&quot;, &quot;^/v1&quot;, &quot;/v2&quot; ) -&gt; &quot;http://api.example.org&quot;;
</code></pre></div>
<p>In the above example, one can test how a new version of an API would behave on
incoming requests.</p>
<h3 id="teenf">teenf<a class="headerlink" href="#teenf" title="Permanent link">&para;</a></h3>
<p>The same as <a href="#tee">tee filter</a>, but does not follow redirects from the backend.</p>
<h3 id="teeloopback">teeLoopback<a class="headerlink" href="#teeloopback" title="Permanent link">&para;</a></h3>
<p>This filter provides a unix-like tee feature for routing, but unlike the <a href="#tee">tee</a>,
this filter feeds the copied request to the start of the routing, including the
route lookup and executing the filters on the matched route.</p>
<p>It is recommended to use this solution instead of the tee filter, because the same
routing facilities are used for the outgoing tee requests as for the normal
requests, and all the filters and backend types are supported.</p>
<p>To ensure that the right route, or one of the right set of routes, is matched
after the loopback, use the filter together with the <a href="../predicates/#tee">Tee</a>
predicate, however, this is not mandatory if the request is changed via other
filters, such that other predicates ensure matching the right route. To avoid
infinite looping, the number of requests spawn from a single incoming request
is limited similarly as in case of the
<a href="../backends/#loopback-backend">loopback backend</a>.</p>
<p>Parameters:</p>
<ul>
<li>tee group (string): a label identifying which routes should match the loopback
  request, marked with the <a href="../predicates/#tee">Tee</a> predicate</li>
</ul>
<p>Example, generate shadow traffic from 10% of the production traffic:</p>
<div class="highlight"><pre><span></span><code>main: * -&gt; &quot;https://main-backend.example.org&quot;;
split: Traffic(.1) -&gt; teeLoopback(&quot;test-A&quot;) -&gt; &quot;https://main-backend.example.org&quot;;
shadow: Tee(&quot;test-A&quot;) &amp;&amp; True() -&gt; &quot;https://test-backend.example.org&quot;;
</code></pre></div>
<p>See also:</p>
<ul>
<li><a href="../predicates/#tee">Tee predicate</a></li>
<li><a href="../../tutorials/shadow-traffic/">Shadow Traffic Tutorial</a></li>
</ul>
<h2 id="http-body">HTTP Body<a class="headerlink" href="#http-body" title="Permanent link">&para;</a></h2>
<h3 id="compress">compress<a class="headerlink" href="#compress" title="Permanent link">&para;</a></h3>
<p>The filter, when executed on the response path, checks if the response entity can
be compressed. To decide, it checks the Content-Encoding, the Cache-Control and
the Content-Type headers. It doesn&rsquo;t compress the content if the Content-Encoding
is set to other than identity, or the Cache-Control applies the no-transform
pragma, or the Content-Type is set to an unsupported value.</p>
<p>The default supported content types are: <code>text/plain</code>, <code>text/html</code>, <code>application/json</code>,
<code>application/javascript</code>, <code>application/x-javascript</code>, <code>text/javascript</code>, <code>text/css</code>,
<code>image/svg+xml</code>, <code>application/octet-stream</code>.</p>
<p>The default set of MIME types can be reset or extended by passing in the desired
types as filter arguments. When extending the defaults, the first argument needs to
be <code>"..."</code>. E.g. to compress tiff in addition to the defaults:</p>
<div class="highlight"><pre><span></span><code>* -&gt; compress(&quot;...&quot;, &quot;image/tiff&quot;) -&gt; &quot;https://www.example.org&quot;
</code></pre></div>
<p>To reset the supported types, e.g. to compress only HTML, the &ldquo;&hellip;&rdquo; argument needs
to be omitted:</p>
<div class="highlight"><pre><span></span><code>* -&gt; compress(&quot;text/html&quot;) -&gt; &quot;https://www.example.org&quot;
</code></pre></div>
<p>It is possible to control the compression level, by setting it as the first filter
argument, in front of the MIME types. The default compression level is best-speed.
The possible values are integers between 0 and 9 (inclusive), where 0 means
no-compression, 1 means best-speed and 11 means best-compression. Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; compress(11, &quot;image/tiff&quot;) -&gt; &quot;https://www.example.org&quot;
</code></pre></div>
<p>The filter also checks the incoming request, if it accepts the supported encodings,
explicitly stated in the Accept-Encoding header.
The filter currently supports by default <code>gzip</code>, <code>deflate</code> and <code>br</code> (can be overridden with flag <code>compress-encodings</code>).
It does not assume that the client accepts any encoding if the
Accept-Encoding header is not set. It ignores * in the Accept-Encoding header.</p>
<p>Supported encodings are prioritized on:
- quality value provided by client
- compress-encodings flag following order as provided if quality value is equal
- <code>gzip</code>, <code>deflate</code>, <code>br</code> in this order otherwise</p>
<p>When compressing the response, it updates the response header. It deletes the
<code>Content-Length</code> value triggering the proxy to always return the response with chunked
transfer encoding, sets the Content-Encoding to the selected encoding and sets the
<code>Vary: Accept-Encoding</code> header, if missing.</p>
<p>The compression happens in a streaming way, using only a small internal buffer.</p>
<h3 id="decompress">decompress<a class="headerlink" href="#decompress" title="Permanent link">&para;</a></h3>
<p>The filter, when executed on the response path, checks if the response entity is
compressed by a supported algorithm (<code>gzip</code>, <code>deflate</code>, <code>br</code>). To decide, it checks the Content-Encoding
header.</p>
<p>When compressing the response, it updates the response header. It deletes the
<code>Content-Length</code> value triggering the proxy to always return the response with chunked
transfer encoding, deletes the Content-Encoding and the Vary headers, if set.</p>
<p>The decompression happens in a streaming way, using only a small internal buffer.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; decompress() -&gt; &quot;https://www.example.org&quot;
</code></pre></div>
<h3 id="static">static<a class="headerlink" href="#static" title="Permanent link">&para;</a></h3>
<p>Serves static content from the filesystem.</p>
<p>Parameters:</p>
<ul>
<li>Request path to strip (string)</li>
<li>Target base path in the filesystem (string)</li>
</ul>
<p>Example:</p>
<p>This serves files from <code>/srv/www/dehydrated</code> when requested via <code>/.well-known/acme-challenge/</code>,
e.g. the request <code>GET /.well-known/acme-challenge/foo</code> will serve the file <code>/srv/www/dehydrated/foo</code>.
<div class="highlight"><pre><span></span><code>acme: Host(/./) &amp;&amp; Method(&quot;GET&quot;) &amp;&amp; Path(&quot;/.well-known/acme-challenge/*&quot;)
    -&gt; static(&quot;/.well-known/acme-challenge/&quot;, &quot;/srv/www/dehydrated&quot;) -&gt; &lt;shunt&gt;;
</code></pre></div></p>
<p>Notes:</p>
<ul>
<li>redirects to the directory when a file <code>index.html</code> exists and it is requested, i.e. <code>GET /foo/index.html</code> redirects to <code>/foo/</code> which serves then the <code>/foo/index.html</code></li>
<li>serves the content of the <code>index.html</code> when a directory is requested</li>
<li>does a simple directory listing of files / directories when no <code>index.html</code> is present</li>
</ul>
<h3 id="inlinecontent">inlineContent<a class="headerlink" href="#inlinecontent" title="Permanent link">&para;</a></h3>
<p>Returns arbitrary content in the HTTP body.</p>
<p>Parameters:</p>
<ul>
<li>content (string)</li>
<li>content type (string) - optional</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; inlineContent(&quot;&lt;h1&gt;Hello&lt;/h1&gt;&quot;) -&gt; &lt;shunt&gt;
* -&gt; inlineContent(&quot;[1,2,3]&quot;, &quot;application/json&quot;) -&gt; &lt;shunt&gt;
* -&gt; status(418) -&gt; inlineContent(&quot;Would you like a cup of tea?&quot;) -&gt; &lt;shunt&gt;
</code></pre></div>
<p>Content type will be automatically detected when not provided using <a href="https://mimesniff.spec.whatwg.org/#rules-for-identifying-an-unknown-mime-type">https://mimesniff.spec.whatwg.org/#rules-for-identifying-an-unknown-mime-type</a> algorithm.
Note that content detection algorithm does not contain any rules for recognizing JSON.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>inlineContent</code> filter sets the response on request path and starts the response path immediately.
The rest of the filter chain and backend are ignored and therefore <code>inlineContent</code> filter must be the last in the chain.</p>
</div>
<h3 id="inlinecontentifstatus">inlineContentIfStatus<a class="headerlink" href="#inlinecontentifstatus" title="Permanent link">&para;</a></h3>
<p>Returns arbitrary content in the HTTP body, if the response has the specified status code.</p>
<p>Parameters:</p>
<ul>
<li>status code (int)</li>
<li>content (string)</li>
<li>content type (string) - optional</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; inlineContentIfStatus(404, &quot;&lt;p class=\&quot;problem\&quot;&gt;We don&#39;t have what you&#39;re looking for.&lt;/p&gt;&quot;) -&gt; &quot;https://www.example.org&quot;
* -&gt; inlineContentIfStatus(401, &quot;{\&quot;error\&quot;: \&quot;unauthorized\&quot;}&quot;, &quot;application/json&quot;) -&gt; &quot;https://www.example.org&quot;
</code></pre></div>
<p>The content type will be automatically detected when not provided.</p>
<h3 id="blockcontent">blockContent<a class="headerlink" href="#blockcontent" title="Permanent link">&para;</a></h3>
<p>Block a request based on it&rsquo;s body content.</p>
<p>The filter max buffer size is 2MiB by default and can be overridden with <code>-max-matcher-buffer-size=&lt;int&gt;</code>.</p>
<p>Parameters:</p>
<ul>
<li>toblockList (List of strings)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; blockContent(&quot;Malicious Content&quot;) -&gt; &quot;http://example.com&quot;;
</code></pre></div>
<h3 id="blockcontenthex">blockContentHex<a class="headerlink" href="#blockcontenthex" title="Permanent link">&para;</a></h3>
<p>Block a request based on it&rsquo;s body content.</p>
<p>The filter max buffer size is 2MiB by default and can be overridden with <code>-max-matcher-buffer-size=&lt;int&gt;</code>.</p>
<p>Parameters:</p>
<ul>
<li>toblockList (List of hex string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>* -&gt; blockContentHex(`000a`) -&gt; &quot;http://example.com&quot;;
* -&gt; blockContentHex(&quot;deadbeef&quot;, &quot;000a&quot;) -&gt; &quot;http://example.com&quot;;
</code></pre></div>
<h3 id="sed">sed<a class="headerlink" href="#sed" title="Permanent link">&para;</a></h3>
<p>The filter sed replaces all occurrences of a pattern with a replacement string
in the response body.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>editorRoute: * -&gt; sed(&quot;foo&quot;, &quot;bar&quot;) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<p>Example with larger max buffer:</p>
<div class="highlight"><pre><span></span><code>editorRoute: * -&gt; sed(&quot;foo&quot;, &quot;bar&quot;, 64000000) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<p>This filter expects a regexp pattern and a replacement string as arguments.
During the streaming of the response body, every occurrence of the pattern will
be replaced with the replacement string. The editing doesn&rsquo;t happen right when
the filter is executed, only later when the streaming normally happens, after
all response filters were called.</p>
<p>The sed() filter accepts two optional arguments, the max editor buffer size in
bytes, and max buffer handling flag. The max buffer size, when set, defines how
much data can be buffered at a given time by the editor. The default value is
2MiB. The max buffer handling flag can take one of two values: &ldquo;abort&rdquo; or
&ldquo;best-effort&rdquo; (default). Setting &ldquo;abort&rdquo; means that the stream will be aborted
when reached the limit. Setting &ldquo;best-effort&rdquo;, will run the replacement on the
available content, in case of certain patterns, this may result in content that
is different from one that would have been edited in a single piece. See more
details below.</p>
<p>The filter uses the go regular expression implementation:
<a href="https://github.com/google/re2/wiki/Syntax">https://github.com/google/re2/wiki/Syntax</a> . Due to the streaming nature, matches
with zero length are ignored.</p>
<h4 id="memory-handling-and-limitations">Memory handling and limitations<a class="headerlink" href="#memory-handling-and-limitations" title="Permanent link">&para;</a></h4>
<p>In order to avoid unbound buffering of unprocessed data, the sed* filters need to
apply some limitations. Some patterns, e.g. <code>.*</code> would allow to match the complete
payload, and it could result in trying to buffer it all and potentially causing
running out of available memory. Similarly, in case of certain expressions, when
they don&rsquo;t match, it&rsquo;s impossible to tell if they would match without reading more
data from the source, and so would potentially need to buffer the entire payload.</p>
<p>To prevent too high memory usage, the max buffer size is limited in case of each
variant of the filter, by default to 2MiB, which is the same limit as the one we
apply when reading the request headers by default. When the limit is reached, and
the buffered content matches the pattern, then it is processed by replacing it,
when it doesn&rsquo;t match the pattern, then it is forwarded unchanged. This way, e.g.
<code>sed(".*", "")</code> can be used safely to consume and discard the payload.</p>
<p>As a result of this, with large payloads, it is possible that the resulting content
will be different than if we had run the replacement on the entire content at once.
If we have enough preliminary knowledge about the payload, then it may be better to
use the delimited variant of the filters, e.g. for line based editing.</p>
<p>If the max buffer handling is set to &ldquo;abort&rdquo;, then the stream editing is stopped
and the rest of the payload is dropped.</p>
<h3 id="seddelim">sedDelim<a class="headerlink" href="#seddelim" title="Permanent link">&para;</a></h3>
<p>Like <a href="#sed">sed()</a>, but it expects an additional argument, before the optional max buffer
size argument, that is used to delimit chunks to be processed at once. The pattern
replacement is executed only within the boundaries of the chunks defined by the
delimiter, and matches across the chunk boundaries are not considered.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>editorRoute: * -&gt; sedDelim(&quot;foo&quot;, &quot;bar&quot;, &quot;\n&quot;) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<h3 id="sedrequest">sedRequest<a class="headerlink" href="#sedrequest" title="Permanent link">&para;</a></h3>
<p>Like <a href="#sed">sed()</a>, but for the request content.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>editorRoute: * -&gt; sedRequest(&quot;foo&quot;, &quot;bar&quot;) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<h3 id="sedrequestdelim">sedRequestDelim<a class="headerlink" href="#sedrequestdelim" title="Permanent link">&para;</a></h3>
<p>Like <a href="#seddelim">sedDelim()</a>, but for the request content.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>editorRoute: * -&gt; sedRequestDelim(&quot;foo&quot;, &quot;bar&quot;, &quot;\n&quot;) -&gt; &quot;https://www.example.org&quot;;
</code></pre></div>
<h2 id="authentication-and-authorization">Authentication and Authorization<a class="headerlink" href="#authentication-and-authorization" title="Permanent link">&para;</a></h2>
<h3 id="basicauth">basicAuth<a class="headerlink" href="#basicauth" title="Permanent link">&para;</a></h3>
<p>Enable Basic Authentication</p>
<p>The filter accepts two parameters, the first mandatory one is the path to the
htpasswd file usually used with Apache or nginx. The second one is the optional
realm name that will be displayed in the browser. MD5, SHA1 and BCrypt are supported
for Basic authentication password storage, see also
<a href="https://github.com/abbot/go-http-auth">the http-auth module page</a>.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>basicAuth(&quot;/path/to/htpasswd&quot;)
basicAuth(&quot;/path/to/htpasswd&quot;, &quot;My Website&quot;)
</code></pre></div>
<h3 id="webhook">webhook<a class="headerlink" href="#webhook" title="Permanent link">&para;</a></h3>
<p>The <code>webhook</code> filter makes it possible to have your own authentication and
authorization endpoint as a filter.</p>
<p>Headers from the incoming request will be copied into the request that
is being done to the webhook endpoint. It is possible to copy headers
from the webhook response into the continuing request by specifying the
headers to copy as an optional second argument to the filter.</p>
<p>Responses from the webhook will be treated as follows:</p>
<ul>
<li>Authorized if the status code is less than 300</li>
<li>Forbidden if the status code is 403</li>
<li>Unauthorized for remaining status codes</li>
</ul>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>webhook(&quot;https://custom-webhook.example.org/auth&quot;)
webhook(&quot;https://custom-webhook.example.org/auth&quot;, &quot;X-Copy-Webhook-Header,X-Copy-Another-Header&quot;)
</code></pre></div>
<p>The webhook timeout has a default of 2 seconds and can be globally
changed, if skipper is started with <code>-webhook-timeout=2s</code> flag.</p>
<h3 id="tokeninfo">Tokeninfo<a class="headerlink" href="#tokeninfo" title="Permanent link">&para;</a></h3>
<p>Tokeninfo handled by another service.
The filters just validate the response from the tokeninfo
service to do authorization as defined in the filter.</p>
<h4 id="oauthtokeninfoanyscope">oauthTokeninfoAnyScope<a class="headerlink" href="#oauthtokeninfoanyscope" title="Permanent link">&para;</a></h4>
<p>If skipper is started with <code>-oauth2-tokeninfo-url</code> flag, you can use
this filter.</p>
<p>The filter accepts variable number of string arguments, which are used to
validate the incoming token from the <code>Authorization: Bearer &lt;token&gt;</code>
header. There are two rejection scenarios for this filter. If the token
is not successfully validated by the oauth server, then a 401 Unauthorized
response will be returned. However, if the token is successfully validated
but the required scope match isn&rsquo;t satisfied, then a 403 Forbidden response
will be returned. If any of the configured scopes from the filter is found
inside the tokeninfo result for the incoming token, it will allow the
request to pass.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>oauthTokeninfoAnyScope(&quot;s1&quot;, &quot;s2&quot;, &quot;s3&quot;)
</code></pre></div>
<h4 id="oauthtokeninfoallscope">oauthTokeninfoAllScope<a class="headerlink" href="#oauthtokeninfoallscope" title="Permanent link">&para;</a></h4>
<p>If skipper is started with <code>-oauth2-tokeninfo-url</code> flag, you can use
this filter.</p>
<p>The filter accepts variable number of string arguments, which are used to
validate the incoming token from the <code>Authorization: Bearer &lt;token&gt;</code>
header. There are two rejection scenarios for this filter. If the token
is not successfully validated by the oauth server, then a 401 Unauthorized
response will be returned. However, if the token is successfully validated
but the required scope match isn&rsquo;t satisfied, then a 403 Forbidden response
will be returned. If all of the configured scopes from the filter are found
inside the tokeninfo result for the incoming token, it will allow the
request to pass.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>oauthTokeninfoAllScope(&quot;s1&quot;, &quot;s2&quot;, &quot;s3&quot;)
</code></pre></div>
<h4 id="oauthtokeninfoanykv">oauthTokeninfoAnyKV<a class="headerlink" href="#oauthtokeninfoanykv" title="Permanent link">&para;</a></h4>
<p>If skipper is started with <code>-oauth2-tokeninfo-url</code> flag, you can use
this filter.</p>
<p>The filter accepts an even number of variable arguments of type
string, which are used to validate the incoming token from the
<code>Authorization: Bearer &lt;token&gt;</code> header. There are two rejection scenarios
for this filter. If the token is not successfully validated by the oauth
server, then a 401 Unauthorized response will be returned. However,
if the token is successfully validated but the required scope match
isn&rsquo;t satisfied, then a 403 Forbidden response will be returned.
If any of the configured key value pairs from the filter is found
inside the tokeninfo result for the incoming token, it will allow
the request to pass.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>oauthTokeninfoAnyKV(&quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;)
oauthTokeninfoAnyKV(&quot;k1&quot;, &quot;v1&quot;, &quot;k1&quot;, &quot;v2&quot;)
</code></pre></div>
<h4 id="oauthtokeninfoallkv">oauthTokeninfoAllKV<a class="headerlink" href="#oauthtokeninfoallkv" title="Permanent link">&para;</a></h4>
<p>If skipper is started with <code>-oauth2-tokeninfo-url</code> flag, you can use
this filter.</p>
<p>The filter accepts an even number of variable arguments of type
string, which are used to validate the incoming token from the
<code>Authorization: Bearer &lt;token&gt;</code> header. There are two rejection
scenarios for this filter. If the token is not successfully validated
by the oauth server, then a 401 Unauthorized response will be
returned. However, if the token is successfully validated but
the required scope match isn&rsquo;t satisfied, then a 403 Forbidden response
will be returned. If all of the configured key value pairs from
the filter are found inside the tokeninfo result for the incoming
token, it will allow the request to pass.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>oauthTokeninfoAllKV(&quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;)
</code></pre></div>
<h4 id="oauthtokeninfovalidate">oauthTokeninfoValidate<a class="headerlink" href="#oauthtokeninfovalidate" title="Permanent link">&para;</a></h4>
<blockquote>
<p>This filter is experimental and may change in the future, please see tests for example usage.</p>
</blockquote>
<p>The filter obtains token info and allows request if there was no error
otherwise it responds with <code>401 Unauthorized</code> status and configured response body.</p>
<p>It does nothing if any preceding filter already validated the token or if route is annotated with configured annotations.</p>
<p>It is useful as a default filter to ensure each request has a valid token.
<a href="#jwtmetrics">jwtMetrics</a> filter may be used to discover routes serving requests without a valid token.</p>
<p>The filter requires single string argument that is parsed as YAML.
For convenience use <a href="https://yaml.org/spec/1.2.2/#chapter-7-flow-style-productions">flow style format</a>.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>// without opt-out annotation validates the token
oauthTokeninfoValidate(&quot;{optOutAnnotations: [oauth.disabled], unauthorizedResponse: &#39;Authentication required, see https://auth.test/foo&#39;}&quot;)
</code></pre></div>
<div class="highlight"><pre><span></span><code>// with opt-out annotation does not validate the token
annotate(&quot;oauth.disabled&quot;, &quot;this endpoint is public&quot;) -&gt;
oauthTokeninfoValidate(&quot;{optOutAnnotations: [oauth.disabled], unauthorizedResponse: &#39;Authentication required, see https://auth.test/foo&#39;}&quot;)
</code></pre></div>
<div class="highlight"><pre><span></span><code>// does not validate the token when request host matches one of the patterns:
oauthTokeninfoValidate(&quot;{optOutAnnotations: [oauth.disabled], optOutHosts: [&#39;^.+[.]domain[.]test$&#39;, &#39;^exact.test$&#39;], unauthorizedResponse: &#39;Authentication required, see https://auth.test/foo&#39;}&quot;)
</code></pre></div>
<h3 id="tokenintrospection">Tokenintrospection<a class="headerlink" href="#tokenintrospection" title="Permanent link">&para;</a></h3>
<p>Tokenintrospection handled by another service.
The filters just validate the response from the tokenintrospection
service to do authorization as defined in the filter.</p>
<h4 id="oauthtokenintrospectionanyclaims">oauthTokenintrospectionAnyClaims<a class="headerlink" href="#oauthtokenintrospectionanyclaims" title="Permanent link">&para;</a></h4>
<p>The filter accepts variable number of string arguments, which are used
to validate the incoming token from the <code>Authorization: Bearer
&lt;token&gt;</code> header. The first argument to the filter is the issuer URL,
for example <code>https://accounts.google.com</code>, that will be used as
described in <a href="https://tools.ietf.org/html/draft-ietf-oauth-discovery-06#section-5">RFC Draft</a>
to find the configuration and for example supported claims.</p>
<p>If one of the configured and supported claims from the filter are
found inside the tokenintrospection (RFC7662) result for the incoming
token, it will allow the request to pass.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>oauthTokenintrospectionAnyClaims(&quot;https://accounts.google.com&quot;, &quot;c1&quot;, &quot;c2&quot;, &quot;c3&quot;)
</code></pre></div>
<h4 id="oauthtokenintrospectionallclaims">oauthTokenintrospectionAllClaims<a class="headerlink" href="#oauthtokenintrospectionallclaims" title="Permanent link">&para;</a></h4>
<p>The filter accepts variable number of string arguments, which are used
to validate the incoming token from the <code>Authorization: Bearer
&lt;token&gt;</code> header. The first argument to the filter is the issuer URL,
for example <code>https://accounts.google.com</code>, that will be used as
described in <a href="https://tools.ietf.org/html/draft-ietf-oauth-discovery-06#section-5">RFC Draft</a>
to find the configuration and for example supported claims.</p>
<p>If all of the configured and supported claims from the filter are
found inside the tokenintrospection (RFC7662) result for the incoming
token, it will allow the request to pass.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>oauthTokenintrospectionAllClaims(&quot;https://accounts.google.com&quot;, &quot;c1&quot;, &quot;c2&quot;, &quot;c3&quot;)
</code></pre></div>
<h4 id="oauthtokenintrospectionanykv">oauthTokenintrospectionAnyKV<a class="headerlink" href="#oauthtokenintrospectionanykv" title="Permanent link">&para;</a></h4>
<p>The filter accepts an even number of variable arguments of type
string, which are used to validate the incoming token from the
<code>Authorization: Bearer &lt;token&gt;</code> header.  The first argument to the
filter is the issuer URL, for example <code>https://accounts.google.com</code>,
that will be used as described in
<a href="https://tools.ietf.org/html/draft-ietf-oauth-discovery-06#section-5">RFC Draft</a>
to find the configuration and for example supported claims.</p>
<p>If one of the configured key value pairs from the filter are found
inside the tokenintrospection (RFC7662) result for the incoming token,
it will allow the request to pass.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>oauthTokenintrospectionAnyKV(&quot;https://accounts.google.com&quot;, &quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;)
oauthTokenintrospectionAnyKV(&quot;https://accounts.google.com&quot;, &quot;k1&quot;, &quot;v1&quot;, &quot;k1&quot;, &quot;v2&quot;)
</code></pre></div>
<h4 id="oauthtokenintrospectionallkv">oauthTokenintrospectionAllKV<a class="headerlink" href="#oauthtokenintrospectionallkv" title="Permanent link">&para;</a></h4>
<p>The filter accepts an even number of variable arguments of type
string, which are used to validate the incoming token from the
<code>Authorization: Bearer &lt;token&gt;</code> header.  The first argument to the
filter is the issuer URL, for example <code>https://accounts.google.com</code>,
that will be used as described in
<a href="https://tools.ietf.org/html/draft-ietf-oauth-discovery-06#section-5">RFC Draft</a>
to find the configuration and for example supported claims.</p>
<p>If all of the configured key value pairs from the filter are found
inside the tokenintrospection (RFC7662) result for the incoming token,
it will allow the request to pass.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>oauthTokenintrospectionAllKV(&quot;https://accounts.google.com&quot;, &quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;)
</code></pre></div>
<h4 id="secureoauthtokenintrospectionanyclaims">secureOauthTokenintrospectionAnyClaims<a class="headerlink" href="#secureoauthtokenintrospectionanyclaims" title="Permanent link">&para;</a></h4>
<p>The filter accepts variable number of string arguments, which are used
to validate the incoming token from the <code>Authorization: Bearer
&lt;token&gt;</code> header. The first argument to the filter is the issuer URL,
for example <code>https://accounts.google.com</code>, that will be used as
described in <a href="https://tools.ietf.org/html/draft-ietf-oauth-discovery-06#section-5">RFC Draft</a>
to find the configuration and for example supported claims.</p>
<p>Second and third arguments are the client-id and client-secret.
Use this filter if the Token Introspection endpoint requires authorization to validate and decode the incoming token.
The filter will optionally read client-id and client-secret from environment variables: OAUTH_CLIENT_ID, OAUTH_CLIENT_SECRET</p>
<p>If one of the configured and supported claims from the filter are
found inside the tokenintrospection (RFC7662) result for the incoming
token, it will allow the request to pass.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>secureOauthTokenintrospectionAnyClaims(&quot;issuerURL&quot;, &quot;client-id&quot;, &quot;client-secret&quot;, &quot;claim1&quot;, &quot;claim2&quot;)
</code></pre></div>
<p>Read client-id and client-secret from environment variables
<div class="highlight"><pre><span></span><code>secureOauthTokenintrospectionAnyClaims(&quot;issuerURL&quot;, &quot;&quot;, &quot;&quot;, &quot;claim1&quot;, &quot;claim2&quot;)
</code></pre></div></p>
<h4 id="secureoauthtokenintrospectionallclaims">secureOauthTokenintrospectionAllClaims<a class="headerlink" href="#secureoauthtokenintrospectionallclaims" title="Permanent link">&para;</a></h4>
<p>The filter accepts variable number of string arguments, which are used
to validate the incoming token from the <code>Authorization: Bearer
&lt;token&gt;</code> header. The first argument to the filter is the issuer URL,
for example <code>https://accounts.google.com</code>, that will be used as
described in <a href="https://tools.ietf.org/html/draft-ietf-oauth-discovery-06#section-5">RFC Draft</a>
to find the configuration and for example supported claims.</p>
<p>Second and third arguments are the client-id and client-secret.
Use this filter if the Token Introspection endpoint requires authorization to validate and decode the incoming token.
The filter will optionally read client-id and client-secret from environment variables: OAUTH_CLIENT_ID, OAUTH_CLIENT_SECRET</p>
<p>If all of the configured and supported claims from the filter are
found inside the tokenintrospection (RFC7662) result for the incoming
token, it will allow the request to pass.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>secureOauthTokenintrospectionAllClaims(&quot;issuerURL&quot;, &quot;client-id&quot;, &quot;client-secret&quot;, &quot;claim1&quot;, &quot;claim2&quot;)
</code></pre></div>
<p>Read client-id and client-secret from environment variables
<div class="highlight"><pre><span></span><code>secureOauthTokenintrospectionAllClaims(&quot;issuerURL&quot;, &quot;&quot;, &quot;&quot;, &quot;claim1&quot;, &quot;claim2&quot;)
</code></pre></div></p>
<h4 id="secureoauthtokenintrospectionanykv">secureOauthTokenintrospectionAnyKV<a class="headerlink" href="#secureoauthtokenintrospectionanykv" title="Permanent link">&para;</a></h4>
<p>The filter accepts an even number of variable arguments of type
string, which are used to validate the incoming token from the
<code>Authorization: Bearer &lt;token&gt;</code> header.  The first argument to the
filter is the issuer URL, for example <code>https://accounts.google.com</code>,
that will be used as described in
<a href="https://tools.ietf.org/html/draft-ietf-oauth-discovery-06#section-5">RFC Draft</a>
to find the configuration and for example supported claims.</p>
<p>Second and third arguments are the client-id and client-secret.
Use this filter if the Token Introspection endpoint requires authorization to validate and decode the incoming token.
The filter will optionally read client-id and client-secret from environment variables: OAUTH_CLIENT_ID, OAUTH_CLIENT_SECRET</p>
<p>If one of the configured key value pairs from the filter are found
inside the tokenintrospection (RFC7662) result for the incoming token,
it will allow the request to pass.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>secureOauthTokenintrospectionAnyKV(&quot;issuerURL&quot;, &quot;client-id&quot;, &quot;client-secret&quot;, &quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;)
</code></pre></div>
<p>Read client-id and client-secret from environment variables
<div class="highlight"><pre><span></span><code>secureOauthTokenintrospectionAnyKV(&quot;issuerURL&quot;, &quot;&quot;, &quot;&quot;, &quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;)
</code></pre></div></p>
<h4 id="secureoauthtokenintrospectionallkv">secureOauthTokenintrospectionAllKV<a class="headerlink" href="#secureoauthtokenintrospectionallkv" title="Permanent link">&para;</a></h4>
<p>The filter accepts an even number of variable arguments of type
string, which are used to validate the incoming token from the
<code>Authorization: Bearer &lt;token&gt;</code> header.  The first argument to the
filter is the issuer URL, for example <code>https://accounts.google.com</code>,
that will be used as described in
<a href="https://tools.ietf.org/html/draft-ietf-oauth-discovery-06#section-5">RFC Draft</a>
to find the configuration and for example supported claims.</p>
<p>Second and third arguments are the client-id and client-secret.
Use this filter if the Token Introspection endpoint requires authorization to validate and decode the incoming token.
The filter will optionally read client-id and client-secret from environment variables: OAUTH_CLIENT_ID, OAUTH_CLIENT_SECRET</p>
<p>If all of the configured key value pairs from the filter are found
inside the tokenintrospection (RFC7662) result for the incoming token,
it will allow the request to pass.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>secureOauthTokenintrospectionAllKV(&quot;issuerURL&quot;, &quot;client-id&quot;, &quot;client-secret&quot;, &quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;)
</code></pre></div>
<p>Read client-id and client-secret from environment variables
<div class="highlight"><pre><span></span><code>secureOauthTokenintrospectionAllKV(&quot;issuerURL&quot;, &quot;&quot;, &quot;&quot;, &quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;)
</code></pre></div></p>
<h3 id="jwt">JWT<a class="headerlink" href="#jwt" title="Permanent link">&para;</a></h3>
<h4 id="jwtvalidation">jwtValidation<a class="headerlink" href="#jwtvalidation" title="Permanent link">&para;</a></h4>
<p>The filter parses bearer jwt token from Authorization header and validates the signature using public keys
discovered via /.well-known/openid-configuration endpoint. Takes issuer url as single parameter.
The filter stores token claims into the state bag where they can be used by <a href="#oidcclaimsquery">oidcClaimsQuery</a>, <a href="#forwardtoken">forwardToken</a> or <a href="#forwardtokenfield">forwardTokenField</a> filters.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>jwtValidation(&quot;https://login.microsoftonline.com/{tenantId}/v2.0&quot;)
</code></pre></div>
<h4 id="jwtmetrics">jwtMetrics<a class="headerlink" href="#jwtmetrics" title="Permanent link">&para;</a></h4>
<blockquote>
<p>This filter is experimental and may change in the future, please see tests for example usage.</p>
</blockquote>
<p>The filter parses (but does not validate) JWT token from <code>Authorization</code> request header on response path
and increments the following counters:</p>
<ul>
<li><code>missing-token</code>: request does not have <code>Authorization</code> header</li>
<li><code>invalid-token-type</code>: <code>Authorization</code> header value is not a <code>Bearer</code> type</li>
<li><code>invalid-token</code>: <code>Authorization</code> header does not contain a JWT token</li>
<li><code>missing-issuer</code>: <em>DEPRECATED</em> JWT token does not have <code>iss</code> claim</li>
<li><code>invalid-issuer</code>: <em>DEPRECATED</em> JWT token does not have any of the configured issuers</li>
<li><code>invalid-claims</code>: JWT token does not have any of the configured claims</li>
</ul>
<p>Each counter name uses concatenation of request method, escaped hostname and response status as a prefix, e.g.:</p>
<div class="highlight"><pre><span></span><code>jwtMetrics.custom.GET.example_org.200.invalid-token
</code></pre></div>
<p>and therefore requires approximately <code>count(HTTP methods) * count(Hosts) * count(Statuses) * 8</code> bytes of additional memory.</p>
<p>The filter does nothing if response status is 4xx or route is opt-out via annotation, state bag value or request host pattern.</p>
<p>The filter requires single string argument that is parsed as YAML.
For convenience use <a href="https://yaml.org/spec/1.2.2/#chapter-7-flow-style-productions">flow style format</a>.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>jwtMetrics(&quot;{issuers: [&#39;https://example.com&#39;, &#39;https://example.org&#39;]}&quot;)
</code></pre></div>
<div class="highlight"><pre><span></span><code>jwtMetrics(&quot;{claims: [{&#39;iss&#39;: &#39;https://example.com&#39;, &#39;realm&#39;: &#39;emp&#39;}, {&#39;iss&#39;: &#39;https://example.org&#39;, &#39;realm&#39;: &#39;org&#39;}]}&quot;)
</code></pre></div>
<div class="highlight"><pre><span></span><code>// opt-out by annotation
annotate(&quot;oauth.disabled&quot;, &quot;this endpoint is public&quot;) -&gt;
jwtMetrics(&quot;{issuers: [&#39;https://example.com&#39;, &#39;https://example.org&#39;], optOutAnnotations: [oauth.disabled]}&quot;)

// opt-out by annotation with claims
annotate(&quot;oauth.disabled&quot;, &quot;this endpoint is public&quot;) -&gt;
jwtMetrics(&quot;{claims: [{&#39;iss&#39;: &#39;https://example.com&#39;, &#39;realm&#39;: &#39;emp&#39;}], optOutAnnotations: [oauth.disabled]}&quot;)
</code></pre></div>
<div class="highlight"><pre><span></span><code>// opt-out by state bag:
// oauthTokeninfo* and oauthGrant filters store token info in the state bag using &quot;tokeninfo&quot; key.
oauthTokeninfoAnyKV(&quot;foo&quot;, &quot;bar&quot;) -&gt;
jwtMetrics(&quot;{issuers: [&#39;https://example.com&#39;, &#39;https://example.org&#39;], optOutStateBag: [tokeninfo]}&quot;)
</code></pre></div>
<div class="highlight"><pre><span></span><code>// opt-out by matching request host pattern:
jwtMetrics(&quot;{issuers: [&#39;https://example.com&#39;, &#39;https://example.org&#39;], optOutHosts: [&#39;^.+[.]domain[.]test$&#39;, &#39;^exact.test$&#39;]}&quot;)
</code></pre></div>
<h3 id="forward-token-data">Forward Token Data<a class="headerlink" href="#forward-token-data" title="Permanent link">&para;</a></h3>
<h4 id="forwardtoken">forwardToken<a class="headerlink" href="#forwardtoken" title="Permanent link">&para;</a></h4>
<p>The filter takes the header name as its first argument and sets header value to the
token info or token introspection result serialized as a JSON object.
To include only particular fields provide their names as additional arguments.</p>
<p>If this filter is used when there is no token introspection or token info data
then it does not have any effect.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>forwardToken(&quot;X-Tokeninfo-Forward&quot;)
forwardToken(&quot;X-Tokeninfo-Forward&quot;, &quot;access_token&quot;, &quot;token_type&quot;)
</code></pre></div>
<h4 id="forwardtokenfield">forwardTokenField<a class="headerlink" href="#forwardtokenfield" title="Permanent link">&para;</a></h4>
<p>The filter takes a header name and a field as its first and second arguments. The corresponding field from the result of token info, token introspection or oidc user info is added as
corresponding header when the request is passed to the backend.</p>
<p>If this filter is used when there is no token introspection, token info or oidc user info data
then it does not have any effect.</p>
<p>To forward multiple fields filters can be sequenced</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>forwardTokenField(&quot;X-Tokeninfo-Forward-Oid&quot;, &quot;oid&quot;) -&gt; forwardTokenField(&quot;X-Tokeninfo-Forward-Sub&quot;, &quot;sub&quot;)
</code></pre></div>
<h3 id="oauth2">OAuth2<a class="headerlink" href="#oauth2" title="Permanent link">&para;</a></h3>
<h4 id="oauthgrant">oauthGrant<a class="headerlink" href="#oauthgrant" title="Permanent link">&para;</a></h4>
<p>Enables authentication and authorization with an OAuth2 authorization code grant flow as
specified by <a href="https://tools.ietf.org/html/rfc6749#section-1.3.1">RFC 6749 Section 1.3.1</a>.
Automatically redirects unauthenticated users to log in at their provider&rsquo;s authorization
endpoint. Supports token refreshing and stores access and refresh tokens in an encrypted
cookie. Supports credential rotation for the OAuth2 client ID and secret.</p>
<p>The filter consumes and drops the grant token request cookie to prevent it from leaking
to untrusted downstream services.</p>
<p>The filter will inject the OAuth2 bearer token into the request headers if the flag
<code>oauth2-access-token-header-name</code> is set.</p>
<p>The filter must be used in conjunction with the <a href="#grantcallback">grantCallback</a> filter
where the OAuth2 provider can redirect authenticated users with an authorization code.
Skipper will make sure to add the <code>grantCallback</code> filter for you to your routes when
you pass the <code>-enable-oauth2-grant-flow</code> flag.</p>
<p>The filter may be used with the <a href="#grantclaimsquery">grantClaimsQuery</a> filter to perform
authz and access control.</p>
<p>The filter also supports javascript login redirect stub that can be used e.g. to store location hash.
To enable the stub, add preceding <a href="#annotate">annotate</a> filter with <code>oauthGrant.loginRedirectStub</code> key and
content that will be served to the client with <code>200 OK</code> status instead of <code>307 Temporary Redirect</code> to the authorization URL.
The filter will replace <code>{authCodeURL}</code> (and <code>{{authCodeURL}}</code>) placeholders in the content with the actual authorization URL
and add <code>X-Auth-Code-Url</code> response header with the same value.</p>
<p>See the <a href="../../tutorials/auth/#oauth2-authorization-grant-flow">tutorial</a> for step-by-step
instructions.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>all:
    *
    -&gt; oauthGrant()
    -&gt; &quot;http://localhost:9090&quot;;
</code></pre></div>
<div class="highlight"><pre><span></span><code>single_page_app:
    *
    -&gt; annotate(&quot;oauthGrant.loginRedirectStub&quot;, `
          &lt;!doctype html&gt;
          &lt;html lang=&quot;en&quot;&gt;
            &lt;head&gt;
              &lt;title&gt;Redirecting...&lt;/title&gt;
              &lt;script&gt;
                if (window.location.hash !== null) {
                  localStorage.setItem(&#39;original-location-hash&#39;, window.location.hash);
                }
                window.location.replace(&#39;{authCodeURL}&#39;);
              &lt;/script&gt;
            &lt;/head&gt;
          &lt;/html&gt;
    `)
    -&gt; oauthGrant()
    -&gt; &quot;http://localhost:9090&quot;;
</code></pre></div>
<p>Skipper arguments:</p>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Required?</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-enable-oauth2-grant-flow</code></td>
<td><strong>yes</strong></td>
<td>toggle flag to enable the <code>oauthGrant()</code> filter. Must be set if you use the filter in routes. Example: <code>-enable-oauth2-grant-flow</code></td>
</tr>
<tr>
<td><code>-oauth2-auth-url</code></td>
<td><strong>yes</strong></td>
<td>URL of the OAuth2 provider&rsquo;s authorize endpoint. Example: <code>-oauth2-auth-url=https://identity.example.com/oauth2/authorize</code></td>
</tr>
<tr>
<td><code>-oauth2-token-url</code></td>
<td><strong>yes</strong></td>
<td>URL of the OAuth2 provider&rsquo;s token endpoint. Example: <code>-oauth2-token-url=https://identity.example.com/oauth2/token</code></td>
</tr>
<tr>
<td><code>-oauth2-tokeninfo-url</code></td>
<td><strong>yes</strong></td>
<td>URL of the OAuth2 provider&rsquo;s tokeninfo endpoint. Example: <code>-oauth2-tokeninfo-url=https://identity.example.com/oauth2/tokeninfo</code></td>
</tr>
<tr>
<td><code>-oauth2-secret-file</code></td>
<td><strong>yes</strong></td>
<td>path to the file containing the secret for encrypting and decrypting the grant token cookie (the secret can be anything). Example: <code>-oauth2-secret-file=/path/to/secret</code></td>
</tr>
<tr>
<td><code>-oauth2-client-id-file</code></td>
<td>conditional</td>
<td>path to the file containing the OAuth2 client ID. Required if you have not set <code>-oauth2-client-id</code>. Example: <code>-oauth2-client-id-file=/path/to/client_id</code></td>
</tr>
<tr>
<td><code>-oauth2-client-secret-file</code></td>
<td>conditional</td>
<td>path to the file containing the OAuth2 client secret. Required if you have not set <code>-oauth2-client-secret</code>. Example: <code>-oauth2-client-secret-file=/path/to/client_secret</code></td>
</tr>
<tr>
<td><code>-oauth2-client-id</code></td>
<td>conditional</td>
<td>OAuth2 client ID for authenticating with your OAuth2 provider. Required if you have not set <code>-oauth2-client-id-file</code> or <code>OAUTH2_CLIENT_ID</code> env variable. Example: <code>-oauth2-client-id=myclientid</code></td>
</tr>
<tr>
<td><code>-oauth2-client-secret</code></td>
<td>conditional</td>
<td>OAuth2 client secret for authenticating with your OAuth2 provider. Required if you have not set <code>-oauth2-client-secret-file</code> or <code>OAUTH2_CLIENT_SECRET</code> env variable. Example: <code>-oauth2-client-secret=myclientsecret</code></td>
</tr>
<tr>
<td><code>-credentials-update-interval</code></td>
<td>no</td>
<td>the time interval for updating client id and client secret from files. Example: <code>-credentials-update-interval=30s</code></td>
</tr>
<tr>
<td><code>-oauth2-access-token-header-name</code></td>
<td>no</td>
<td>the name of the request header where the user&rsquo;s bearer token should be set. Example: <code>-oauth2-access-token-header-name=X-Grant-Authorization</code></td>
</tr>
<tr>
<td><code>-oauth2-grant-tokeninfo-keys</code></td>
<td>no</td>
<td>comma separated list of keys to preserve in OAuth2 Grant Flow tokeninfo. Default: empty, preserves all tokeninfo keys. Example: <code>-oauth2-grant-tokeninfo-keys=scope,realm,expires_in</code></td>
</tr>
<tr>
<td><code>-oauth2-auth-url-parameters</code></td>
<td>no</td>
<td>any additional URL query parameters to set for the OAuth2 provider&rsquo;s authorize and token endpoint calls. Example: <code>-oauth2-auth-url-parameters=key1=foo,key2=bar</code></td>
</tr>
<tr>
<td><code>-oauth2-callback-path</code></td>
<td>no</td>
<td>path of the Skipper route containing the <code>grantCallback()</code> filter for accepting an authorization code and using it to get an access token. Example: <code>-oauth2-callback-path=/oauth/callback</code></td>
</tr>
<tr>
<td><code>-oauth2-token-cookie-name</code></td>
<td>no</td>
<td>the name of the cookie where the access tokens should be stored in encrypted form. Default: <code>oauth-grant</code>. Example: <code>-oauth2-token-cookie-name=SESSION</code></td>
</tr>
<tr>
<td><code>-oauth2-token-cookie-remove-subdomains</code></td>
<td>no</td>
<td>the number of subdomains to remove from the callback request hostname to obtain token cookie domain. Default: <code>1</code>. Example: <code>-oauth2-token-cookie-remove-subdomains=0</code></td>
</tr>
<tr>
<td><code>-oauth2-grant-insecure</code></td>
<td>no</td>
<td>omits <code>Secure</code> attribute of the token cookie and uses <code>http</code> scheme for callback url. Default: <code>false</code></td>
</tr>
</tbody>
</table>
<h4 id="grantcallback">grantCallback<a class="headerlink" href="#grantcallback" title="Permanent link">&para;</a></h4>
<p>The filter accepts authorization codes as a result of an OAuth2 authorization code grant
flow triggered by <a href="#oauthgrant">oauthGrant</a>. It uses the code to request access and
refresh tokens from the OAuth2 provider&rsquo;s token endpoint.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>// The callback route is automatically added when the `-enable-oauth2-grant-flow`
// flag is passed. You do not need to register it yourself. This is the equivalent
// of the route that Skipper adds for you:
callback:
    Path(&quot;/.well-known/oauth2-callback&quot;)
    -&gt; grantCallback()
    -&gt; &lt;shunt&gt;;
</code></pre></div>
<p>Skipper arguments:</p>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Required?</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-oauth2-callback-path</code></td>
<td>no</td>
<td>path of the Skipper route containing the <code>grantCallback()</code> filter. Example: <code>-oauth2-callback-path=/oauth/callback</code></td>
</tr>
</tbody>
</table>
<h4 id="grantlogout">grantLogout<a class="headerlink" href="#grantlogout" title="Permanent link">&para;</a></h4>
<p>The filter revokes the refresh and access tokens in the cookie set by
<a href="#oauthgrant">oauthGrant</a> if <code>-oauth2-revoke-token-url</code> is configured.
It also deletes the cookie by setting the <code>Set-Cookie</code> response header
to an empty value after a successful token revocation.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>grantLogout()
</code></pre></div>
<p>Skipper arguments:</p>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Required?</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-oauth2-revoke-token-url</code></td>
<td>no</td>
<td>URL of the OAuth2 provider&rsquo;s token revocation endpoint. Example: <code>-oauth2-revoke-token-url=https://identity.example.com/oauth2/revoke</code></td>
</tr>
</tbody>
</table>
<h4 id="grantclaimsquery">grantClaimsQuery<a class="headerlink" href="#grantclaimsquery" title="Permanent link">&para;</a></h4>
<p>The filter allows defining access control rules based on claims in a tokeninfo JSON
payload.</p>
<p>This filter is an alias for <code>oidcClaimsQuery</code> and functions identically to it.
See <a href="#oidcclaimsquery">oidcClaimsQuery</a> for more information.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>oauthGrant() -&gt; grantClaimsQuery(&quot;/path:@_:sub%\&quot;userid\&quot;&quot;)
oauthGrant() -&gt; grantClaimsQuery(&quot;/path:scope.#[==\&quot;email\&quot;]&quot;)
</code></pre></div>
<p>Skipper arguments:</p>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Required?</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-oauth2-tokeninfo-subject-key</code></td>
<td><strong>yes</strong></td>
<td>the key of the attribute containing the OAuth2 subject ID in the OAuth2 provider&rsquo;s tokeninfo JSON payload. Default: <code>uid</code>. Example: <code>-oauth2-tokeninfo-subject-key=sub</code></td>
</tr>
</tbody>
</table>
<h3 id="openid-connect">OpenID Connect<a class="headerlink" href="#openid-connect" title="Permanent link">&para;</a></h3>
<p>To enable OpenID Connect filters use <code>-oidc-secrets-file</code> command line flag.</p>
<h4 id="oauthoidcuserinfo">oauthOidcUserInfo<a class="headerlink" href="#oauthoidcuserinfo" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>oauthOidcUserInfo(&quot;https://oidc-provider.example.com&quot;, &quot;client_id&quot;, &quot;client_secret&quot;,
    &quot;http://target.example.com/subpath/callback&quot;, &quot;email profile&quot;, &quot;name email picture&quot;,
    &quot;parameter=value&quot;, &quot;X-Auth-Authorization:claims.email&quot;, &quot;0&quot;)
</code></pre></div>
<p>The filter needs the following parameters:</p>
<ul>
<li><strong>OpenID Connect Provider URL</strong> For example Google OpenID Connect is available on <code>https://accounts.google.com</code></li>
<li><strong>Client ID</strong> This value is obtained from the provider upon registration of the application. Falls back to<code>OIDC_CLIENT_ID</code> env variable for empty value.</li>
<li><strong>Client Secret</strong>  Also obtained from the provider. Falls back to <code>OIDC_CLIENT_SECRET</code> env variable for empty value.</li>
<li><strong>Callback URL</strong> The entire path to the callback from the provider on which the token will be received.
    It can be any value which is a subpath on which the filter is applied.</li>
<li><strong>Scopes</strong> The OpenID scopes separated by spaces which need to be specified when requesting the token from the provider.</li>
<li><strong>Claims</strong> The claims which should be present in the token returned by the provider.</li>
<li><strong>Auth Code Options</strong> (optional) Passes key/value parameters to a provider&rsquo;s authorization endpoint. The value can be dynamically set by a query parameter with the same key name if the placeholder <code>skipper-request-query</code> is used.</li>
<li><strong>Upstream Headers</strong> (optional) The upstream endpoint will receive these headers which values are parsed from the OIDC information. The header definition can be one or more header-query pairs, space delimited. The query syntax is <a href="https://github.com/tidwall/gjson/blob/master/SYNTAX.md">GJSON</a>.</li>
<li><strong>SubdomainsToRemove</strong> (optional, default &ldquo;1&rdquo;) Configures number of subdomains to remove from the request hostname to derive OIDC cookie domain. By default one subdomain is removed, e.g. for the <a href="http://www.example.com">www.example.com</a> request hostname the OIDC cookie domain will be example.com (to support SSO for all subdomains of the example.com). Configure &ldquo;0&rdquo; to use the same hostname. Note that value is a string.</li>
<li><strong>Custom Cookie Name</strong> (optional) Defines a constant cookie name generated by the OIDC filter. By default the cookie name is SkipperOauthOidc{hash}, where {hash} is a generated value.</li>
</ul>
<p>Skipper arguments:</p>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Required?</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-oidc-cookie-remove-subdomains</code></td>
<td>no</td>
<td>Default number of subdomains to remove from the request hostname to derive OIDC cookie domain. The filter parameter overwrites the default when provided. Default: <code>1</code>. Example: <code>-oidc-cookie-remove-subdomains="0"</code></td>
</tr>
</tbody>
</table>
<h4 id="oauthoidcanyclaims">oauthOidcAnyClaims<a class="headerlink" href="#oauthoidcanyclaims" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>oauthOidcAnyClaims(&quot;https://oidc-provider.example.com&quot;, &quot;client_id&quot;, &quot;client_secret&quot;,
    &quot;http://target.example.com/subpath/callback&quot;, &quot;email profile&quot;, &quot;name email picture&quot;,
    &quot;parameter=value&quot;, &quot;X-Auth-Authorization:claims.email&quot;)
</code></pre></div>
<p>The filter needs the following parameters:</p>
<ul>
<li><strong>OpenID Connect Provider URL</strong> For example Google OpenID Connect is available on <code>https://accounts.google.com</code></li>
<li><strong>Client ID</strong> This value is obtained from the provider upon registration of the application.</li>
<li><strong>Client Secret</strong>  Also obtained from the provider</li>
<li><strong>Callback URL</strong> The entire path to the callback from the provider on which the token will be received.
    It can be any value which is a subpath on which the filter is applied.</li>
<li><strong>Scopes</strong> The OpenID scopes separated by spaces which need to be specified when requesting the token from the provider.</li>
<li><strong>Claims</strong> Several claims can be specified and the request is allowed as long as at least one of them is present.</li>
<li><strong>Auth Code Options</strong> (optional) Passes key/value parameters to a provider&rsquo;s authorization endpoint. The value can be dynamically set by a query parameter with the same key name if the placeholder <code>skipper-request-query</code> is used.</li>
<li><strong>Upstream Headers</strong> (optional) The upstream endpoint will receive these headers which values are parsed from the OIDC information. The header definition can be one or more header-query pairs, space delimited. The query syntax is <a href="https://github.com/tidwall/gjson/blob/master/SYNTAX.md">GJSON</a>.</li>
<li><strong>SubdomainsToRemove</strong> (optional, default &ldquo;1&rdquo;) Configures number of subdomains to remove from the request hostname to derive OIDC cookie domain. By default one subdomain is removed, e.g. for the <a href="http://www.example.com">www.example.com</a> request hostname the OIDC cookie domain will be example.com (to support SSO for all subdomains of the example.com). Configure &ldquo;0&rdquo; to use the same hostname. Note that value is a string.</li>
</ul>
<p>Skipper arguments:</p>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Required?</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-oidc-cookie-remove-subdomains</code></td>
<td>no</td>
<td>Default number of subdomains to remove from the request hostname to derive OIDC cookie domain. The filter parameter overwrites the default when provided. Default: <code>1</code>. Example: <code>-oidc-cookie-remove-subdomains="0"</code></td>
</tr>
</tbody>
</table>
<h4 id="oauthoidcallclaims">oauthOidcAllClaims<a class="headerlink" href="#oauthoidcallclaims" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>oauthOidcAllClaims(&quot;https://oidc-provider.example.com&quot;, &quot;client_id&quot;, &quot;client_secret&quot;,
    &quot;http://target.example.com/subpath/callback&quot;, &quot;email profile&quot;, &quot;name email picture&quot;,
    &quot;parameter=value&quot;, &quot;X-Auth-Authorization:claims.email&quot;)
</code></pre></div>
<p>The filter needs the following parameters:</p>
<ul>
<li><strong>OpenID Connect Provider URL</strong> For example Google OpenID Connect is available on <code>https://accounts.google.com</code></li>
<li><strong>Client ID</strong> This value is obtained from the provider upon registration of the application.</li>
<li><strong>Client Secret</strong>  Also obtained from the provider</li>
<li><strong>Callback URL</strong> The entire path to the callback from the provider on which the token will be received.
    It can be any value which is a subpath on which the filter is applied.</li>
<li><strong>Scopes</strong> The OpenID scopes separated by spaces which need to be specified when requesting the token from the provider.</li>
<li><strong>Claims</strong> Several claims can be specified and the request is allowed only when all claims are present.</li>
<li><strong>Auth Code Options</strong> (optional) Passes key/value parameters to a provider&rsquo;s authorization endpoint. The value can be dynamically set by a query parameter with the same key name if the placeholder <code>skipper-request-query</code> is used.</li>
<li><strong>Upstream Headers</strong> (optional) The upstream endpoint will receive these headers which values are parsed from the OIDC information. The header definition can be one or more header-query pairs, space delimited. The query syntax is <a href="https://github.com/tidwall/gjson/blob/master/SYNTAX.md">GJSON</a>.</li>
<li><strong>SubdomainsToRemove</strong> (optional, default &ldquo;1&rdquo;) Configures number of subdomains to remove from the request hostname to derive OIDC cookie domain. By default one subdomain is removed, e.g. for the <a href="http://www.example.com">www.example.com</a> request hostname the OIDC cookie domain will be example.com (to support SSO for all subdomains of the example.com). Configure &ldquo;0&rdquo; to use the same hostname. Note that value is a string.</li>
</ul>
<p>Skipper arguments:</p>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Required?</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-oidc-cookie-remove-subdomains</code></td>
<td>no</td>
<td>Default number of subdomains to remove from the request hostname to derive OIDC cookie domain. The filter parameter overwrites the default when provided. Default: <code>1</code>. Example: <code>-oidc-cookie-remove-subdomains="0"</code></td>
</tr>
</tbody>
</table>
<h4 id="oidcclaimsquery">oidcClaimsQuery<a class="headerlink" href="#oidcclaimsquery" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>oidcClaimsQuery(&quot;&lt;path&gt;:[&lt;query&gt;]&quot;, ...)
</code></pre></div>
<p>The filter is chained after <code>oauthOidc*</code> authentication as it parses the ID token that has been saved in the internal <code>StateBag</code> for this request. It validates access control of the requested path against the defined query.
It accepts one or more arguments, that is a path prefix which is granted access to when the query definition evaluates positive.
It supports exact matches of keys, key-value pairs, introspecting of arrays or exact and wildcard matching of nested structures.
The query definition can be one or more queries per path, space delimited. The query syntax is <a href="https://github.com/tidwall/gjson/blob/master/SYNTAX.md">GJSON</a> with a convenience modifier of <code>@_</code> which unfolds to <code>[@this].#("+arg+")</code></p>
<p>Given following example ID token:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;someone@example.org&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;groups&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;CD-xyz&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;appX-Test-Users&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;Purchasing-Department&quot;</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Some One&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>Access to path <code>/</code> would be granted to everyone in <code>example.org</code>, however path <code>/login</code> only to those being member of <code>group "appX-Tester"</code>:</p>
<div class="highlight"><pre><span></span><code>oauthOidcAnyClaims(...) -&gt; oidcClaimsQuery(&quot;/login:groups.#[==\&quot;appX-Tester\&quot;]&quot;, &quot;/:@_:email%\&quot;*@example.org\&quot;&quot;)
</code></pre></div>
<p>For above ID token following query definitions would also be positive:</p>
<div class="highlight"><pre><span></span><code>oidcClaimsQuery(&quot;/:email&quot;)
oidcClaimsQuery(&quot;/another/path:groups.#[%\&quot;CD-*\&quot;]&quot;)
oidcClaimsQuery(&quot;/:name%\&quot;*One\&quot;&quot;, &quot;/path:groups.#[%\&quot;*-Test-Users\&quot;] groups.#[==\&quot;Purchasing-Department\&quot;]&quot;)
</code></pre></div>
<p>As of now there is no negative/deny rule possible. The first matching path is evaluated against the defined query/queries and if positive, permitted.</p>
<h3 id="open-policy-agent">Open Policy Agent<a class="headerlink" href="#open-policy-agent" title="Permanent link">&para;</a></h3>
<p>To get started with <a href="https://www.openpolicyagent.org/">Open Policy Agent</a>, also have a look at the <a href="../../tutorials/auth/#open-policy-agent">tutorial</a>. This section is only a reference for the implemented filters.</p>
<h4 id="opaauthorizerequest">opaAuthorizeRequest<a class="headerlink" href="#opaauthorizerequest" title="Permanent link">&para;</a></h4>
<p>The canonical use case that is also implemented with <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/ext_authz_filter">Envoy External Authorization</a>: Use the http request to evaluate if Skipper should deny the request (with customizable response) or let the request pass to the downstream service</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>opaAuthorizeRequest(&quot;my-app-id&quot;)
</code></pre></div>
<p>Example (passing context):
<div class="highlight"><pre><span></span><code>opaAuthorizeRequest(&quot;my-app-id&quot;, &quot;com.mydomain.xxx.myprop: myvalue&quot;)
</code></pre></div></p>
<p><em>Data Flows</em></p>
<p>The data flow in case the policy allows the request looks like this</p>
<div class="highlight"><pre><span></span><code>             ┌──────────────────┐               ┌────────────────────┐
 (1) Request │     Skipper      │ (4) Request   │ Target Application │
─────────────┤                  ├──────────────►│                    │
             │                  │               │                    │
 (6) Response│   (2)│   ▲ (3)   │ (5) Response  │                    │
◄────────────┤Req -&gt;│   │ allow │◄──────────────┤                    │
             │Input │   │       │               │                    │
             ├──────┴───┴───────┤               └────────────────────┘
             │Open Policy Agent │
             │      │   │       │
             │      │   │       │
             │      │   │       │
             │      ▼   │       │
             │ ┌────────┴─────┐ │
             │ │   Policy     │ │
             │ └──────────────┘ │
             │                  │
             └──────────────────┘
</code></pre></div>
<p>In Step (2) the http request is transformed into an input object following the <a href="https://www.envoyproxy.io/docs/envoy/latest/api-v3/service/auth/v3/external_auth.proto#service-auth-v3-checkrequest">Envoy structure</a> that is also used by the OPA Envoy plugin. In (3) the decision of the policy is evaluated. If it is equivalent to an &ldquo;allow&rdquo;, the remaining steps are executed as without the filter.</p>
<p>The data flow in case the policy disallows the request looks like this</p>
<div class="highlight"><pre><span></span><code>             ┌──────────────────┐               ┌────────────────────┐
 (1) Request │     Skipper      │               │ Target Application │
─────────────┤                  ├──────────────►│                    │
             │                  │               │                    │
 (4) Response│   (2)│   ▲ (3)   │               │                    │
◄────────────┤Req -&gt;│   │ allow │◄──────────────┤                    │
             │Input │   │ =false│               │                    │
             ├──────┴───┴───────┤               └────────────────────┘
             │Open Policy Agent │
             │      │   │       │
             │      │   │       │
             │      │   │       │
             │      ▼   │       │
             │ ┌────────┴─────┐ │
             │ │   Policy     │ │
             │ └──────────────┘ │
             │                  │
             └──────────────────┘
</code></pre></div>
<p>The difference is that if the decision in (3) is equivalent to false, the response is handled directly from the filter. If the decision contains response body, status or headers those are used to build the response in (6) otherwise a 403 Forbidden with a generic body is returned.</p>
<p><em>Manipulating Request Headers</em></p>
<p>Headers both to the upstream and the downstream service can be manipulated the same way this works for <a href="https://www.openpolicyagent.org/docs/envoy/primer#example-policy-with-additional-controls">Envoy external authorization</a></p>
<p>This allows both to add and remove unwanted headers in allow/deny cases.</p>
<h4 id="opaauthorizerequestwithbody">opaAuthorizeRequestWithBody<a class="headerlink" href="#opaauthorizerequestwithbody" title="Permanent link">&para;</a></h4>
<p>Requests can also be authorized based on the request body the same way that is supported with the <a href="https://www.openpolicyagent.org/docs/envoy/primer#example-input">Open Policy Agent Envoy plugin</a>, look for the input attribute <code>parsed_body</code> in the upstream documentation.</p>
<p>This filter has the same parameters that the <code>opaAuthorizeRequest</code> filter has.</p>
<p>A request&rsquo;s body is parsed up to a maximum size with a default of 1MB that can be configured via the <code>-open-policy-agent-max-request-body-size</code> command line argument. To avoid OOM errors due to too many concurrent authorized body requests, another flag <code>-open-policy-agent-max-memory-body-parsing</code> controls how much memory can be used across all requests with a default of 100MB. If in-flight requests that use body authorization exceed that limit, incoming requests that use the body will be rejected with an internal server error. The number of concurrent requests is</p>
<div class="arithmatex">\[ n_{max-memory-body-parsing} \over min(avg(n_{request-content-length}), n_{max-request-body-size}) \]</div>
<p>so if requests on average have 100KB and the maximum memory is set to 100MB, on average 1024 authorized requests can be processed concurrently.</p>
<p>The filter also honors the <code>skip-request-body-parse</code> of the corresponding <a href="https://www.openpolicyagent.org/docs/latest/envoy-introduction/#configuration">configuration</a> that the OPA plugin uses.</p>
<h4 id="opaserveresponse">opaServeResponse<a class="headerlink" href="#opaserveresponse" title="Permanent link">&para;</a></h4>
<p>Always serves the response even if the policy allows the request and can customize the response completely. Can be used to re-implement legacy authorization services by already using data in Open Policy Agent but implementing an old REST API. This can also be useful to support Single Page Applications to return the calling users&rsquo; permissions.</p>
<p><em>Hint</em>: As there is no real allow/deny in this case and the policy computes the http response, you typically will want to <a href="https://www.openpolicyagent.org/docs/latest/management-decision-logs/#drop-decision-logs">drop all decision logs</a></p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>opaServeResponse(&quot;my-app-id&quot;)
</code></pre></div>
<p>Example (passing context):
<div class="highlight"><pre><span></span><code>opaServeResponse(&quot;my-app-id&quot;, &quot;com.mydomain.xxx.myprop: myvalue&quot;)
</code></pre></div></p>
<p><em>Data Flows</em></p>
<p>For this filter, the data flow looks like this independent of an allow/deny decision</p>
<div class="highlight"><pre><span></span><code>             ┌──────────────────┐
 (1) Request │     Skipper      │
─────────────┤                  ├
             │                  │
 (4) Response│   (2)│   ▲ (3)   │
◄────────────┤Req -&gt;│   │ resp  │
             │Input │   │       │
             ├──────┴───┴───────┤
             │Open Policy Agent │
             │      │   │       │
             │      │   │       │
             │      │   │       │
             │      ▼   │       │
             │ ┌────────┴─────┐ │
             │ │   Policy     │ │
             │ └──────────────┘ │
             │                  │
             └──────────────────┘
</code></pre></div>
<h4 id="opaserveresponsewithreqbody">opaServeResponseWithReqBody<a class="headerlink" href="#opaserveresponsewithreqbody" title="Permanent link">&para;</a></h4>
<p>If you want to serve requests directly from an Open Policy Agent policy that uses the request body, this can be done by using the <code>input.parsed_body</code> attribute the same way that is supported with the <a href="https://www.openpolicyagent.org/docs/envoy/primer#example-input">Open Policy Agent Envoy plugin</a>.</p>
<p>This filter has the same parameters that the <code>opaServeResponse</code> filter has.</p>
<p>A request&rsquo;s body is parsed up to a maximum size with a default of 1MB that can be configured via the <code>-open-policy-agent-max-request-body-size</code> command line argument. To avoid OOM errors due to too many concurrent authorized body requests, another flag <code>-open-policy-agent-max-memory-body-parsing</code> controls how much memory can be used across all requests with a default of 100MB. If  in-flight requests that use body authorization exceed that limit, incoming requests that use the body will be rejected with an internal server error. The number of concurrent requests is</p>
<div class="arithmatex">\[ n_{max-memory-body-parsing} \over min(avg(n_{request-content-length}), n_{max-request-body-size}) \]</div>
<p>so if requests on average have 100KB and the maximum memory is set to 100MB, on average 1024 authorized requests can be processed concurrently.</p>
<p>The filter also honors the <code>skip-request-body-parse</code> of the corresponding <a href="https://www.openpolicyagent.org/docs/latest/envoy-introduction/#configuration">configuration</a> that the OPA plugin uses.</p>
<h3 id="awssigv4">awsSigv4<a class="headerlink" href="#awssigv4" title="Permanent link">&para;</a></h3>
<p>This filter signs request using <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/sig-v4-authenticating-requests.html_">AWS Sig V4</a> algorithm. The requests must provide following headers in order for this filter to generate a valid signature.</p>
<ul>
<li><code>x-amz-accesskey</code>  header must contain a valid AWS access key</li>
<li><code>x-amz-secret</code> header must contain a valid secret for AWS client being used.</li>
<li><code>x-amz-time</code> header must contain the time in RFC3339 format which this filter can use to generate signature and <code>X-Amz-Date</code> header on signed request. This time stamp is considered as the time stamp of generated signature.</li>
<li><code>x-amz-session</code> must contain valid AWS session token (<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_use-resources.html#using-temp-creds-sdk">see</a>) to be set as <code>X-Amz-Security-Token</code> in signed request when <code>DisableSessionToken</code> parameter defined on route is set to false.</li>
</ul>
<p>Filter removes these headers after reading the values. Once the signature is generated, it is appended to existing Authorization header or if there is no exisiting Authorization header, added as new and forwarded to AWS service.</p>
<p>awsSigv4 filter can be defined on a route as <code>awsSigv4("&lt;service&gt;, "&lt;region&gt;", &lt;DisableHeaderHoisting&gt;, &lt;DisableURIPathEscaping&gt;, &lt;DisableSessionToken&gt;)</code></p>
<p>An example of route with awsSigv4 filter is
    <code>editorRoute: * -&gt; awsSigv4("dynamodb" , "us-east-1", false, false, false) -&gt; "https://dynamodb.us-east-1.amazonaws.com";</code></p>
<p>This filter expects:</p>
<ul>
<li>
<p><code>Service</code> An aws service name. Please refer valid service names from service endpoint.
        For example if service endpoint is <a href="https://dynamodb.us-east-1.amazonaws.com">https://dynamodb.us-east-1.amazonaws.com</a>, then service is dynamodb</p>
</li>
<li>
<p><code>Region</code> AWS region where service is located. Please refer valid service names from service endpoint.
        For example if service endpoint is <a href="https://dynamodb.us-east-1.amazonaws.com">https://dynamodb.us-east-1.amazonaws.com</a>, then region is us-east-1.</p>
</li>
<li>
<p><code>DisableHeaderHoisting</code> Disables the Signer&rsquo;s moving HTTP header key/value pairs from the HTTP request header to the request&rsquo;s query string. This is most commonly used
        with pre-signed requests preventing headers from being added to the request&rsquo;s query string.</p>
</li>
<li>
<p><code>DisableURIPathEscaping</code> Disables the automatic escaping of the URI path of the request for the siganture&rsquo;s canonical string&rsquo;s path. For services that do not need additional
        escaping then use this to disable the signer escaping the path. S3 is an example of a service that does not need additional escaping.
        <a href="http://docs.aws.amazon.com/general/latest/gr/sigv4-create-canonical-request.html">http://docs.aws.amazon.com/general/latest/gr/sigv4-create-canonical-request.html</a></p>
</li>
<li>
<p><code>DisableSessionToken</code> Disables setting the session token on the request as part of signing through X-Amz-Security-Token. This is needed for variations of v4 that
        present the token elsewhere.</p>
</li>
</ul>
<h4 id="memory-consideration">Memory consideration<a class="headerlink" href="#memory-consideration" title="Permanent link">&para;</a></h4>
<p>This filter reads the body in memory. This is needed to generate signature as per Signature V4 specs. Special considerations need to be taken when operating the skipper with concurrent requests.</p>
<h4 id="overwriting-ioreadcloser">Overwriting io.ReadCloser<a class="headerlink" href="#overwriting-ioreadcloser" title="Permanent link">&para;</a></h4>
<p>This filter resets <code>read</code> and <code>close</code> implementations of body to default. So in case a filter before this filter has some custom implementations of thse methods, they would be overwritten.</p>
<h2 id="cookie-handling">Cookie Handling<a class="headerlink" href="#cookie-handling" title="Permanent link">&para;</a></h2>
<h3 id="droprequestcookie">dropRequestCookie<a class="headerlink" href="#droprequestcookie" title="Permanent link">&para;</a></h3>
<p>Deletes given cookie from the request header.</p>
<p>Parameters:</p>
<ul>
<li>cookie name (string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>dropRequestCookie(&quot;test-session&quot;)
</code></pre></div>
<h3 id="dropresponsecookie">dropResponseCookie<a class="headerlink" href="#dropresponsecookie" title="Permanent link">&para;</a></h3>
<p>Deletes given cookie from the response header.</p>
<p>Parameters:</p>
<ul>
<li>cookie name (string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>dropResponseCookie(&quot;test-session&quot;)
</code></pre></div>
<h3 id="requestcookie">requestCookie<a class="headerlink" href="#requestcookie" title="Permanent link">&para;</a></h3>
<p>Append a cookie to the request header.</p>
<p>Parameters:</p>
<ul>
<li>cookie name (string)</li>
<li>cookie value (string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>requestCookie(&quot;test-session&quot;, &quot;abc&quot;)
</code></pre></div>
<h3 id="responsecookie">responseCookie<a class="headerlink" href="#responsecookie" title="Permanent link">&para;</a></h3>
<p>Appends a cookie to the response via &ldquo;Set-Cookie&rdquo; header.
It derives cookie domain by removing one subdomain from the request hostname domain.
The filter accepts an optional argument to set the <code>Max-Age</code> attribute of the cookie, of type <code>int</code>, in seconds.
Use zero to expire the cookie immediately.
An optional fourth argument, &ldquo;change-only&rdquo;, controls if the cookie should be set on every
response, or only if the request does not contain a cookie with the provided
name and value.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>responseCookie(&quot;test-session&quot;, &quot;abc&quot;)
responseCookie(&quot;test-session&quot;, &quot;abc&quot;, 31536000),
responseCookie(&quot;test-session&quot;, &quot;abc&quot;, 31536000, &quot;change-only&quot;)
responseCookie(&quot;test-session&quot;, &quot;deleted&quot;, 0),
</code></pre></div>
<h3 id="jscookie">jsCookie<a class="headerlink" href="#jscookie" title="Permanent link">&para;</a></h3>
<p>The JS cookie behaves exactly as the response cookie, but it does not set the
<code>HttpOnly</code> directive, so these cookies will be accessible from JS code running
in web browsers.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>jsCookie(&quot;test-session-info&quot;, &quot;abc-debug&quot;, 31536000, &quot;change-only&quot;)
</code></pre></div>
<h2 id="circuit-breakers">Circuit Breakers<a class="headerlink" href="#circuit-breakers" title="Permanent link">&para;</a></h2>
<h3 id="consecutivebreaker">consecutiveBreaker<a class="headerlink" href="#consecutivebreaker" title="Permanent link">&para;</a></h3>
<p>This breaker opens when the proxy could not connect to a backend or received
a &gt;=500 status code at least N times in a row. When open, the proxy returns
503 - Service Unavailable response during the breaker timeout. After this timeout,
the breaker goes into half-open state, in which it expects that M number of
requests succeed. The requests in the half-open state are accepted concurrently.
If any of the requests during the half-open state fails, the breaker goes back to
open state. If all succeed, it goes to closed state again.</p>
<p>Parameters:</p>
<ul>
<li>number of consecutive failures to open (int)</li>
<li>timeout (time string, parsable by <a href="https://godoc.org/time#ParseDuration">time.Duration</a>) - optional</li>
<li>half-open requests (int) - optional</li>
<li>idle-ttl (time string, parsable by <a href="https://godoc.org/time#ParseDuration">time.Duration</a>) - optional</li>
</ul>
<p>See also the <a href="https://godoc.org/github.com/zalando/skipper/circuit">circuit breaker docs</a>.</p>
<p>Can be used as <a href="../egress/">egress</a> feature.</p>
<h3 id="ratebreaker">rateBreaker<a class="headerlink" href="#ratebreaker" title="Permanent link">&para;</a></h3>
<p>The &ldquo;rate breaker&rdquo; works similar to the <a href="#consecutivebreaker">consecutiveBreaker</a>, but
instead of considering N consecutive failures for going open, it maintains a sliding
window of the last M events, both successes and failures, and opens only when the number
of failures reaches N within the window. This way the sliding window is not time based
and allows the same breaker characteristics for low and high rate traffic.</p>
<p>Parameters:</p>
<ul>
<li>number of consecutive failures to open (int)</li>
<li>sliding window (int)</li>
<li>timeout (time string, parsable by <a href="https://godoc.org/time#ParseDuration">time.Duration</a>) - optional</li>
<li>half-open requests (int) - optional</li>
<li>idle-ttl (time string, parsable by <a href="https://godoc.org/time#ParseDuration">time.Duration</a>) - optional</li>
</ul>
<p>See also the <a href="https://godoc.org/github.com/zalando/skipper/circuit">circuit breaker docs</a>.</p>
<p>Can be used as <a href="../egress/">egress</a> feature.</p>
<h3 id="disablebreaker">disableBreaker<a class="headerlink" href="#disablebreaker" title="Permanent link">&para;</a></h3>
<p>Change (or set) the breaker configurations for an individual route and disable for another, in eskip:</p>
<div class="highlight"><pre><span></span><code>updates: Method(&quot;POST&quot;) &amp;&amp; Host(&quot;foo.example.org&quot;)
  -&gt; consecutiveBreaker(9)
  -&gt; &quot;https://foo.backend.net&quot;;

backendHealthcheck: Path(&quot;/healthcheck&quot;)
  -&gt; disableBreaker()
  -&gt; &quot;https://foo.backend.net&quot;;
</code></pre></div>
<p>See also the <a href="https://godoc.org/github.com/zalando/skipper/circuit">circuit breaker docs</a>.</p>
<p>Can be used as <a href="../egress/">egress</a> feature.</p>
<h2 id="rate-limit">Rate Limit<a class="headerlink" href="#rate-limit" title="Permanent link">&para;</a></h2>
<h3 id="localratelimit"><del>localRatelimit</del><a class="headerlink" href="#localratelimit" title="Permanent link">&para;</a></h3>
<p><strong>DEPRECATED</strong> use <a href="#clientratelimit">clientRatelimit</a> with the same
  settings instead.</p>
<h3 id="clientratelimit">clientRatelimit<a class="headerlink" href="#clientratelimit" title="Permanent link">&para;</a></h3>
<p>Per skipper instance calculated ratelimit, that allows number of
requests by client. The definition of the same client is based on data
of the http header and can be changed with an optional third
parameter. If the third parameter is set skipper will use the
defined HTTP header to put the request in the same client bucket,
else the X-Forwarded-For Header will be used. You need to run skipper
with command line flag <code>-enable-ratelimits</code>.</p>
<p>One filter consumes memory calculated by the following formula, where
N is the number of individual clients put into the same bucket, M the
maximum number of requests allowed:</p>
<div class="highlight"><pre><span></span><code>memory = N * M * 15 byte
</code></pre></div>
<p>Memory usage examples:</p>
<ul>
<li>5MB   for M=3  and N=100000</li>
<li>15MB  for M=10 and N=100000</li>
<li>150MB for M=100 and N=100000</li>
</ul>
<p>Parameters:</p>
<ul>
<li>number of allowed requests per time period (int)</li>
<li>time period for requests being counted (time.Duration)</li>
<li>optional parameter to set the same client by header, in case the provided string contains <code>,</code>, it will combine all these headers (string)</li>
</ul>
<div class="highlight"><pre><span></span><code>clientRatelimit(3, &quot;1m&quot;)
clientRatelimit(3, &quot;1m&quot;, &quot;Authorization&quot;)
clientRatelimit(3, &quot;1m&quot;, &quot;X-Foo,Authorization,X-Bar&quot;)
</code></pre></div>
<p>See also the <a href="https://godoc.org/github.com/zalando/skipper/ratelimit">ratelimit docs</a>.</p>
<h3 id="ratelimit">ratelimit<a class="headerlink" href="#ratelimit" title="Permanent link">&para;</a></h3>
<p>Per skipper instance calculated ratelimit, that allows forwarding a
number of requests to the backend group. You need to run skipper with
command line flag <code>-enable-ratelimits</code>.</p>
<p>Parameters:</p>
<ul>
<li>number of allowed requests per time period (int)</li>
<li>time period for requests being counted (time.Duration)</li>
<li>response status code to use for a rate limited request - optional, default: 429</li>
</ul>
<div class="highlight"><pre><span></span><code>ratelimit(20, &quot;1m&quot;)
ratelimit(300, &quot;1h&quot;)
ratelimit(4000, &quot;1m&quot;, 503)
</code></pre></div>
<p>See also the <a href="https://godoc.org/github.com/zalando/skipper/ratelimit">ratelimit docs</a>.</p>
<h3 id="clusterclientratelimit">clusterClientRatelimit<a class="headerlink" href="#clusterclientratelimit" title="Permanent link">&para;</a></h3>
<p>This ratelimit is calculated across all skipper peers and the same
rate limit group. The first parameter is a string to select the same
ratelimit group across one or more routes.
The rate limit group allows the given number of requests by client.
The client identity is derived from the value of the <code>X-Forwarded-For</code> header or client IP address
and can be changed with an optional fourth parameter.
The optional fourth parameter may specify comma-separated list of header names.
Skipper will join header values to obtain client identity.
If identity value is empty (i.e. when all header values are empty or missing) then ratelimit does not apply.</p>
<p>You need to run skipper with command line flags <code>-enable-swarm</code> and
<code>-enable-ratelimits</code>. See also our <a href="../../tutorials/ratelimit/#cluster-ratelimit">cluster ratelimit tutorial</a></p>
<p>Parameters:</p>
<ul>
<li>rate limit group (string)</li>
<li>number of allowed requests per time period (int)</li>
<li>time period for requests being counted (time.Duration)</li>
<li>optional parameter to set the same client by header, in case the provided string contains <code>,</code>, it will combine all these headers (string)</li>
</ul>
<div class="highlight"><pre><span></span><code>clusterClientRatelimit(&quot;groupA&quot;, 10, &quot;1h&quot;)
clusterClientRatelimit(&quot;groupA&quot;, 10, &quot;1h&quot;, &quot;Authorization&quot;)
clusterClientRatelimit(&quot;groupA&quot;, 10, &quot;1h&quot;, &quot;X-Forwarded-For,Authorization,User-Agent&quot;)
</code></pre></div>
<p>See also the <a href="https://godoc.org/github.com/zalando/skipper/ratelimit">ratelimit docs</a>.</p>
<h3 id="clusterratelimit">clusterRatelimit<a class="headerlink" href="#clusterratelimit" title="Permanent link">&para;</a></h3>
<p>This ratelimit is calculated across all skipper peers and the same
rate limit group. The first parameter is a string to select the same
ratelimit group across one or more routes.  The rate limit group
allows the given number of requests to a backend.</p>
<p>You need to run skipper with command line flags <code>-enable-swarm</code> and
<code>-enable-ratelimits</code>. See also our <a href="../../tutorials/ratelimit/#cluster-ratelimit">cluster ratelimit tutorial</a></p>
<p>Parameters:</p>
<ul>
<li>rate limit group (string)</li>
<li>number of allowed requests per time period (int)</li>
<li>time period for requests being counted (time.Duration)</li>
<li>response status code to use for a rate limited request - optional, default: 429</li>
</ul>
<div class="highlight"><pre><span></span><code>clusterRatelimit(&quot;groupA&quot;, 20, &quot;1m&quot;)
clusterRatelimit(&quot;groupB&quot;, 300, &quot;1h&quot;)
clusterRatelimit(&quot;groupC&quot;, 4000, &quot;1m&quot;, 503)
</code></pre></div>
<p>Multiple filter definitions using the same group must use the same number of allowed requests and timeframe values.</p>
<p>See also the <a href="https://godoc.org/github.com/zalando/skipper/ratelimit">ratelimit docs</a>.</p>
<h3 id="backendratelimit">backendRatelimit<a class="headerlink" href="#backendratelimit" title="Permanent link">&para;</a></h3>
<p>The filter configures request rate limit for each backend endpoint within rate limit group across all Skipper peers.
When limit is reached Skipper refuses to forward the request to the backend and
responds with <code>503 Service Unavailable</code> status to the client, i.e. implements <em>load shedding</em>.</p>
<p>It is similar to <a href="#clusterclientratelimit">clusterClientRatelimit</a> filter but counts request rate
using backend endpoint address instead of incoming request IP address or a HTTP header.
Requires command line flags <code>-enable-swarm</code> and <code>-enable-ratelimits</code>.</p>
<p>Both <em>rate limiting</em> and <em>load shedding</em> can use the exact same mechanism to protect the backend but the key difference is the semantics:</p>
<ul>
<li><em>rate limiting</em> should adopt 4XX and inform the client that they are exceeding some quota. It doesn&rsquo;t depend on the current capacity of the backend.</li>
<li><em>load shedding</em> should adopt 5XX and inform the client that the backend is not able to provide the service. It depends on the current capacity of the backend.</li>
</ul>
<p>Parameters:</p>
<ul>
<li>rate limit group (string)</li>
<li>number of allowed requests per time period (int)</li>
<li>timeframe for requests being counted (time.Duration)</li>
<li>response status code to use for rejected requests - optional, default: 503</li>
</ul>
<p>Multiple filter definitions using the same group must use the same number of allowed requests and timeframe values.</p>
<p>Examples:</p>
<p><div class="highlight"><pre><span></span><code>foo: Path(&quot;/foo&quot;)
  -&gt; backendRatelimit(&quot;foobar&quot;, 100, &quot;1s&quot;)
  -&gt; &lt;&quot;http://backend1&quot;, &quot;http://backend2&quot;&gt;;

bar: Path(&quot;/bar&quot;)
  -&gt; backendRatelimit(&quot;foobar&quot;, 100, &quot;1s&quot;)
  -&gt; &lt;&quot;http://backend1&quot;, &quot;http://backend2&quot;&gt;;
</code></pre></div>
Configures rate limit of 100 requests per second for each <code>backend1</code> and <code>backend2</code>
regardless of the request path by using the same group name, number of request and timeframe parameters.</p>
<p><div class="highlight"><pre><span></span><code>foo: Path(&quot;/foo&quot;)
  -&gt; backendRatelimit(&quot;foo&quot;, 40, &quot;1s&quot;)
  -&gt; &lt;&quot;http://backend1&quot;, &quot;http://backend2&quot;&gt;;

bar: Path(&quot;/bar&quot;)
  -&gt; backendRatelimit(&quot;bar&quot;, 80, &quot;1s&quot;)
  -&gt; &lt;&quot;http://backend1&quot;, &quot;http://backend2&quot;&gt;;
</code></pre></div>
Configures rate limit of 40 requests per second for each <code>backend1</code> and <code>backend2</code>
for the <code>/foo</code> requests and 80 requests per second for the <code>/bar</code> requests by using different group name per path.
The total request rate each backend receives can not exceed <code>40+80=120</code> requests per second.</p>
<p><div class="highlight"><pre><span></span><code>foo: Path(&quot;/baz&quot;)
  -&gt; backendRatelimit(&quot;baz&quot;, 100, &quot;1s&quot;, 429)
  -&gt; &lt;&quot;http://backend1&quot;, &quot;http://backend2&quot;&gt;;
</code></pre></div>
Configures rate limit of 100 requests per second for each <code>backend1</code> and <code>backend2</code> and responds
with <code>429 Too Many Requests</code> when limit is reached.</p>
<h3 id="clusterleakybucketratelimit">clusterLeakyBucketRatelimit<a class="headerlink" href="#clusterleakybucketratelimit" title="Permanent link">&para;</a></h3>
<p>Implements leaky bucket rate limit algorithm that uses Redis as a storage.
Requires command line flags <code>-enable-ratelimits</code>, <code>-enable-swarm</code> and <code>-swarm-redis-urls</code> to be set.</p>
<p>The leaky bucket is an algorithm based on an analogy of how a bucket with a constant leak will overflow if either
the average rate at which water is poured in exceeds the rate at which the bucket leaks or if more water than
the capacity of the bucket is poured in all at once, see <a href="https://en.wikipedia.org/wiki/Leaky_bucket">https://en.wikipedia.org/wiki/Leaky_bucket</a></p>
<p>Parameters:</p>
<ul>
<li>label (string)</li>
<li>leak rate volume (int)</li>
<li>leak rate period (time.Duration)</li>
<li>capacity (int)</li>
<li>increment (int)</li>
</ul>
<p>The bucket label, leak rate (volume/period) and capacity uniquely identify the bucket.</p>
<p>Label supports <a href="#template-placeholders">template placeholders</a>.
If a template placeholder can&rsquo;t be resolved then request is allowed and does not add to any bucket.</p>
<p>Leak rate (divided by increment) defines a maximum average allowed request rate.
The rate is configured by two parameters for convenience and consistency with other filters but is actually a single number,
e.g. the rate of 2 per second equals to the rate of 20 per 10 seconds or 120 per minute.</p>
<p>Capacity defines the maximum request burst size or an allowed jitter.</p>
<p>Each passing request adds increment amount to the bucket, different routes may add different amounts to the same bucket.</p>
<p>Configuration with equal capacity and increment allows no jitter: first request fills up the bucket full and
subsequent request will be rejected if it arrives earlier than <code>emission interval = 1/leak rate</code>.</p>
<p>Real requests always have a jitter which can be demonstrated by the configuration having capacity and increment of one:
<div class="highlight"><pre><span></span><code>r1: * -&gt; clusterLeakyBucketRatelimit(&quot;1rps&quot;, 1, &quot;1s&quot;, 1, 1) -&gt; status(200) -&gt; &lt;shunt&gt;;
</code></pre></div>
it does not allow jitter and therefore rejects ~half of the requests coming at rate of 1 rps:
<div class="highlight"><pre><span></span><code>$ echo &quot;GET http://localhost:9090&quot; | vegeta attack -rate=1/s -duration=1m | vegeta report
Requests      [total, rate, throughput]  60, 1.02, 0.58
Duration      [total, attack, wait]      59.001991855s, 59.000310522s, 1.681333ms
Latencies     [mean, 50, 95, 99, max]    1.721207ms, 1.555227ms, 1.943115ms, 10.689486ms, 11.538278ms
Bytes In      [total, mean]              0, 0.00
Bytes Out     [total, mean]              0, 0.00
Success       [ratio]                    56.67%
Status Codes  [code:count]               200:34  429:26
Error Set:
429 Too Many Requests
</code></pre></div></p>
<p>On the other hand the configuration with capacity greater than increment:
<div class="highlight"><pre><span></span><code>r1: * -&gt; clusterLeakyBucketRatelimit(&quot;1rps2&quot;, 1, &quot;1s&quot;, 2, 1) -&gt; status(200) -&gt; &lt;shunt&gt;;
</code></pre></div>
allows all requests:
<div class="highlight"><pre><span></span><code>~$ echo &quot;GET http://localhost:9090&quot; | vegeta attack -rate=1/s -duration=1m | vegeta report
Requests      [total, rate, throughput]  60, 1.02, 1.02
Duration      [total, attack, wait]      59.00023518s, 58.999779118s, 456.062µs
Latencies     [mean, 50, 95, 99, max]    1.410641ms, 1.585908ms, 1.859727ms, 8.285963ms, 8.997149ms
Bytes In      [total, mean]              0, 0.00
Bytes Out     [total, mean]              0, 0.00
Success       [ratio]                    100.00%
Status Codes  [code:count]               200:60
Error Set:
</code></pre></div>
and even if rate is greater than 1 rps the average allowed request rate is still equal to the leak rate of 1 rps:
<div class="highlight"><pre><span></span><code>$ echo &quot;GET http://localhost:9090&quot; | vegeta attack -rate=11/10s -duration=1m | vegeta report
Requests      [total, rate, throughput]  66, 1.12, 1.03
Duration      [total, attack, wait]      59.091880389s, 59.089985762s, 1.894627ms
Latencies     [mean, 50, 95, 99, max]    1.709568ms, 1.60613ms, 1.925731ms, 10.601822ms, 12.10052ms
Bytes In      [total, mean]              0, 0.00
Bytes Out     [total, mean]              0, 0.00
Success       [ratio]                    92.42%
Status Codes  [code:count]               200:61  429:5
Error Set:
429 Too Many Requests
</code></pre></div></p>
<p>Therefore the capacity should be configured greater than increment unless strict request interval needs to be enforced.
Configuration having capacity below increment rejects all requests.</p>
<p>Examples:
<div class="highlight"><pre><span></span><code>// allow each unique Authorization header once in five seconds
clusterLeakyBucketRatelimit(&quot;auth-${request.header.Authorization}&quot;, 1, &quot;5s&quot;, 2, 1)

// allow 60 requests per hour (each subsequent request allowed not earlied than after 1h/60 = 1m) for all clients
clusterLeakyBucketRatelimit(&quot;hourly&quot;, 60, &quot;1h&quot;, 1, 1)

// allow 10 requests per minute for each unique PHPSESSID cookie with bursts of up to 5 requests
clusterLeakyBucketRatelimit(&quot;session-${request.cookie.PHPSESSID}&quot;, 10, &quot;1m&quot;, 5, 1)

// use the same bucket but add different amount (i.e. one /expensive request counts as two /cheap)
Path(&quot;/cheap&quot;)     -&gt; clusterLeakyBucketRatelimit(&quot;user-${request.cookie.Authorization}&quot;, 1, &quot;1s&quot;, 5, 1) -&gt; ...
Path(&quot;/expensive&quot;) -&gt; clusterLeakyBucketRatelimit(&quot;user-${request.cookie.Authorization}&quot;, 1, &quot;1s&quot;, 5, 2) -&gt; ...
</code></pre></div></p>
<h3 id="ratelimitfailclosed">ratelimitFailClosed<a class="headerlink" href="#ratelimitfailclosed" title="Permanent link">&para;</a></h3>
<p>This filter changes the failure mode for all rate limit filters of the route.
By default rate limit filters fail open on infrastructure errors (e.g. when redis is down) and allow requests.
When this filter is present on the route, rate limit filters will fail closed in case of infrastructure errors and deny requests.</p>
<p>Examples:
<div class="highlight"><pre><span></span><code>fail_open: * -&gt; clusterRatelimit(&quot;g&quot;,10, &quot;1s&quot;)
fail_closed: * -&gt; ratelimitFailClosed() -&gt; clusterRatelimit(&quot;g&quot;, 10, &quot;1s&quot;)
</code></pre></div></p>
<p>In case <code>clusterRatelimit</code> could not reach the swarm (e.g. redis):</p>
<ul>
<li>Route <code>fail_open</code> will allow the request</li>
<li>Route <code>fail_closed</code> will deny the request</li>
</ul>
<h2 id="load-shedding">Load Shedding<a class="headerlink" href="#load-shedding" title="Permanent link">&para;</a></h2>
<p>The basic idea of load shedding is to reduce errors by early stopping
some of the ingress requests that create too much load and serving
the maximum throughput the system can process at a point in time.</p>
<p>There is a great talk by <a href="https://www.youtube.com/watch?v=XNEIkivvaV4">Acacio Cruz from
Google</a>
that explains the basic principles.</p>
<h3 id="admissioncontrol">admissionControl<a class="headerlink" href="#admissioncontrol" title="Permanent link">&para;</a></h3>
<p>Implements an admission control filter, that rejects traffic by
observed error rate and probability. If it rejects a request skipper will
respond with status code 503.</p>
<p>The probability of rejection is calculated by the following equation:</p>
<div class="arithmatex">\[ P_{reject} = ( { n_{total} - { n_{success} \over threshold } \over n_{total} + 1} )^{ exponent } \]</div>
<p>Examples:</p>
<div class="codehilite"><pre><span></span><code>admissionControl(metricSuffix, mode, d, windowSize, minRPS, successThreshold, maxRejectProbability, exponent)
admissionControl(&quot;myapp&quot;, &quot;active&quot;, &quot;1s&quot;, 5, 10, 0.95, 0.9, 0.5)
</code></pre></div>

<p>Parameters:</p>
<ul>
<li>metric suffix (string)</li>
<li>mode (enum)</li>
<li>d (time.Duration)</li>
<li>window size (int)</li>
<li>minRps (int)</li>
<li>success threshold (float64)</li>
<li>max reject probability (float64)</li>
<li>exponent (float64)</li>
</ul>
<p>Metric suffix is the chosen suffix key to expose reject counter,
should be unique by filter instance</p>
<p>Mode has 3 different possible values:</p>
<ul>
<li>&ldquo;active&rdquo; will reject traffic</li>
<li>&ldquo;inactive&rdquo; will never reject traffic</li>
<li>&ldquo;logInactive&rdquo; will not reject traffic, but log to debug filter settings</li>
</ul>
<p>D the time duration of a single slot for required counters in our
circular buffer of window size.</p>
<p>Window size is the size of the circular buffer. It is used to snapshot
counters to calculate total requests and number of success. It is
within <span class="arithmatex">\([1, 100]\)</span>.</p>
<p>MinRps is the minimum requests per second that have to pass this filter
otherwise it will not reject traffic.</p>
<p>Success threshold sets the lowest request success rate at which the
filter will not reject requests. It is within <span class="arithmatex">\((0,1]\)</span>. A value of
0.95 means an error rate of lower than 5% will not trigger
rejects.</p>
<p>Max reject probability sets the upper bound of reject probability. It
is within (0,1]. A value of 0.95 means if backend errors with 100% it
will only reject up to 95%.</p>
<p>exponent is used to dictate the rejection probability. The
calculation is done by <span class="arithmatex">\(p = p^{exponent}\)</span>
The exponent value is within <span class="arithmatex">\((0,\infty]\)</span>, to increase rejection
probability you have to use values lower than 1:</p>
<ul>
<li>1: linear</li>
<li>1/2: quadratic</li>
<li>1/3: cubic</li>
</ul>
<h2 id="lua">lua<a class="headerlink" href="#lua" title="Permanent link">&para;</a></h2>
<p>See <a href="../scripts/">the scripts page</a></p>
<h2 id="logs">Logs<a class="headerlink" href="#logs" title="Permanent link">&para;</a></h2>
<h3 id="accesslogdisabled"><del>accessLogDisabled</del><a class="headerlink" href="#accesslogdisabled" title="Permanent link">&para;</a></h3>
<p><strong>Deprecated:</strong> use <a href="#disableaccesslog">disableAccessLog</a> or <a href="#enableaccesslog">enableAccessLog</a></p>
<p>The <code>accessLogDisabled</code> filter overrides global Skipper <code>AccessLogDisabled</code> setting for a specific route, which allows to either turn-off
the access log for specific route while access log, in general, is enabled or vice versa.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>accessLogDisabled(&quot;false&quot;)
</code></pre></div>
<h3 id="disableaccesslog">disableAccessLog<a class="headerlink" href="#disableaccesslog" title="Permanent link">&para;</a></h3>
<p>Filter overrides global Skipper <code>AccessLogDisabled</code> setting and allows to turn-off the access log for specific route
while access log, in general, is enabled. It is also possible to disable access logs only for a subset of response codes
from backend by providing an optional list of response code prefixes.</p>
<p>Parameters:</p>
<ul>
<li>response code prefixes (variadic int) - optional</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>disableAccessLog()
disableAccessLog(1, 301, 40)
</code></pre></div>
<p>This disables logs of all requests with status codes <code>1xxs</code>, <code>301</code> and all <code>40xs</code>.</p>
<h3 id="enableaccesslog">enableAccessLog<a class="headerlink" href="#enableaccesslog" title="Permanent link">&para;</a></h3>
<p>Filter overrides global Skipper <code>AccessLogDisabled</code> setting and allows to turn-on the access log for specific route
while access log, in general, is disabled. It is also possible to enable access logs only for a subset of response codes
from backend by providing an optional list of response code prefixes.</p>
<p>Parameters:</p>
<ul>
<li>response code prefixes (variadic int) - optional</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>enableAccessLog()
enableAccessLog(1, 301, 20)
</code></pre></div>
<p>This enables logs of all requests with status codes <code>1xxs</code>, <code>301</code> and all <code>20xs</code>.</p>
<h3 id="auditlog">auditLog<a class="headerlink" href="#auditlog" title="Permanent link">&para;</a></h3>
<p>Filter <code>auditLog()</code> logs the request and N bytes of the body into the
log file. N defaults to 1024 and can be overridden with
<code>-max-audit-body=&lt;int&gt;</code>. <code>N=0</code> omits logging the body.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>auditLog()
</code></pre></div>
<h3 id="unverifiedauditlog">unverifiedAuditLog<a class="headerlink" href="#unverifiedauditlog" title="Permanent link">&para;</a></h3>
<p>Filter <code>unverifiedAuditLog()</code> adds a Header, <code>X-Unverified-Audit</code>, to the request, the content of which, will also
be written to the log file. By default, the value of the audit header will be equal to the value of the <code>sub</code> key, from
the Authorization token. This can be changed by providing a <code>string</code> input to the filter which matches another key from the
token.</p>
<p><em>N.B.</em> It is important to note that, if the content of the <code>X-Unverified-Audit</code> header does not match the following regex, then
a default value of <code>invalid-sub</code> will be populated in the header instead:
    <code>^[a-zA-Z0-9_/:?=&amp;%@.#-]*$</code></p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>unverifiedAuditLog()
</code></pre></div>
<div class="highlight"><pre><span></span><code>unverifiedAuditLog(&quot;azp&quot;)
</code></pre></div>
<h2 id="backend">Backend<a class="headerlink" href="#backend" title="Permanent link">&para;</a></h2>
<h3 id="backendisproxy">backendIsProxy<a class="headerlink" href="#backendisproxy" title="Permanent link">&para;</a></h3>
<p>Notifies the proxy that the backend handling this request is also a
proxy. The proxy type is based in the URL scheme which can be either
<code>http</code>, <code>https</code> or <code>socks5</code>.</p>
<p>Keep in mind that Skipper currently cannot handle <code>CONNECT</code> requests
by tunneling the traffic to the target destination, however, the
<code>CONNECT</code> requests can be forwarded to a different proxy using this
filter.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>foo1:
  *
  -&gt; backendIsProxy()
  -&gt; &quot;http://proxy.example.com&quot;;

foo2:
  *
  -&gt; backendIsProxy()
  -&gt; &lt;roundRobin, &quot;http://proxy1.example.com&quot;, &quot;http://proxy2.example.com&quot;&gt;;

foo3:
  *
  -&gt; setDynamicBackendUrl(&quot;http://proxy.example.com&quot;)
  -&gt; backendIsProxy()
  -&gt; &lt;dynamic&gt;;
</code></pre></div>
<h3 id="setdynamicbackendhostfromheader">setDynamicBackendHostFromHeader<a class="headerlink" href="#setdynamicbackendhostfromheader" title="Permanent link">&para;</a></h3>
<p>Filter sets the backend host for a route, value is taken from the provided header.
Can be used only with <code>&lt;dynamic&gt;</code> backend. Meant to be used together with <a href="#setdynamicbackendschemefromheader">setDynamicBackendSchemeFromHeader</a>
or <a href="#setdynamicbackendscheme">setDynamicBackendScheme</a>. If this filter chained together with <a href="#setdynamicbackendurlfromheader">setDynamicBackendUrlFromHeader</a>
or <a href="#setdynamicbackendurl">setDynamicBackendUrl</a> filters, the latter ones would have priority.</p>
<p>Parameters:</p>
<ul>
<li>header name (string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>foo: * -&gt; setDynamicBackendHostFromHeader(&quot;X-Forwarded-Host&quot;) -&gt; &lt;dynamic&gt;;
</code></pre></div>
<h3 id="setdynamicbackendschemefromheader">setDynamicBackendSchemeFromHeader<a class="headerlink" href="#setdynamicbackendschemefromheader" title="Permanent link">&para;</a></h3>
<p>Filter sets the backend scheme for a route, value is taken from the provided header.
Can be used only with <code>&lt;dynamic&gt;</code> backend. Meant to be used together with <a href="#setdynamicbackendhostfromheader">setDynamicBackendHostFromHeader</a>
or <a href="#setdynamicbackendhost">setDynamicBackendHost</a>. If this filter chained together with
<a href="#setdynamicbackendurlfromheader">setDynamicBackendUrlFromHeader</a> or <a href="#setdynamicbackendurl">setDynamicBackendUrl</a>, the latter ones would have priority.</p>
<p>Parameters:</p>
<ul>
<li>header name (string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>foo: * -&gt; setDynamicBackendSchemeFromHeader(&quot;X-Forwarded-Proto&quot;) -&gt; &lt;dynamic&gt;;
</code></pre></div>
<h3 id="setdynamicbackendurlfromheader">setDynamicBackendUrlFromHeader<a class="headerlink" href="#setdynamicbackendurlfromheader" title="Permanent link">&para;</a></h3>
<p>Filter sets the backend url for a route, value is taken from the provided header.
Can be used only with <code>&lt;dynamic&gt;</code> backend.</p>
<p>Parameters:</p>
<ul>
<li>header name (string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>foo: * -&gt; setDynamicBackendUrlFromHeader(&quot;X-Custom-Url&quot;) -&gt; &lt;dynamic&gt;;
</code></pre></div>
<h3 id="setdynamicbackendhost">setDynamicBackendHost<a class="headerlink" href="#setdynamicbackendhost" title="Permanent link">&para;</a></h3>
<p>Filter sets the backend host for a route. Can be used only with <code>&lt;dynamic&gt;</code> backend.
Meant to be used together with <a href="#setdynamicbackendschemefromheader">setDynamicBackendSchemeFromHeader</a>
or <a href="#setdynamicbackendscheme">setDynamicBackendScheme</a>. If this filter chained together with <a href="#setdynamicbackendurlfromheader">setDynamicBackendUrlFromHeader</a>
or <a href="#setdynamicbackendurl">setDynamicBackendUrl</a>, the latter ones would have priority.</p>
<p>Parameters:</p>
<ul>
<li>host (string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>foo: * -&gt; setDynamicBackendHost(&quot;example.com&quot;) -&gt; &lt;dynamic&gt;;
</code></pre></div>
<h3 id="setdynamicbackendscheme">setDynamicBackendScheme<a class="headerlink" href="#setdynamicbackendscheme" title="Permanent link">&para;</a></h3>
<p>Filter sets the backend scheme for a route. Can be used only with <code>&lt;dynamic&gt;</code> backend.
Meant to be used together with <a href="#setdynamicbackendhostfromheader">setDynamicBackendHostFromHeader</a>
or <a href="#setdynamicbackendhost">setDynamicBackendHost</a>. If this filter chained together with
<a href="#setdynamicbackendurlfromheader">setDynamicBackendUrlFromHeader</a> or <a href="#setdynamicbackendurl">setDynamicBackendUrl</a>, the latter ones would have priority.</p>
<p>Parameters:</p>
<ul>
<li>scheme (string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>foo: * -&gt; setDynamicBackendScheme(&quot;https&quot;) -&gt; &lt;dynamic&gt;;
</code></pre></div>
<h3 id="setdynamicbackendurl">setDynamicBackendUrl<a class="headerlink" href="#setdynamicbackendurl" title="Permanent link">&para;</a></h3>
<p>Filter sets the backend url for a route. Can be used only with <code>&lt;dynamic&gt;</code> backend.</p>
<p>Parameters:</p>
<ul>
<li>url (string)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>foo: * -&gt; setDynamicBackendUrl(&quot;https://example.com&quot;) -&gt; &lt;dynamic&gt;;
</code></pre></div>
<h2 id="apiusagemonitoring">apiUsageMonitoring<a class="headerlink" href="#apiusagemonitoring" title="Permanent link">&para;</a></h2>
<p>The <code>apiUsageMonitoring</code> filter adds API related metrics to the Skipper monitoring. It is by default not activated. Activate
it by providing the <code>-enable-api-usage-monitoring</code> flag at Skipper startup. In its deactivated state, it is still
registered as a valid filter (allowing route configurations to specify it), but will perform no operation. That allows,
per instance, production environments to use it and testing environments not to while keeping the same route configuration
for all environments.</p>
<p>For the client based metrics, additional flags need to be specified.</p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>api-usage-monitoring-realm-keys</code></td>
<td>Name of the property in the JWT JSON body that contains the name of the <em>realm</em>.</td>
</tr>
<tr>
<td><code>api-usage-monitoring-client-keys</code></td>
<td>Name of the property in the JWT JSON body that contains the name of the <em>client</em>.</td>
</tr>
<tr>
<td><code>api-usage-monitoring-realms-tracking-pattern</code></td>
<td>RegEx of <em>realms</em> to be monitored. Defaults to &lsquo;services&rsquo;.</td>
</tr>
</tbody>
</table>
<p>NOTE: Make sure to activate the metrics flavour proper to your environment using the <code>metrics-flavour</code>
flag in order to get those metrics.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>skipper<span class="w"> </span>-metrics-flavour<span class="w"> </span>prometheus<span class="w"> </span>-enable-api-usage-monitoring<span class="w"> </span>-api-usage-monitoring-realm-keys<span class="o">=</span><span class="s2">&quot;realm&quot;</span><span class="w"> </span>-api-usage-monitoring-client-keys<span class="o">=</span><span class="s2">&quot;managed-id&quot;</span><span class="w"> </span>api-usage-monitoring-realms-tracking-pattern<span class="o">=</span><span class="s2">&quot;services,users&quot;</span>
</code></pre></div>
<p>The structure of the metrics is all of those elements, separated by <code>.</code> dots:</p>
<table>
<thead>
<tr>
<th>Part</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>apiUsageMonitoring.custom</code></td>
<td>Every filter metrics starts with the name of the filter followed by <code>custom</code>. This part is constant.</td>
</tr>
<tr>
<td>Application ID</td>
<td>Identifier of the application, configured in the filter under <code>app_id</code>.</td>
</tr>
<tr>
<td>Tag</td>
<td>Tag of the application (e.g. staging), configured in the filter under <code>tag</code>.</td>
</tr>
<tr>
<td>API ID</td>
<td>Identifier of the API, configured in the filter under <code>api_id</code>.</td>
</tr>
<tr>
<td>Method</td>
<td>The request&rsquo;s method (verb), capitalized (ex: <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>).</td>
</tr>
<tr>
<td>Path</td>
<td>The request&rsquo;s path, in the form of the path template configured in the filter under <code>path_templates</code>.</td>
</tr>
<tr>
<td>Realm</td>
<td>The realm in which the client is authenticated.</td>
</tr>
<tr>
<td>Client</td>
<td>Identifier under which the client is authenticated.</td>
</tr>
<tr>
<td>Metric Name</td>
<td>Name (or key) of the metric being tracked.</td>
</tr>
</tbody>
</table>
<h3 id="available-metrics">Available Metrics<a class="headerlink" href="#available-metrics" title="Permanent link">&para;</a></h3>
<h4 id="endpoint-related-metrics">Endpoint Related Metrics<a class="headerlink" href="#endpoint-related-metrics" title="Permanent link">&para;</a></h4>
<p>Those metrics are not identifying the realm and client. They always have <code>*</code> in their place.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>                                                                                      + Realm
                                                                                      |
apiUsageMonitoring.custom.orders-backend.staging.orders-api.GET.foo/orders/{order-id}.*.*.http_count
                                                                                        | |
                                                                                        | + Metric Name
                                                                                        + Client
</code></pre></div>
<p>The available metrics are:</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Metric Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Counter</td>
<td><code>http_count</code></td>
<td>number of HTTP exchanges</td>
</tr>
<tr>
<td>Counter</td>
<td><code>http1xx_count</code></td>
<td>number of HTTP exchanges resulting in information (HTTP status in the 100s)</td>
</tr>
<tr>
<td>Counter</td>
<td><code>http2xx_count</code></td>
<td>number of HTTP exchanges resulting in success (HTTP status in the 200s)</td>
</tr>
<tr>
<td>Counter</td>
<td><code>http3xx_count</code></td>
<td>number of HTTP exchanges resulting in a redirect (HTTP status in the 300s)</td>
</tr>
<tr>
<td>Counter</td>
<td><code>http4xx_count</code></td>
<td>number of HTTP exchanges resulting in a client error (HTTP status in the 400s)</td>
</tr>
<tr>
<td>Counter</td>
<td><code>http5xx_count</code></td>
<td>number of HTTP exchanges resulting in a server error (HTTP status in the 500s)</td>
</tr>
<tr>
<td>Histogram</td>
<td><code>latency</code></td>
<td>time between the first observable moment (a call to the filter&rsquo;s <code>Request</code>) until the last (a call to the filter&rsquo;s <code>Response</code>)</td>
</tr>
</tbody>
</table>
<h4 id="client-related-metrics">Client Related Metrics<a class="headerlink" href="#client-related-metrics" title="Permanent link">&para;</a></h4>
<p>Those metrics are not identifying endpoint (path) and HTTP verb. They always have <code>*</code> as their place.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>                                                            + HTTP Verb
                                                            | + Path Template     + Metric Name
                                                            | |                   |
apiUsageMonitoring.custom.orders-backend.staging.orders-api.*.*.users.mmustermann.http_count
                                                                |     |
                                                                |     + Client
                                                                + Realm
</code></pre></div>
<p>The available metrics are:</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Metric Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Counter</td>
<td><code>http_count</code></td>
<td>number of HTTP exchanges</td>
</tr>
<tr>
<td>Counter</td>
<td><code>http1xx_count</code></td>
<td>number of HTTP exchanges resulting in information (HTTP status in the 100s)</td>
</tr>
<tr>
<td>Counter</td>
<td><code>http2xx_count</code></td>
<td>number of HTTP exchanges resulting in success (HTTP status in the 200s)</td>
</tr>
<tr>
<td>Counter</td>
<td><code>http3xx_count</code></td>
<td>number of HTTP exchanges resulting in a redirect (HTTP status in the 300s)</td>
</tr>
<tr>
<td>Counter</td>
<td><code>http4xx_count</code></td>
<td>number of HTTP exchanges resulting in a client error (HTTP status in the 400s)</td>
</tr>
<tr>
<td>Counter</td>
<td><code>http5xx_count</code></td>
<td>number of HTTP exchanges resulting in a server error (HTTP status in the 500s)</td>
</tr>
<tr>
<td>Counter</td>
<td><code>latency_sum</code></td>
<td>sum of seconds (in decimal form) between the first observable moment (a call to the filter&rsquo;s <code>Request</code>) until the last (a call to the filter&rsquo;s <code>Response</code>)</td>
</tr>
</tbody>
</table>
<h3 id="filter-configuration">Filter Configuration<a class="headerlink" href="#filter-configuration" title="Permanent link">&para;</a></h3>
<p>Endpoints can be monitored using the <code>apiUsageMonitoring</code> filter in the route. It accepts JSON objects (as strings)
of the format mentioned below. In case any of the required parameters is missing, <code>no-op</code> filter is created, i.e. no
metrics are captured, but the creation of the route does not fail.</p>
<div class="highlight"><pre><span></span><code><span class="nt">api-usage-monitoring-configuration</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object</span>
<span class="w">  </span><span class="nt">required</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">application_id</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api_id</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path_templates</span>
<span class="w">  </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">    </span><span class="nt">application_id</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ID of the application</span>
<span class="w">      </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order-service</span>
<span class="w">    </span><span class="nt">tag</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tag of the application</span>
<span class="w">      </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class="w">    </span><span class="nt">api_id</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ID of the API</span>
<span class="w">      </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">orders-api</span>
<span class="w">    </span><span class="nt">path_templates</span><span class="p">:</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Endpoints to be monitored.</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="w">      </span><span class="nt">minLength</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">items</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">          </span><span class="no">Path template in /articles/{article-id} (OpenAPI 3) or in /articles/:article-id format.</span>
<span class="w">          </span><span class="no">NOTE: They will be normalized to the :this format for metrics naming.</span>
<span class="w">        </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/orders/{order-id}</span>
<span class="w">    </span><span class="nt">client_tracking_pattern</span><span class="p">:</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">            </span><span class="no">The pattern that matches client id in form of a regular expression.</span>

<span class="w">            </span><span class="no">By default (if undefined), it is set to `.*`.</span>

<span class="w">            </span><span class="no">An empty string disables the client metrics completely.</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">        </span><span class="nt">examples</span><span class="p">:</span>
<span class="w">            </span><span class="nt">all_services</span><span class="p">:</span>
<span class="w">                </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">All services are tracked (for all activated realms).</span>
<span class="w">                </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;.*&quot;</span>
<span class="w">            </span><span class="nt">just_some_services</span><span class="p">:</span>
<span class="w">                </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Only services `orders-service` and `shipment-service` are tracked.</span>
<span class="w">                </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;(orders</span><span class="err">\</span><span class="s">-service|shipment</span><span class="err">\</span><span class="s">-service)&quot;</span>
</code></pre></div>
<p>Configuration Example:</p>
<div class="highlight"><pre><span></span><code>apiUsageMonitoring(`
    {
        &quot;application_id&quot;: &quot;my-app&quot;,
        &quot;tag&quot;: &quot;staging&quot;,
        &quot;api_id&quot;: &quot;orders-api&quot;,
        &quot;path_templates&quot;: [
            &quot;foo/orders&quot;,
            &quot;foo/orders/:order-id&quot;,
            &quot;foo/orders/:order-id/order_item/{order-item-id}&quot;
        ],
        &quot;client_tracking_pattern&quot;: &quot;(shipping\-service|payment\-service)&quot;
    }`,`{
        &quot;application_id&quot;: &quot;my-app&quot;,
        &quot;api_id&quot;: &quot;customers-api&quot;,
        &quot;path_templates&quot;: [
            &quot;/foo/customers/&quot;,
            &quot;/foo/customers/{customer-id}/&quot;
        ]
    }
`)
</code></pre></div>
<p>Based on the previous configuration, here is an example of a counter metric.</p>
<div class="highlight"><pre><span></span><code>apiUsageMonitoring.custom.my-app.staging.orders-api.GET.foo/orders/{order-id}.*.*.http_count
</code></pre></div>
<p>Note that a missing <code>tag</code> in the configuration will be replaced by <code>{no-tag}</code> in the metric:</p>
<div class="highlight"><pre><span></span><code>apiUsageMonitoring.custom.my-app.{no-tag}.customers-api.GET.foo/customers.*.*.http_count
</code></pre></div>
<p>Here is the <em>Prometheus</em> query to obtain it.</p>
<div class="highlight"><pre><span></span><code>sum(rate(skipper_custom_total{key=&quot;apiUsageMonitoring.custom.my-app.staging.orders-api.GET.foo/orders/{order-id}.*.*.http_count&quot;}[60s])) by (key)
</code></pre></div>
<p>Here is an example of a histogram metric.</p>
<div class="highlight"><pre><span></span><code>apiUsageMonitoring.custom.my_app.staging.orders-api.POST.foo/orders.latency
</code></pre></div>
<p>Here is the <em>Prometheus</em> query to obtain it.</p>
<div class="highlight"><pre><span></span><code>histogram_quantile(0.5, sum(rate(skipper_custom_duration_seconds_bucket{key=&quot;apiUsageMonitoring.custom.my-app.staging.orders-api.POST.foo/orders.*.*.latency&quot;}[60s])) by (le, key))
</code></pre></div>
<p>NOTE: Non configured paths will be tracked with <code>{unknown}</code> Application ID, Tag, API ID
and path template.</p>
<p>However, if all <code>application_id</code>s of your configuration refer to the same application,
the filter assume that also non configured paths will be directed to this application.
E.g.:</p>
<div class="highlight"><pre><span></span><code>apiUsageMonitoring.custom.my-app.{unknown}.{unknown}.GET.{no-match}.*.*.http_count
</code></pre></div>
<h2 id="originmarker">originMarker<a class="headerlink" href="#originmarker" title="Permanent link">&para;</a></h2>
<p>This filter is used to measure the time it took to create a route. Other than that, it&rsquo;s a no-op.
You can include the same origin marker when you re-create the route. As long as the <code>origin</code> and <code>id</code> are the same, the route creation time will not be measured again.
If there are multiple origin markers with the same origin, the earliest timestamp will be used.</p>
<p>Parameters:</p>
<ul>
<li>the name of the origin</li>
<li>the ID of the object that is the logical source for the route</li>
<li>the creation timestamp (rfc3339)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>originMarker(&quot;apiUsageMonitoring&quot;, &quot;deployment1&quot;, &quot;2019-08-30T09:55:51Z&quot;)
</code></pre></div>
<h2 id="scheduler">Scheduler<a class="headerlink" href="#scheduler" title="Permanent link">&para;</a></h2>
<h3 id="fifo">fifo<a class="headerlink" href="#fifo" title="Permanent link">&para;</a></h3>
<p>This Filter is similar to the <a href="#lifo">lifo</a> filter in regards to
parameters and status codes.</p>
<p>It turned out that <code>lifo()</code> filter can hurt performance at high load.
On AWS instance c6g.8xlarge <a href="#lifo">lifo</a> filter had a limit of 21000
requests per second on a single instance. The <code>fifo()</code> filter had not
hit a limit at 30000 requests per second.
If you use TCP-LIFO, then request processing is already in LIFO style.</p>
<p>Parameters:</p>
<ul>
<li>MaxConcurrency specifies how many goroutines are allowed to work on this queue (int)</li>
<li>MaxQueueSize sets the queue size (int)</li>
<li>Timeout sets the timeout to get request scheduled (time)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>fifo(100, 150, &quot;10s&quot;)
</code></pre></div>
<h3 id="fifowithbody">fifoWithBody<a class="headerlink" href="#fifowithbody" title="Permanent link">&para;</a></h3>
<p>This Filter is similar to the <a href="#lifo">lifo</a> filter in regards to
parameters and status codes.
Performance considerations are similar to <a href="#fifo">fifo</a>.</p>
<p>The difference between fifo and fifoWithBody is that fifo will decrement
the concurrency as soon as the backend sent response headers and
fifoWithBody will decrement the concurrency if the response body was
served. Normally both are very similar, but if you have a fully async
component that serves multiple website fragments, this would decrement
concurrency too early.</p>
<p>Parameters:</p>
<ul>
<li>MaxConcurrency specifies how many goroutines are allowed to work on this queue (int)</li>
<li>MaxQueueSize sets the queue size (int)</li>
<li>Timeout sets the timeout to get request scheduled (time)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>fifoWithBody(100, 150, &quot;10s&quot;)
</code></pre></div>
<h3 id="lifo">lifo<a class="headerlink" href="#lifo" title="Permanent link">&para;</a></h3>
<p>This Filter changes skipper to handle the route with a bounded last in
first out queue (LIFO), instead of an unbounded first in first out
queue (FIFO). The default skipper scheduler is based on Go net/http
package, which provides an unbounded FIFO request handling. If you
enable this filter the request scheduling will change to a LIFO.  The
idea of a LIFO queue is based on Dropbox bandaid proxy, which is not
opensource. Dropbox shared their idea in a
<a href="https://blogs.dropbox.com/tech/2018/03/meet-bandaid-the-dropbox-service-proxy/">public blogpost</a>.
All bounded scheduler filters will respond requests with server status error
codes in case of overrun.</p>
<p>All scheduler filters return HTTP status code:</p>
<ul>
<li>502, if the specified timeout is reached, because a request could not be scheduled fast enough</li>
<li>503, if the queue is full</li>
</ul>
<p>Parameters:</p>
<ul>
<li>MaxConcurrency specifies how many goroutines are allowed to work on this queue(int)</li>
<li>MaxQueueSize sets the queue size (int)</li>
<li>Timeout sets the timeout to get request scheduled (time)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>lifo(100, 150, &quot;10s&quot;)
</code></pre></div>
<p>The above configuration will set MaxConcurrency to 100, MaxQueueSize
to 150 and Timeout to 10 seconds.</p>
<p>When there are multiple lifo filters on the route, only the last one will be applied.</p>
<h3 id="lifogroup">lifoGroup<a class="headerlink" href="#lifogroup" title="Permanent link">&para;</a></h3>
<p>This filter is similar to the <a href="#lifo">lifo</a> filter.</p>
<p>Parameters:</p>
<ul>
<li>GroupName to group multiple one or many routes to the same queue, which have to have the same settings (string)</li>
<li>MaxConcurrency specifies how many goroutines are allowed to work on this queue(int)</li>
<li>MaxQueueSize sets the queue size (int)</li>
<li>Timeout sets the timeout to get request scheduled (time)</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>lifoGroup(&quot;mygroup&quot;, 100, 150, &quot;10s&quot;)
</code></pre></div>
<p>The above configuration will set MaxConcurrency to 100, MaxQueueSize
to 150 and Timeout to 10 seconds for the lifoGroup &ldquo;mygroup&rdquo;, that can
be shared between multiple routes.</p>
<p>It is enough to set the concurrency, queue size and timeout parameters for one instance of
the filter in the group, and only the group name for the rest. Setting these values for
multiple instances is fine, too. While only one of them will be used as the source for the
applied settings, if there is accidentally a difference between the settings in the same
group, a warning will be logged.</p>
<p>It is possible to use the lifoGroup filter together with the single lifo filter, e.g. if
a route belongs to a group, but needs to have additional stricter settings then the whole
group.</p>
<h2 id="rfc-compliance">RFC Compliance<a class="headerlink" href="#rfc-compliance" title="Permanent link">&para;</a></h2>
<h3 id="rfchost">rfcHost<a class="headerlink" href="#rfchost" title="Permanent link">&para;</a></h3>
<p>This filter removes the optional trailing dot in the outgoing host
header.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>rfcHost()
</code></pre></div>
<h3 id="rfcpath">rfcPath<a class="headerlink" href="#rfcpath" title="Permanent link">&para;</a></h3>
<p>This filter forces an alternative interpretation of the RFC 2616 and RFC 3986 standards,
where paths containing reserved characters will have these characters unescaped when the
incoming request also has them unescaped.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>Path(&quot;/api/*id) -&gt; rfcPath() -&gt; &quot;http://api-backend&quot;
</code></pre></div>
<p>In the above case, if the incoming request has something like foo%2Fbar in the id
position, the api-backend service will also receive it in the format foo%2Fbar, while
without the rfcPath() filter the outgoing request path will become /api/foo/bar.</p>
<p>In case we want to use the id while routing the request, we can use the <loopback>
backend. Example:</p>
<div class="highlight"><pre><span></span><code>api: Path(&quot;/api/:id&quot;) -&gt; setPath(&quot;/api/${id}/summary&quot;) -&gt; &quot;http://api-backend&quot;;
patch: Path(&quot;/api/*id&quot;) -&gt; rfcPath() -&gt; &lt;loopback&gt;;
</code></pre></div>
<p>In the above case, if the incoming request path is /api/foo%2Fbar, it will match
the &lsquo;patch&rsquo; route, and then the patched request will match the api route, and
the api-backend service will receive a request with the path /api/foo%2Fbar/summary.</p>
<p>It is also possible to enable this behavior centrally for a Skipper instance with
the -rfc-patch-path flag. See
<a href="../../operation/operation/#uri-standards-interpretation">URI standards interpretation</a>.</p>
<h2 id="egress">Egress<a class="headerlink" href="#egress" title="Permanent link">&para;</a></h2>
<h3 id="setrequestheaderfromsecret">setRequestHeaderFromSecret<a class="headerlink" href="#setrequestheaderfromsecret" title="Permanent link">&para;</a></h3>
<p>This filter sets request header to the secret value with optional prefix and suffix.
This is only for use cases using skipper as sidecar to inject tokens for the application on the
<a href="../egress/"><strong>egress</strong></a> path, if it&rsquo;s used in the <strong>ingress</strong> path you likely
create a security issue for your application.</p>
<p>This filter should be used as an <a href="../egress/">egress</a> only feature.</p>
<p>Parameters:</p>
<ul>
<li>header name (string)</li>
<li>secret name (string)</li>
<li>value prefix (string) - optional</li>
<li>value suffix (string) - optional</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>egress1: Method(&quot;GET&quot;) -&gt; setRequestHeaderFromSecret(&quot;Authorization&quot;, &quot;/tmp/secrets/get-token&quot;) -&gt; &quot;https://api.example.com&quot;;
egress2: Method(&quot;POST&quot;) -&gt; setRequestHeaderFromSecret(&quot;Authorization&quot;, &quot;/tmp/secrets/post-token&quot;, &quot;foo-&quot;) -&gt; &quot;https://api.example.com&quot;;
egress3: Method(&quot;PUT&quot;) -&gt; setRequestHeaderFromSecret(&quot;X-Secret&quot;, &quot;/tmp/secrets/put-token&quot;, &quot;bar-&quot;, &quot;-baz&quot;) -&gt; &quot;https://api.example.com&quot;;
</code></pre></div>
<p>To use <code>setRequestHeaderFromSecret</code> filter you need to run skipper
with <code>-credentials-paths=/tmp/secrets</code> and specify an update interval <code>-credentials-update-interval=10s</code>.
Files in the credentials path can be a directory, which will be able to find all files within this
directory, but it won&rsquo;t walk subtrees.
For the example case, there have to be <code>get-token</code>, <code>post-token</code> and <code>put-token</code> files within the
specified credential paths <code>/tmp/secrets/</code>, resulting in
<code>/tmp/secrets/get-token</code>, <code>/tmp/secrets/post-token</code> and <code>/tmp/secrets/put-token</code>.</p>
<h3 id="bearerinjector">bearerinjector<a class="headerlink" href="#bearerinjector" title="Permanent link">&para;</a></h3>
<p>This filter injects <code>Bearer</code> tokens into <code>Authorization</code> headers read
from file providing the token as content.</p>
<p>It is a special form of <code>setRequestHeaderFromSecret</code> with <code>"Authorization"</code> header name,
<code>"Bearer "</code> prefix and empty suffix.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>egress: * -&gt; bearerinjector(&quot;/tmp/secrets/my-token&quot;) -&gt; &quot;https://api.example.com&quot;;

// equivalent to setRequestHeaderFromSecret(&quot;Authorization&quot;, &quot;/tmp/secrets/my-token&quot;, &quot;Bearer &quot;)
</code></pre></div>
<h2 id="open-tracing">Open Tracing<a class="headerlink" href="#open-tracing" title="Permanent link">&para;</a></h2>
<h3 id="tracingbaggagetotag">tracingBaggageToTag<a class="headerlink" href="#tracingbaggagetotag" title="Permanent link">&para;</a></h3>
<p>This filter adds an opentracing tag for a given baggage item in the trace.</p>
<p>Syntax:
<div class="highlight"><pre><span></span><code>tracingBaggageToTag(&quot;&lt;baggage_item_name&gt;&quot;, &quot;&lt;tag_name&gt;&quot;)
</code></pre></div></p>
<p>Example:</p>
<p>If a trace consists of a baggage item named <code>foo</code> with a value of <code>bar</code>,
then adding the filter below will add a tag named <code>baz</code> with the value <code>bar</code>:
<div class="highlight"><pre><span></span><code>tracingBaggageToTag(&quot;foo&quot;, &quot;baz&quot;)
</code></pre></div></p>
<p>A single-argument variant uses the baggage item name as the tag name, i.e., it will add a tag named <code>foo</code> with the value <code>bar</code>:
<div class="highlight"><pre><span></span><code>tracingBaggageToTag(&quot;foo&quot;)
</code></pre></div></p>
<h3 id="statebagtotag">stateBagToTag<a class="headerlink" href="#statebagtotag" title="Permanent link">&para;</a></h3>
<p>This filter sets an opentracing tag from the filter context (state bag).
If the provided key (first parameter) cannot be found in the state bag, then it doesn&rsquo;t set the tag.</p>
<p>Parameters:</p>
<ul>
<li>key in the state bag (string)</li>
<li>tag name (string)</li>
</ul>
<p>The route in the following example checks whether the request is authorized with the
oauthTokeninfoAllScope() filter. This filter stores the authenticated user with &ldquo;auth-user&rdquo;
key in the context, and the stateBagToTag() filter in the next step stores it in
the opentracing tag &ldquo;client_id&rdquo;:</p>
<div class="highlight"><pre><span></span><code>foo: * -&gt; oauthTokeninfoAllScope(&quot;address_service.all&quot;) -&gt; stateBagToTag(&quot;auth-user&quot;, &quot;client_id&quot;) -&gt; &quot;https://backend.example.org&quot;;
</code></pre></div>
<h3 id="tracingtag">tracingTag<a class="headerlink" href="#tracingtag" title="Permanent link">&para;</a></h3>
<p>This filter adds an opentracing tag.</p>
<p>Syntax:
<div class="highlight"><pre><span></span><code>tracingTag(&quot;&lt;tag_name&gt;&quot;, &quot;&lt;tag_value&gt;&quot;)
</code></pre></div></p>
<p>Tag value may contain <a href="#template-placeholders">template placeholders</a>.
If a template placeholder can&rsquo;t be resolved then filter does not set the tag.</p>
<p>Example: Adding the below filter will add a tag named <code>foo</code> with the value <code>bar</code>.
<div class="highlight"><pre><span></span><code>tracingTag(&quot;foo&quot;, &quot;bar&quot;)
</code></pre></div></p>
<p>Example: Set tag from request header
<div class="highlight"><pre><span></span><code>tracingTag(&quot;http.flow_id&quot;, &quot;${request.header.X-Flow-Id}&quot;)
</code></pre></div></p>
<h3 id="tracingtagfromresponse">tracingTagFromResponse<a class="headerlink" href="#tracingtagfromresponse" title="Permanent link">&para;</a></h3>
<p>This filter works just like <a href="#tracingtag">tracingTag</a>, but is applied after the request was processed.
In particular, <a href="#template-placeholders">template placeholders</a> referencing the response can be used in the tag value.</p>
<h3 id="tracingtagfromresponseifstatus">tracingTagFromResponseIfStatus<a class="headerlink" href="#tracingtagfromresponseifstatus" title="Permanent link">&para;</a></h3>
<p>This filter works like <a href="#tracingtagfromresponse">tracingTagFromResponse</a>
but only for responses having status code from the specified range.</p>
<p>Example: set error tag to true in case response status code is <code>&gt;= 500</code> and <code>&lt;= 599</code>:</p>
<div class="highlight"><pre><span></span><code>tracingTagFromResponseIfStatus(&quot;error&quot;, &quot;true&quot;, 500, 599)
</code></pre></div>
<p>Example: set user id tag for ratelimited requests:</p>
<div class="highlight"><pre><span></span><code>tracingTagFromResponseIfStatus(&quot;user.id&quot;, &quot;${request.header.X-User-Id}&quot;, 429, 429) -&gt; clusterClientRatelimit(&quot;user-id&quot;, 10, &quot;1m&quot;, &quot;X-User-Id&quot;)
</code></pre></div>
<h3 id="tracingspanname">tracingSpanName<a class="headerlink" href="#tracingspanname" title="Permanent link">&para;</a></h3>
<p>This filter sets the name of the outgoing (client span) in opentracing. The default name is &ldquo;proxy&rdquo;. Example:</p>
<div class="highlight"><pre><span></span><code>tracingSpanName(&quot;api-operation&quot;)
</code></pre></div>
<h2 id="load-balancing">Load Balancing<a class="headerlink" href="#load-balancing" title="Permanent link">&para;</a></h2>
<p>Some filters influence how load balancing will be done</p>
<h3 id="fadein">fadeIn<a class="headerlink" href="#fadein" title="Permanent link">&para;</a></h3>
<p>When this filter is set, and the route has a load balanced backend using <a href="../backends/#load-balancer-backend">supported algorithm</a>,
then the newly added endpoints will receive
the traffic in a gradually increasing way, starting from their detection for the specified duration, after which
they receive equal amount traffic as the previously existing routes. The detection time of an load balanced
backend endpoint is preserved over multiple generations of the route configuration (over route changes). This
filter can be used to saturate the load of autoscaling applications that require a warm-up time and therefore a
smooth ramp-up. The fade-in feature can be used together with the roundRobin, random  or consistentHash LB algorithms.</p>
<p>While the default fade-in curve is linear, the optional exponent parameter can be used to adjust the shape of
the fade-in curve, based on the following equation:</p>
<p>current_rate = proportional_rate * min((now - detected) / duration, 1) ^ exponent</p>
<p>Parameters:</p>
<ul>
<li>duration: duration of the fade-in in milliseconds or as a duration string</li>
<li>fade-in curve exponent - optional: a floating point number, default: 1</li>
</ul>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code>fadeIn(&quot;3m&quot;)
fadeIn(&quot;3m&quot;, 1.5)
</code></pre></div>
<h4 id="warning-on-fadein-and-rolling-restarts">Warning on fadeIn and Rolling Restarts<a class="headerlink" href="#warning-on-fadein-and-rolling-restarts" title="Permanent link">&para;</a></h4>
<p>Traffic fade-in has the potential to skew the traffic to your backend pods in case of a rolling restart
(<code>kubectl rollout restart</code>), because it is very likely that the rolling restart is going faster than the
fade-in duration. The image below shows an example of a rolling restart for a four-pod deployment (A, B, C, D)
into (E, F, G, H), and the traffic share of each pod over time. While the ramp-up of the new pods is ongoing,
the remaining old pods will receive a largely increased traffic share (especially the last one, D in this
example), as well as an over-propotional traffic share for the first pod in the rollout (E).</p>
<p>To make rolling restarts safe, you need to slow them down by setting <code>spec.minReadySeconds</code> on the pod spec
of your deployment or stackset, according to your fadeIn duration.</p>
<p><img alt="Rolling Restart and Fade-In" src="../../img/fadein_traffic_skew.png" /></p>
<h3 id="endpointcreated">endpointCreated<a class="headerlink" href="#endpointcreated" title="Permanent link">&para;</a></h3>
<p>This filter marks the creation time of a load balanced endpoint. When used together with the fadeIn
filter, it prevents missing the detection of a new backend instance with the same hostname. This filter is
typically automatically appended, and it&rsquo;s parameters are based on external sources, e.g. the Kubernetes API.</p>
<p>Parameters:</p>
<ul>
<li>the address of the endpoint</li>
<li>timestamp, either as a number of seconds since the unix epocs, or a string in RFC3339 format</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>endpointCreated(&quot;http://10.0.0.1:8080&quot;, &quot;2020-12-18T15:30:00Z01:00&quot;)
</code></pre></div>
<h3 id="consistenthashkey">consistentHashKey<a class="headerlink" href="#consistenthashkey" title="Permanent link">&para;</a></h3>
<p>This filter sets the request key used by the <a href="../backends/#load-balancer-backend"><code>consistentHash</code></a> algorithm to select the backend endpoint.</p>
<p>Parameters:</p>
<ul>
<li>key (string)</li>
</ul>
<p>The key should contain <a href="#template-placeholders">template placeholders</a>, without placeholders the key
is constant and therefore all requests would be made to the same endpoint.
The algorithm will use the default key if any of the template placeholders can&rsquo;t be resolved.</p>
<p>Examples:</p>
<p><div class="highlight"><pre><span></span><code>pr: Path(&quot;/products/:productId&quot;)
    -&gt; consistentHashKey(&quot;${productId}&quot;)
    -&gt; &lt;consistentHash, &quot;http://127.0.0.1:9998&quot;, &quot;http://127.0.0.1:9997&quot;&gt;;
</code></pre></div>
<div class="highlight"><pre><span></span><code>consistentHashKey(&quot;${request.header.Authorization}&quot;)
consistentHashKey(&quot;${request.source}&quot;) // same as the default key
</code></pre></div></p>
<h3 id="consistenthashbalancefactor">consistentHashBalanceFactor<a class="headerlink" href="#consistenthashbalancefactor" title="Permanent link">&para;</a></h3>
<p>This filter sets the balance factor used by the <a href="../backends/#load-balancer-backend"><code>consistentHash</code></a> algorithm to prevent a single backend endpoint from being overloaded.
The number of in-flight requests for an endpoint can be no higher than <code>(average-in-flight-requests * balanceFactor) + 1</code>.
This is helpful in the case where certain keys are very popular and threaten to overload the endpoint they are mapped to.
<a href="https://ai.googleblog.com/2017/04/consistent-hashing-with-bounded-loads.html">Further Details</a>.</p>
<p>Parameters:</p>
<ul>
<li>balanceFactor: A float or int, must be &gt;= 1</li>
</ul>
<p>Examples:</p>
<p><div class="highlight"><pre><span></span><code>pr: Path(&quot;/products/:productId&quot;)
    -&gt; consistentHashKey(&quot;${productId}&quot;)
    -&gt; consistentHashBalanceFactor(1.25)
    -&gt; &lt;consistentHash, &quot;http://127.0.0.1:9998&quot;, &quot;http://127.0.0.1:9997&quot;&gt;;
</code></pre></div>
<div class="highlight"><pre><span></span><code>consistentHashBalanceFactor(3)
</code></pre></div></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>