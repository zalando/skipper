on:
  pull_request_target:
    types: [opened, reopened]

permissions:
  issues: write

env:
  TARGET_BRANCH: cw2025
  LABEL_NAME: cw2025
  LABEL_COLOR: '0e8a16' # green; change if you prefer another color
  LABEL_DESCRIPTION: 'PRs targeting cw2025 branch'

jobs:
  add-cw2025-label:
    runs-on: ubuntu-latest
    steps:
      - name: Add cw2025 label to PRs targeting the cw2025 branch
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            if (!pr) {
              core.info('No pull_request in context — nothing to do.');
              return;
            }

            const base = pr.base && pr.base.ref;
            if (base !== process.env.TARGET_BRANCH) {
              core.info(`PR base is '${base}', not '${process.env.TARGET_BRANCH}' — skipping.`);
              return;
            }

            const labelName = process.env.LABEL_NAME;

            // Check if the label exists; create it if missing
            try {
              await github.issues.getLabel({
                owner: context.repo.owner,
                repo: context.repo.repo,
                name: labelName
              });
            } catch (err) {
              core.info(`Label '${labelName}' not found — creating it.`);
              await github.issues.createLabel({
                owner: context.repo.owner,
                repo: context.repo.repo,
                name: labelName,
                color: process.env.LABEL_COLOR,
                description: process.env.LABEL_DESCRIPTION
              });
            }

            // Add the label to the PR (issues API is used for PRs)
            await github.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pr.number,
              labels: [labelName]
            });